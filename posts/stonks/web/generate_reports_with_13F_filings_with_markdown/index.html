<!DOCTYPE html><html lang="en"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.QW52Ox2j.js"></script><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Building a report with 13F filings - FriendlyUsers Tech Blog</title><meta name="description" content="sec filings with python and secedgar"><meta name="author" content="David Li"><link rel="alternate" type="application/rss+xml" href="/rss.xml"><link rel="icon" type="image/x-icon" href="/favicon.ico"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6"></script><script type="module">(function(e,n,r,t,m){e[t]=e[t]||[],e[t].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var g=n.getElementsByTagName(r)[0],a=n.createElement(r),s="";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+m+s,g.parentNode.insertBefore(a,g)})(window,document,"script","dataLayer","GTM-K8P5P8FQ");</script><script type="text/javascript">
      let slideIndex = 1;
      showSlides(slideIndex);

      function plusSlides(n) {
        showSlides((slideIndex += n));
      }

      function currentSlide(n) {
        showSlides((slideIndex = n));
      }

      function showSlides(n) {
        try {
          let i;
          let slides = document.getElementsByClassName('mySlides');
          let dots = document.getElementsByClassName('demo');
          let captionText = document.getElementById('caption');
          if (n > slides.length) {
            slideIndex = 1;
          }
          if (n < 1) {
            slideIndex = slides.length;
          }
          for (i = 0; i < slides.length; i++) {
            slides[i].style.display = 'none';
          }
          for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(' active', '');
          }
          slides[slideIndex - 1].style.display = 'block';
          dots[slideIndex - 1].className += ' active';
          captionText.innerHTML = dots[slideIndex - 1].alt;
        } catch (err) {
          // do nothing here
        }
      }
    </script><!-- Google Tag Manager --><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","UA-119155027-6");</script><!-- End Google Tag Manager --><link rel="stylesheet" href="/_astro/index.BvkiO192.css">
<style>.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}@media print{.no-print,.no-print *{display:none!important}}
</style></head> <body class="bg-slate-900 text-gray-100"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K8P5P8FQ" height="0" width="0" style="display:none;visibility:hidden"></iframe> </noscript> <!-- End Google Tag Manager (noscript) --> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between"><a href="/"><div class="flex items-center bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text text-xl font-bold text-transparent"><svg class="mr-1 h-10 w-10 stroke-cyan-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none"></path><rect x="3" y="12" width="6" height="8" rx="1"></rect><rect x="9" y="8" width="6" height="12" rx="1"></rect><rect x="15" y="4" width="6" height="16" rx="1"></rect><path d="M4 20h14"></path></svg>David&#x27;s Blog</div></a><nav><ul class="flex gap-x-3 font-medium text-gray-200"><li class="hover:text-white"><a href="/posts" target="_self">Blogs</a></li><li class="hover:text-white"><a href="https://github.com/FriendlyUser/astro-tech-blog" target="_self">GitHub</a></li></ul></nav></div></div> <div data-pagefind-body>  <div class="mx-auto max-w-screen-lg px-3 py-6"><div><h1 class="text-center text-3xl font-bold">Building a report with 13F filings</h1><div class="mt-2 text-center text-sm text-gray-400">By <!-- -->David Li<!-- --> on <!-- -->Friday, 14 April 2023 13:00:00 GMT</div><div class="flex place-content-center pt-2"><div class="
      // Layout //      Shape (Updated
      to match your               &quot;For&quot; snippet) // Typography inline-flex max-w-full items-center rounded-full
      px-2.5 py-0.5                      text-xs font-medium
      bg-cyan-400 text-cyan-900          // Dynamic Color
      h-fit
    " style="height:fit-content"><span class="line-clamp-2 break-words text-left"> <a href="/tags/sec" style="padding-right:3px"> <category>sec<!-- --> </category></a></span></div> <div class="
      // Layout //      Shape (Updated
      to match your               &quot;For&quot; snippet) // Typography inline-flex max-w-full items-center rounded-full
      px-2.5 py-0.5                      text-xs font-medium
      bg-green-400 text-green-900          // Dynamic Color
      h-fit
    " style="height:fit-content"><span class="line-clamp-2 break-words text-left"> <a href="/tags/python" style="padding-right:3px"> <category>python<!-- --> </category></a></span></div> <div class="
      // Layout //      Shape (Updated
      to match your               &quot;For&quot; snippet) // Typography inline-flex max-w-full items-center rounded-full
      px-2.5 py-0.5                      text-xs font-medium
      bg-cyan-400 text-cyan-900          // Dynamic Color
      h-fit
    " style="height:fit-content"><span class="line-clamp-2 break-words text-left"> <a href="/tags/secedgar" style="padding-right:3px"> <category>secedgar<!-- --> </category></a></span></div> </div><div class="mx-auto mt-5 max-w-prose"><div class="aspect-h-2 aspect-w-3"><img class="h-full w-full rounded-lg object-cover object-center" src="/imgs/2022/dall-e/DALL·E 2022-12-10 21.55.07 - magnifying glass on stonks.png" alt="rbc stock analyzer" loading="lazy"/></div><div class="prose prose-invert mt-8 prose-img:rounded-lg"><content> <p>View the previous post at <a href="https://friendlyuser.github.io/posts/stonks/scrap_from_sec_with_python">https://friendlyuser.github.io/posts/stonks/scrap_from_sec_with_python</a></p>
<p>This code fetches 13F filings for a list of companies from the Securities and Exchange Commission’s (SEC) Electronic Data Gathering, Analysis, and Retrieval (EDGAR) system. 13F filings are quarterly reports that detail the holdings of investment managers with at least $100 million in assets. The filings function from the secedgar library is used to retrieve these 13F filings, and the get_company_of_interest function acts as a filter to only return the 13F filings for the companies specified in the company_list variable. This list is read from the holdings_list.txt file. The fetch_filings function uses the save method of the combo_filings object to save the retrieved 13F filings to the temp folder. The get_year_quarter_from_path function extracts the year and quarter from the path of a file and returns them as a tuple of strings.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> secedgar </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> filings, FilingType</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> datetime </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> date</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> glob</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> matplotlib.pyplot </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> plt</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> seaborn </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> sns</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> re</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pandas </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> pd</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> json</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> typing </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> List</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> parser </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> DocParser</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># read company list from holdings_list.txt</span></span>
<span class="line"><span style="color:#F97583">with</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"holdings_list.txt"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"r"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> f:</span></span>
<span class="line"><span style="color:#E1E4E8">    holdings_list </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> f.read().splitlines()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">company_list </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> holdings_list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> get_company_of_interest</span><span style="color:#E1E4E8">(filing_entry):</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#9ECBFF"> "13F"</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> filing_entry.form_type </span><span style="color:#F97583">and</span><span style="color:#E1E4E8"> filing_entry.company_name.lower() </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> (name.lower() </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> name </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> company_list):</span></span>
<span class="line"><span style="color:#E1E4E8">        company_list.append(filing_entry.company_name)</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> True</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> fetch_filings</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#6A737D">    # 13F filings for Apple (ticker "aapl")</span></span>
<span class="line"><span style="color:#6A737D">    # read list from holdings_list.txt</span></span>
<span class="line"><span style="color:#E1E4E8">    combo_filings </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> filings(</span><span style="color:#FFAB70">start_date</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">date(</span><span style="color:#79B8FF">2022</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#FFAB70">                             end_date</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">date(</span><span style="color:#79B8FF">2022</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6A737D">                             # filing_type=FilingType.FILING_13F,</span></span>
<span class="line"><span style="color:#FFAB70">                             user_agent</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"Your name &#x3C;dlcoding20@gmail.com>"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">                             entry_filter</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">get_company_of_interest,</span></span>
<span class="line"><span style="color:#FFAB70">                             rate_limit</span><span style="color:#F97583">=</span><span style="color:#79B8FF">5</span></span>
<span class="line"><span style="color:#E1E4E8">    )</span></span>
<span class="line"><span style="color:#6A737D">    # map folder to year and quarter</span></span>
<span class="line"><span style="color:#E1E4E8">    combo_filings.save(</span><span style="color:#9ECBFF">"temp"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> get_year_quarter_from_path</span><span style="color:#E1E4E8">(path: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#9ECBFF">    """ Get year and quarter from path</span></span>
<span class="line"><span style="color:#9ECBFF">    """</span></span>
<span class="line"><span style="color:#6A737D">    # get all numbers from path using regex</span></span>
<span class="line"><span style="color:#E1E4E8">    year, quarter </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> re.findall(</span><span style="color:#F97583">r</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\d</span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">, path)[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> year, quarter</span></span></code></pre>
<p>This code appears to be parsing 13F filing documents and outputting the results to a file in markdown format. The parse_filings function takes a dictionary of data (data) as input and retrieves a company’s CIK number (a unique identifier assigned by the SEC to publicly traded companies) from the cik field in the data dictionary. If the cik field is not present, it defaults to “1649339”. It also retrieves the desired output filename from the filename field in the data dictionary, defaulting to “burry” if the field is not present. The function then uses the glob library to find all the text files under the temp folder that match the specified CIK number and stores their filenames in the filename variable. It uses the DocParser class to parse each file and filters the resulting documents for those of type “INFORMATION_TABLE”. It then adds the year and quarter of each document to its data frame and stores the resulting document in the final_docs list. If the final_docs list has four elements, the loop breaks. Finally, the function sorts the elements of final_docs by quarter and calls the output_to_md function to output the data to a markdown file. The metadata dictionary stores some metadata about the 13F filing that is included in the output file.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> parse_filings</span><span style="color:#E1E4E8">(data: </span><span style="color:#79B8FF">dict</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {}):</span></span>
<span class="line"><span style="color:#9ECBFF">    """ Parse filings</span></span>
<span class="line"><span style="color:#9ECBFF">    """</span></span>
<span class="line"><span style="color:#E1E4E8">    cik </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> data.get(</span><span style="color:#9ECBFF">"cik"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"1649339"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    output_name </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> data.get(</span><span style="color:#9ECBFF">"filename"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"burry"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">    # find files under temp/2022/QTR{1,2,3,4}/*.txt with glob</span></span>
<span class="line"><span style="color:#E1E4E8">    final_docs </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> filename </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> glob.iglob(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">'temp/2022/QTR*/</span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">cik</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">/*.txt'</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">recursive</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">        documents </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> DocParser(filename, </span><span style="color:#9ECBFF">"13F"</span><span style="color:#E1E4E8">).parse()</span></span>
<span class="line"><span style="color:#6A737D">        # filter for INFORMATION_TABLE</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> document </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> documents:</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> document[</span><span style="color:#9ECBFF">"type"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> "INFORMATION_TABLE"</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">                document[</span><span style="color:#9ECBFF">"filename"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> filename</span></span>
<span class="line"><span style="color:#6A737D">                # add year and quarter to document</span></span>
<span class="line"><span style="color:#E1E4E8">                year, quarter </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> get_year_quarter_from_path(filename)</span></span>
<span class="line"><span style="color:#E1E4E8">                temp_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> document[</span><span style="color:#9ECBFF">"df"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#6A737D">                # add year quarter to df</span></span>
<span class="line"><span style="color:#E1E4E8">                temp_df[</span><span style="color:#9ECBFF">"year"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> year</span></span>
<span class="line"><span style="color:#E1E4E8">                temp_df[</span><span style="color:#9ECBFF">"quarter"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> quarter</span></span>
<span class="line"><span style="color:#E1E4E8">                final_docs.append(document)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(final_docs) </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">            break</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # sort by quarter</span></span>
<span class="line"><span style="color:#E1E4E8">    final_docs </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> sorted</span><span style="color:#E1E4E8">(final_docs, </span><span style="color:#FFAB70">key</span><span style="color:#F97583">=lambda</span><span style="color:#E1E4E8"> x: x[</span><span style="color:#9ECBFF">"df"</span><span style="color:#E1E4E8">][</span><span style="color:#9ECBFF">"quarter"</span><span style="color:#E1E4E8">].iloc[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    metadata </span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#9ECBFF">        "filename"</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">output_name</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">.md"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        "company_name"</span><span style="color:#E1E4E8">: data.get(</span><span style="color:#9ECBFF">"outputLabel"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Burry"</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#9ECBFF">        "category"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"13F"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        "date"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"2022-12-21"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        "start_date"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"2022-01-01"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        "end_date"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"2022-12-20"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">        "cik"</span><span style="color:#E1E4E8">: cik,</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#6A737D">    # eventually parse all this from a metadata yaml file or json file</span></span>
<span class="line"><span style="color:#E1E4E8">    output_to_md(final_docs, metadata)</span></span></code></pre>
<p>This code appears to be processing and outputting data from 13F filing documents. The output_to_md function takes a list of data frames (final_docs) and a dictionary of metadata (metadata) as input. It first combines all the data frames in final_docs into a single data frame called combined_df. It then groups combined_df by the cusip column and stores the resulting data frame in grouped_df. It then extracts the last two quarters of data from final_docs and stores them in a data frame called last_two_quarters. It then converts the value column in last_two_quarters to numeric values and pivots the data frame by nameOfIssuer and quarter, storing the resulting data frame in pivot_df. It then plots pivot_df as a bar chart and saves the chart to a file. It then merges the last two quarters of data from final_docs using the pd.merge function and stores the resulting data frame in last_two_quarter_diff.</p>
<p>The function then opens a file with the name specified in the filename field of the metadata dictionary and writes some metadata and the pivoted data frame to it in markdown format. It also writes the data from each data frame in final_docs to the file, grouped by cusip. Finally, it writes the merged data frame (last_two_quarter_diff) to the file in markdown format.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> output_to_md</span><span style="color:#E1E4E8">(final_docs: List[pd.DataFrame], metadata: </span><span style="color:#79B8FF">dict</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#9ECBFF">    """ Output dataframe to markdown file</span></span>
<span class="line"><span style="color:#9ECBFF">    """</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    combined_df </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> None</span></span>
<span class="line"><span style="color:#6A737D">    # iterate across final_docs and append them all</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> doc </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> final_docs:</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> combined_df </span><span style="color:#F97583">is</span><span style="color:#79B8FF"> None</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">            combined_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> doc[</span><span style="color:#9ECBFF">"df"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">        else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">            # pandas.concat</span></span>
<span class="line"><span style="color:#E1E4E8">            combined_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.concat([combined_df, doc[</span><span style="color:#9ECBFF">"df"</span><span style="color:#E1E4E8">]])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # combine df then group by cusip</span></span>
<span class="line"><span style="color:#E1E4E8">    grouped_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> combined_df.groupby(</span><span style="color:#9ECBFF">"cusip"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # get 2nd last element in list</span></span>
<span class="line"><span style="color:#E1E4E8">    last_quarter </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> final_docs[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    current_quarter </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> final_docs[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    filename </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> metadata[</span><span style="color:#9ECBFF">"filename"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    csv_filename </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> filename.replace(</span><span style="color:#9ECBFF">".md"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">".csv"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">    # write to csv</span></span>
<span class="line"><span style="color:#E1E4E8">    combined_df.to_csv(csv_filename, </span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    merge_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.merge(last_quarter[</span><span style="color:#9ECBFF">"df"</span><span style="color:#E1E4E8">], current_quarter[</span><span style="color:#9ECBFF">"df"</span><span style="color:#E1E4E8">], </span><span style="color:#FFAB70">how</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"outer"</span><span style="color:#E1E4E8">) </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # quarterly_df = combined_df.groupby("quarter")</span></span>
<span class="line"><span style="color:#6A737D">    # append last two quarters</span></span>
<span class="line"><span style="color:#E1E4E8">    last_two_quarters </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.concat([last_quarter[</span><span style="color:#9ECBFF">"df"</span><span style="color:#E1E4E8">], current_quarter[</span><span style="color:#9ECBFF">"df"</span><span style="color:#E1E4E8">]])</span></span>
<span class="line"><span style="color:#E1E4E8">    last_two_quarters </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> last_two_quarters[[</span><span style="color:#9ECBFF">"quarter"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"nameOfIssuer"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"value"</span><span style="color:#E1E4E8">]]</span></span>
<span class="line"><span style="color:#6A737D">    # plot ax grouped by quarter</span></span>
<span class="line"><span style="color:#6A737D">    # make value numeric</span></span>
<span class="line"><span style="color:#6A737D">    # use .loc[row_indexer, col_indexer]</span></span>
<span class="line"><span style="color:#E1E4E8">    last_two_quarters.loc[:, </span><span style="color:#9ECBFF">"value"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.to_numeric(last_two_quarters[</span><span style="color:#9ECBFF">"value"</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#E1E4E8">    png_filename </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> filename.replace(</span><span style="color:#9ECBFF">".md"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">".png"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # make pivot table</span></span>
<span class="line"><span style="color:#E1E4E8">    pivot_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> last_two_quarters.pivot(</span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"nameOfIssuer"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">columns</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"quarter"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">values</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"value"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">    # plot pivot table</span></span>
<span class="line"><span style="color:#6A737D">    # first color red, second color blue</span></span>
<span class="line"><span style="color:#E1E4E8">    ax </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pivot_df.plot(</span><span style="color:#FFAB70">kind</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"bar"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">color</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#9ECBFF">"blue"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"green"</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#6A737D">    # make image big enough for labels</span></span>
<span class="line"><span style="color:#E1E4E8">    ax.figure.savefig(png_filename, </span><span style="color:#FFAB70">bbox_inches</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"tight"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    # quarter diff combined</span></span>
<span class="line"><span style="color:#E1E4E8">    last_two_quarter_diff </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pd.merge(last_quarter[</span><span style="color:#9ECBFF">"df"</span><span style="color:#E1E4E8">], current_quarter[</span><span style="color:#9ECBFF">"df"</span><span style="color:#E1E4E8">], </span><span style="color:#FFAB70">how</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"outer"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">indicator</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    with</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(filename, </span><span style="color:#9ECBFF">"w"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> f:</span></span>
<span class="line"><span style="color:#E1E4E8">        f.write(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Title: </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">metadata[</span><span style="color:#9ECBFF">'company_name'</span><span style="color:#E1E4E8">]</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> - </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">metadata[</span><span style="color:#9ECBFF">'cik'</span><span style="color:#E1E4E8">]</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> \n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        f.write(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Date: </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">metadata[</span><span style="color:#9ECBFF">'date'</span><span style="color:#E1E4E8">]</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> \n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        f.write(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"Category: </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">metadata[</span><span style="color:#9ECBFF">'category'</span><span style="color:#E1E4E8">]</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> \n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">        # merge df</span></span>
<span class="line"><span style="color:#E1E4E8">        f.write(</span><span style="color:#9ECBFF">"## Quarterly holdings </span><span style="color:#79B8FF">\n\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        # write png_filename</span></span>
<span class="line"><span style="color:#E1E4E8">        f.write(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"![quarterly holdings](</span><span style="color:#79B8FF">{{</span><span style="color:#9ECBFF">attach</span><span style="color:#79B8FF">}}</span><span style="color:#9ECBFF">images/</span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">png_filename</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">) </span><span style="color:#79B8FF">\n\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        f.write(</span><span style="color:#9ECBFF">"uses last two quarters to compare </span><span style="color:#79B8FF">\n\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        f.write(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"## All tables </span><span style="color:#79B8FF">\n\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">        # write all tables</span></span>
<span class="line"><span style="color:#E1E4E8">        reduced_df </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> combined_df[[</span><span style="color:#9ECBFF">"nameOfIssuer"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"value"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"sshPrnamt"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"sshPrnamtType"</span><span style="color:#E1E4E8">,  </span><span style="color:#9ECBFF">"year"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"quarter"</span><span style="color:#E1E4E8">]]</span></span>
<span class="line"><span style="color:#6A737D">        # if combined_df has putCall column</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#9ECBFF"> "putCall"</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> combined_df.columns:</span></span>
<span class="line"><span style="color:#E1E4E8">            reduced_df[</span><span style="color:#9ECBFF">"putCall"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> combined_df[</span><span style="color:#9ECBFF">"putCall"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">        f.write(reduced_df.to_markdown(</span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        f.write(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\n\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">        # write header</span></span>
<span class="line"><span style="color:#E1E4E8">        f.write(</span><span style="color:#9ECBFF">"## Tables by cusip </span><span style="color:#79B8FF">\n\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> cusip, group </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> grouped_df:</span></span>
<span class="line"><span style="color:#E1E4E8">            f.write(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\n</span><span style="color:#79B8FF"> \n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            f.write(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">"### </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">cusip</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> \n\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            simple_group </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> group[[</span><span style="color:#9ECBFF">"nameOfIssuer"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"value"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"sshPrnamt"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"sshPrnamtType"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"year"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"quarter"</span><span style="color:#E1E4E8">]]</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#9ECBFF"> "putCall"</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> group.columns:</span></span>
<span class="line"><span style="color:#E1E4E8">                simple_group[</span><span style="color:#9ECBFF">"putCall"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> group[</span><span style="color:#9ECBFF">"putCall"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">            f.write(simple_group.to_markdown(</span><span style="color:#FFAB70">index</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#E1E4E8">            f.write(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\n</span><span style="color:#79B8FF"> \n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">        f.write(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\n\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span></code></pre>
<p>To view the sample output, please go to the following link:</p>
<p>13F.grandfleet.eu.org</p>
<p>It is generated by pelican, a static site generator written in python. The source code for the site is available at the following link:</p>
<p><a href="https://github.com/FriendlyUser/13F-sec">https://github.com/FriendlyUser/13F-sec</a></p>
<p>Pelican is a static site generator written in Python. It is used to generate static HTML files for a website from templates and content written in a markup language such as Markdown or reStructuredText. Pelican is designed to be flexible, allowing users to customize the look and feel of their website and to extend its functionality through plugins. It also integrates with popular tools such as Jinja2 templates and the Pygments syntax highlighter. Pelican is a popular choice for bloggers, documentation authors, and other users who want to create a simple, fast-loading website without the need for a dynamic backend.</p> </content></div></div></div></div> <div class="mx-auto max-w-screen-lg px-3 py-6"> <div class="no-print flex w-full"> <form class="max-w-lg" action="https://formspree.io/f/davidli012345@gmail.com" method="POST"><div class="-mx-3 mb-6 flex flex-wrap"><div class="mb-6 w-full px-3 md:mb-0 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-first-name">First Name</label><input class="mb-3 block w-full appearance-none rounded py-3 px-4 leading-tight text-gray-700 focus:bg-white focus:outline-none" id="grid-first-name" type="text" placeholder="Jane"/></div><div class="w-full px-3 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-last-name">Last Name</label><input class="block w-full appearance-none rounded border border-gray-200  py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="grid-last-name" type="text" placeholder="Doe"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">E-mail</label><input class="mb-3 block w-full appearance-none rounded border py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="email" type="email"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">Message</label><textarea class="no-resize mb-3 block h-48 w-full resize-none appearance-none rounded border border-gray-200 py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="message"></textarea></div></div><div class="md:flex md:items-center"><div class="md:w-1/3"><button class="ml-2 shrink-0 rounded-full bg-gradient-to-br from-sky-500 to-cyan-400 px-3 py-1 text-sm font-medium text-gray-700 hover:from-sky-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-600/50" type="submit">Send</button></div><div class="md:w-2/3"></div></div></form> <div class="ml-3 max-w-lg bg-slate-300"> <link href="/pagefind/pagefind-ui.css" rel="stylesheet"> <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script> <div id="search" class="ml-3 p-4"></div> <script type="module">window.addEventListener("DOMContentLoaded",e=>{setTimeout(()=>{new PagefindUI({element:"#search"})},2e3)});</script> </div> </div> </div>  </div> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="no-print border-t border-gray-600 pt-5"><div class="text-sm text-gray-200">© Copyright <!-- -->2026<!-- --> by <!-- -->FriendlyUsers Tech Blog<!-- -->. Built with ♥ by<!-- --> <a class="text-cyan-400 hover:underline" href="https://github.com/FriendlyUser" target="_blank" rel="noopener noreferrer">FriendlyUser</a>. Last updated on <!-- -->2026-02-26<!-- -->.</div></div><script src="https://cdn.botpress.cloud/webchat/v0/inject.js"></script><script src="https://mediafiles.botpress.cloud/0df54034-3318-451a-aed0-3923a4ee25a5/webchat/config.js" defer=""></script></div> </body></html>