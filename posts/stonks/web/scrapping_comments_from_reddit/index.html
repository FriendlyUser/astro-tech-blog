<!DOCTYPE html><html lang="en"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Using golang to filter through reddit posts - FriendlyUsers Tech Blog</title><meta name="description" content="Leverage the reddit api to get the latest posts multiple subreddits."><meta name="author" content="David Li"><link rel="alternate" type="application/rss+xml" href="/rss.xml"><link rel="icon" type="image/x-icon" href="/favicon.ico"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6"></script><script type="text/javascript">
      let slideIndex = 1;
      showSlides(slideIndex);

      function plusSlides(n) {
        showSlides((slideIndex += n));
      }

      function currentSlide(n) {
        showSlides((slideIndex = n));
      }

      function showSlides(n) {
        try {
          let i;
          let slides = document.getElementsByClassName('mySlides');
          let dots = document.getElementsByClassName('demo');
          let captionText = document.getElementById('caption');
          if (n > slides.length) {
            slideIndex = 1;
          }
          if (n < 1) {
            slideIndex = slides.length;
          }
          for (i = 0; i < slides.length; i++) {
            slides[i].style.display = 'none';
          }
          for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(' active', '');
          }
          slides[slideIndex - 1].style.display = 'block';
          dots[slideIndex - 1].className += ' active';
          captionText.innerHTML = dots[slideIndex - 1].alt;
        } catch (err) {
          // do nothing here
        }
      }
    </script><!-- Google Tag Manager --><!-- End Google Tag Manager --><link rel="stylesheet" href="/_astro/index.DFWZl3Z8.css" />
<style>.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);-webkit-clip-path:inset(50%);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}@media print{.no-print,.no-print *{display:none!important}}
</style><script type="module" src="/_astro/hoisted.CcuKkQrI.js"></script></head> <body class="bg-slate-900 text-gray-100"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K8P5P8FQ" height="0" width="0" style="display:none;visibility:hidden"></iframe> </noscript> <!-- End Google Tag Manager (noscript) --> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between"><a href="/"><div class="flex items-center bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text text-xl font-bold text-transparent"><svg class="mr-1 h-10 w-10 stroke-cyan-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none"></path><rect x="3" y="12" width="6" height="8" rx="1"></rect><rect x="9" y="8" width="6" height="12" rx="1"></rect><rect x="15" y="4" width="6" height="16" rx="1"></rect><path d="M4 20h14"></path></svg>David&#x27;s Blog</div></a><nav><ul class="flex gap-x-3 font-medium text-gray-200"><li class="hover:text-white"><a href="/posts">Blogs</a></li><li class="hover:text-white"><a href="https://github.com/FriendlyUser/astro-tech-blog">GitHub</a></li><li class="hover:text-white"><a href="/photos">Photos</a></li></ul></nav></div></div> <div data-pagefind-body>  <div class="mx-auto max-w-screen-lg px-3 py-6"><div><h1 class="text-center text-3xl font-bold">Using golang to filter through reddit posts</h1><div class="mt-2 text-center text-sm text-gray-400">By <!-- -->David Li<!-- --> on <!-- -->Mon, 7 November 2023</div><div class="flex place-content-center pt-2"><div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/reddit" style="padding-right:3px"> <category>reddit<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-orange-400 text-orange-900"> <a href="/tags/golang" style="padding-right:3px"> <category>golang<!-- --> </category></a></div> </div><div class="mx-auto mt-5 max-w-prose"><div class="aspect-w-3 aspect-h-2"><img class="h-full w-full rounded-lg object-cover object-center" src="/imgs/2023/3493235193_A_dream_of_a_distant_galaxy__concept_art.png" loading="lazy"/></div><div class="prose prose-invert mt-8 prose-img:rounded-lg"><content> <p>Reddit is a social news aggregation, web content rating, and discussion website. Users can submit posts, such as text or direct links, and other users can vote on these posts, causing them to rise or fall in popularity. Reddit is organized into communities, known as “subreddits,” which cover a vast array of topics and interests.</p>
<p>Web scraping with Go (Golang) can be useful in a variety of ways:</p>
<ol>
<li>Data collection: Web scraping allows you to extract large amounts of data from websites, which can be useful for data analysis and research.</li>
<li>Price monitoring: Go can be used to monitor the prices of products on various websites and notify users of price changes.</li>
<li>Content aggregation: Go can be used to aggregate content from multiple websites into a single source, making it easier to find and view relevant information.</li>
<li>Automation: Go can be used to automate repetitive tasks, such as filling out forms or visiting websites, to save time and effort.</li>
<li>Testing: Go can be used to test websites for functional and performance issues, making it easier to identify and fix problems.</li>
</ol>
<p>In summary, web scraping with Go is useful for data collection, price monitoring, content aggregation, automation, and testing, among other uses.</p>
<p>Parsing subreddits with the Reddit API involves using the API to extract data from Reddit and display it in a specific format. To parse subreddits using the Reddit API, you need to have an API key or access token. Once you have this, you can make HTTP requests to the Reddit API to retrieve data for a specific subreddit. The API will return the data in JSON format, which can then be processed and displayed in a way that meets your needs.</p>
<p>For example, to retrieve the top 10 posts in a subreddit, you can make a GET request to the following URL:</p>
<p><a href="https://www.reddit.com/r/%5Bsubreddit%5D/top.json?limit=10">https://www.reddit.com/r/[subreddit]/top.json?limit=10</a></p>
<p>Where [subreddit] is the name of the subreddit you want to retrieve data from.</p>
<p>There are many libraries available in Go that simplify the process of making API calls and processing the resulting data. By using one of these libraries, you can focus on the data you want to extract and display, without having to worry about the details of making API calls and processing the results.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672"> package</span><span> </span><span style="color:#A6E22E;text-decoration:underline">login</span><span style="color:#F8F8F2"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> (</span></span>
<span class="line"><span style="color:#E6DB74">	"github.com/jzelinskie/geddit"</span></span>
<span class="line"><span style="color:#E6DB74">	"log"</span></span>
<span class="line"><span style="color:#E6DB74">	"github.com/dli-invest/finreddit/pkg/util"</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">// returns oauth session for reddit</span></span>
<span class="line"><span style="color:#88846F">// or fails - fine for my purposes</span></span>
<span class="line"><span style="color:#F92672">func</span><span style="color:#A6E22E"> RedditOAuth</span><span style="color:#F8F8F2">() (</span><span style="color:#F92672">*</span><span style="color:#A6E22E;text-decoration:underline">geddit</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">OAuthSession</span><span style="color:#F8F8F2">, </span><span style="color:#66D9EF;font-style:italic">error</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">	client_id </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> util.</span><span style="color:#A6E22E">GetEnvVar</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"REDDIT_CLIENT_ID"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	client_secret </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> util.</span><span style="color:#A6E22E">GetEnvVar</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"REDDIT_CLIENT_SECRET"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	password </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> util.</span><span style="color:#A6E22E">GetEnvVar</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"REDDIT_PASSWORD"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	username </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> util.</span><span style="color:#A6E22E">GetEnvVar</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"REDDIT_USERNAME"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	o, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> geddit.</span><span style="color:#A6E22E">NewOAuthSession</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">		client_id,</span></span>
<span class="line"><span style="color:#F8F8F2">		client_secret,</span></span>
<span class="line"><span style="color:#E6DB74">		"Stonk Market Scrapper see source https://github.com/dli-invest/finreddit"</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#E6DB74">		"http://friendlyuser.github.io"</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">	)</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		log.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F92672">		return</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2">, err</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">	// Create new auth token for confidential clients (personal scripts/apps).</span></span>
<span class="line"><span style="color:#F8F8F2">	err </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> o.</span><span style="color:#A6E22E">LoginAuth</span><span style="color:#F8F8F2">(username, password)</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		log.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F92672">		return</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2">, err</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F92672">	return</span><span style="color:#F8F8F2"> o, </span><span style="color:#AE81FF">nil</span></span>
<span class="line"><span style="color:#F8F8F2">} </span></span></code></pre>
<p>This code defines a Go function named “RedditOAuth” that is used to authenticate a user to the Reddit API using the “geddit” library. The function starts by retrieving four environment variables (“REDDIT_CLIENT_ID”, “REDDIT_CLIENT_SECRET”, “REDDIT_PASSWORD”, and “REDDIT_USERNAME”) using the “util.GetEnvVar” function from the “github.com/dli-invest/finreddit/pkg/util” package.</p>
<p>Next, the function creates a new OAuth session using the “geddit.NewOAuthSession” function and the retrieved environment variables. If an error occurs while creating the OAuth session, it is logged and returned.</p>
<p>Finally, the function logs in the user using the “o.LoginAuth” method and the “username” and “password” environment variables. If an error occurs while logging in, it is logged and returned. If the login is successful, the OAuth session is returned.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672"> package</span><span> </span><span style="color:#A6E22E;text-decoration:underline">reddit</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> (</span></span>
<span class="line"><span style="color:#E6DB74">	"fmt"</span></span>
<span class="line"><span style="color:#E6DB74">	"log"</span></span>
<span class="line"><span style="color:#E6DB74">	"strings"</span></span>
<span class="line"><span style="color:#E6DB74">	"time"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">	"github.com/dli-invest/finreddit/pkg/csvs"</span></span>
<span class="line"><span style="color:#E6DB74">	"github.com/dli-invest/finreddit/pkg/discord"</span></span>
<span class="line"><span style="color:#E6DB74">	"github.com/dli-invest/finreddit/pkg/login"</span></span>
<span class="line"><span style="color:#E6DB74">	"github.com/dli-invest/finreddit/pkg/types"</span></span>
<span class="line"><span style="color:#E6DB74">	"github.com/dli-invest/finreddit/pkg/util"</span></span>
<span class="line"><span style="color:#E6DB74">	"github.com/jzelinskie/geddit"</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">// gets submissions a given SRConfiguration</span></span>
<span class="line"><span style="color:#F92672">func</span><span style="color:#A6E22E"> GetSubmissions</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">session</span><span style="color:#F92672"> *</span><span style="color:#A6E22E;text-decoration:underline">geddit</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">OAuthSession</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">cfg</span><span> </span><span style="color:#A6E22E;text-decoration:underline">types</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">SRConfig</span><span style="color:#F8F8F2">) []</span><span style="color:#F92672">*</span><span style="color:#A6E22E;text-decoration:underline">geddit</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Submission</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	subreddit </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> cfg.Name</span></span>
<span class="line"><span style="color:#F8F8F2">	limit </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> cfg.Limit</span></span>
<span class="line"><span style="color:#F8F8F2">	subOpts </span><span style="color:#F92672">:=</span><span> </span><span style="color:#A6E22E;text-decoration:underline">geddit</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">ListingOptions</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">		Limit: limit,</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> cfg.After </span><span style="color:#F92672">!=</span><span style="color:#E6DB74"> ""</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		subOpts.After </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> cfg.After</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">	submissions, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> session.</span><span style="color:#A6E22E">SubredditSubmissions</span><span style="color:#F8F8F2">(subreddit, geddit.NewSubmissions, subOpts)</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		log.</span><span style="color:#A6E22E">Fatal</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"Failed to retrieve subreddit posts for "</span><span style="color:#F92672"> +</span><span style="color:#F8F8F2"> subreddit)</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#88846F">	// further filter entries by minScore and minComments</span></span>
<span class="line"><span style="color:#F92672">	var</span><span style="color:#F8F8F2"> validSubmissions </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> []</span><span style="color:#F92672">*</span><span style="color:#A6E22E;text-decoration:underline">geddit</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Submission</span><span style="color:#F8F8F2">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">	for</span><span style="color:#F8F8F2"> _, submission </span><span style="color:#F92672">:=</span><span style="color:#F92672"> range</span><span style="color:#F8F8F2"> submissions {</span></span>
<span class="line"><span style="color:#F92672">		if</span><span style="color:#F8F8F2"> submission.NumComments </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> 0</span><span style="color:#F92672"> &#x26;&#x26;</span><span style="color:#F8F8F2"> cfg.MinScore </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> 0</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F92672">			if</span><span style="color:#F8F8F2"> submission.NumComments </span><span style="color:#F92672">>=</span><span style="color:#F8F8F2"> cfg.MinComments </span><span style="color:#F92672">&#x26;&#x26;</span><span style="color:#F8F8F2"> submission.Score </span><span style="color:#F92672">>=</span><span style="color:#F8F8F2"> cfg.MinScore {</span></span>
<span class="line"><span style="color:#F8F8F2">				validSubmissions </span><span style="color:#F92672">=</span><span style="color:#A6E22E"> append</span><span style="color:#F8F8F2">(validSubmissions, submission)</span></span>
<span class="line"><span style="color:#F92672">				continue</span></span>
<span class="line"><span style="color:#F8F8F2">			}</span></span>
<span class="line"><span style="color:#F8F8F2">		}</span></span>
<span class="line"><span style="color:#F92672">		if</span><span style="color:#F8F8F2"> cfg.LinkFlairText </span><span style="color:#F92672">!=</span><span style="color:#E6DB74"> ""</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#88846F">			// checking for flair</span></span>
<span class="line"><span style="color:#F92672">			if</span><span style="color:#F8F8F2"> strings.</span><span style="color:#A6E22E">Contains</span><span style="color:#F8F8F2">(submission.LinkFlairText, cfg.LinkFlairText) {</span></span>
<span class="line"><span style="color:#F8F8F2">				validSubmissions </span><span style="color:#F92672">=</span><span style="color:#A6E22E"> append</span><span style="color:#F8F8F2">(validSubmissions, submission)</span></span>
<span class="line"><span style="color:#F92672">				continue</span></span>
<span class="line"><span style="color:#F8F8F2">			}</span></span>
<span class="line"><span style="color:#F8F8F2">		}</span></span>
<span class="line"><span style="color:#F92672">		if</span><span style="color:#A6E22E"> len</span><span style="color:#F8F8F2">(cfg.Phrases) </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> 0</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#88846F">			// search through phrases</span></span>
<span class="line"><span style="color:#F8F8F2">			title </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> strings.</span><span style="color:#A6E22E">ToLower</span><span style="color:#F8F8F2">(submission.Title)</span></span>
<span class="line"><span style="color:#88846F">			// check matches word</span></span>
<span class="line"><span style="color:#F92672">			for</span><span style="color:#F8F8F2"> _, phrase </span><span style="color:#F92672">:=</span><span style="color:#F92672"> range</span><span style="color:#F8F8F2"> cfg.Phrases {</span></span>
<span class="line"><span style="color:#88846F">				// check if phrase is contained in title</span></span>
<span class="line"><span style="color:#F8F8F2">				lowerPhrase </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> strings.</span><span style="color:#A6E22E">ToLower</span><span style="color:#F8F8F2">(phrase)</span></span>
<span class="line"><span style="color:#F8F8F2">				addSubmission </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> strings.</span><span style="color:#A6E22E">Contains</span><span style="color:#F8F8F2">(title, lowerPhrase)</span></span>
<span class="line"><span style="color:#F92672">				if</span><span style="color:#F8F8F2"> addSubmission {</span></span>
<span class="line"><span style="color:#F8F8F2">					validSubmissions </span><span style="color:#F92672">=</span><span style="color:#A6E22E"> append</span><span style="color:#F8F8F2">(validSubmissions, submission)</span></span>
<span class="line"><span style="color:#F92672">					continue</span></span>
<span class="line"><span style="color:#F8F8F2">				}</span></span>
<span class="line"><span style="color:#F8F8F2">			}</span></span>
<span class="line"><span style="color:#F8F8F2">		}</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F92672">	return</span><span style="color:#F8F8F2"> validSubmissions</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">// Scans subreddits from config file</span></span>
<span class="line"><span style="color:#88846F">// for example cmd/scan_sr/simple.yml</span></span>
<span class="line"><span style="color:#F92672">func</span><span style="color:#A6E22E"> ScanSRs</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">cfgPathStr</span><span style="color:#66D9EF;font-style:italic"> string</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#88846F">	// login to reddit</span></span>
<span class="line"><span style="color:#F8F8F2">	o, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> login.</span><span style="color:#A6E22E">RedditOAuth</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		log.</span><span style="color:#A6E22E">Fatal</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"Failed to initialize Reddit Scrapper"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#88846F">	// read subreddits from config file</span></span>
<span class="line"><span style="color:#F8F8F2">	cfgPath </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> util.</span><span style="color:#A6E22E">MkPathFromStr</span><span style="color:#F8F8F2">(cfgPathStr)</span></span>
<span class="line"><span style="color:#F8F8F2">	cfg, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> util.</span><span style="color:#A6E22E">NewConfig</span><span style="color:#F8F8F2">(cfgPath)</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		log.</span><span style="color:#A6E22E">Fatal</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">	csvsPath </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> util.</span><span style="color:#A6E22E">MkPathFromStr</span><span style="color:#F8F8F2">(cfg.Data.CsvPath)</span></span>
<span class="line"><span style="color:#88846F">	// print header row only used when</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> cfg.Data.NoMessage {</span></span>
<span class="line"><span style="color:#F8F8F2">		fmt.</span><span style="color:#A6E22E">Printf</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"</span><span style="color:#AE81FF">%s\t%s\t%s\t%s\t%s\t%s\n</span><span style="color:#E6DB74">"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"subreddit"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"url"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"title"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"author"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"linkFlairText"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"date"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F92672">	for</span><span style="color:#F8F8F2"> _, srCfg </span><span style="color:#F92672">:=</span><span style="color:#F92672"> range</span><span style="color:#F8F8F2"> cfg.Data.SubReddits {</span></span>
<span class="line"><span style="color:#F8F8F2">		srSubmissions </span><span style="color:#F92672">:=</span><span style="color:#A6E22E"> GetSubmissions</span><span style="color:#F8F8F2">(o, srCfg)</span></span>
<span class="line"><span style="color:#F92672">		for</span><span style="color:#F8F8F2"> _, s </span><span style="color:#F92672">:=</span><span style="color:#F92672"> range</span><span style="color:#F8F8F2"> srSubmissions {</span></span>
<span class="line"><span style="color:#88846F">			// check if submission is in csv already</span></span>
<span class="line"><span style="color:#88846F">			// aware that constantly opening the csv is inefficient</span></span>
<span class="line"><span style="color:#88846F">			// but I am dealing with a reasonable amount of entires</span></span>
<span class="line"><span style="color:#F8F8F2">			hasValue </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> csvs.</span><span style="color:#A6E22E">FindInCsv</span><span style="color:#F8F8F2">(csvsPath, s.FullID, </span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">			if</span><span style="color:#F8F8F2"> hasValue {</span></span>
<span class="line"><span style="color:#88846F">				// no value, do nothing here</span></span>
<span class="line"><span style="color:#F8F8F2">			} </span><span style="color:#F92672">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#88846F">				// seems like a lot of posts, wondering if I will hit</span></span>
<span class="line"><span style="color:#88846F">				// post limit, sleep 2 seconds after each post.</span></span>
<span class="line"><span style="color:#88846F">				// append to csv</span></span>
<span class="line"><span style="color:#F8F8F2">				sData </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> [][]</span><span style="color:#66D9EF;font-style:italic">string</span><span style="color:#F8F8F2">{{srCfg.Name, s.FullID, s.URL}}</span></span>
<span class="line"><span style="color:#F8F8F2">				csvs.</span><span style="color:#A6E22E">AppendToCsv</span><span style="color:#F8F8F2">(csvsPath, sData)</span></span>
<span class="line"><span style="color:#F92672">				if</span><span style="color:#F8F8F2"> cfg.Data.NoMessage {</span></span>
<span class="line"><span style="color:#88846F">					// output this as a csv for parsing in other programs</span></span>
<span class="line"><span style="color:#88846F">					// fmt.Println("Not sending to subreddit")</span></span>
<span class="line"><span style="color:#F8F8F2">					fmt.</span><span style="color:#A6E22E">Printf</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"</span><span style="color:#AE81FF">%s\t%s\t%s\t%s\t%s\t%f\n</span><span style="color:#E6DB74">"</span><span style="color:#F8F8F2">, s.Subreddit, s.</span><span style="color:#A6E22E">FullPermalink</span><span style="color:#F8F8F2">(), s.Title, s.Author, s.LinkFlairText, s.DateCreated)</span></span>
<span class="line"><span style="color:#F8F8F2">				} </span><span style="color:#F92672">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">					discordPayload </span><span style="color:#F92672">:=</span><span style="color:#A6E22E"> MapSubmissionToEmbed</span><span style="color:#F8F8F2">(s)</span></span>
<span class="line"><span style="color:#F8F8F2">					_, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> discord.</span><span style="color:#A6E22E">SendWebhook</span><span style="color:#F8F8F2">(discordPayload)</span></span>
<span class="line"><span style="color:#F92672">					if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">						fmt.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(s.FullID)</span></span>
<span class="line"><span style="color:#F8F8F2">						fmt.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F8F8F2">					}</span></span>
<span class="line"><span style="color:#F8F8F2">					time.</span><span style="color:#A6E22E">Sleep</span><span style="color:#F8F8F2">(</span><span style="color:#AE81FF">2</span><span style="color:#F92672"> *</span><span style="color:#F8F8F2"> time.Second)</span></span>
<span class="line"><span style="color:#F8F8F2">				}</span></span>
<span class="line"><span style="color:#F8F8F2">			}</span></span>
<span class="line"><span style="color:#F8F8F2">		}</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">func</span><span style="color:#A6E22E"> MapSubmissionToEmbed</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">submission</span><span style="color:#F92672"> *</span><span style="color:#A6E22E;text-decoration:underline">geddit</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Submission</span><span style="color:#F8F8F2">) </span><span style="color:#A6E22E;text-decoration:underline">types</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">DiscordPayload</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">	description </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> fmt.</span><span style="color:#A6E22E">Sprintf</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#E6DB74">		"</span><span style="color:#AE81FF">%s</span><span style="color:#E6DB74"> (</span><span style="color:#AE81FF">%d</span><span style="color:#E6DB74"> Likes, </span><span style="color:#AE81FF">%d</span><span style="color:#E6DB74"> Comments)"</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">		submission.Author,</span></span>
<span class="line"><span style="color:#F8F8F2">		submission.Score,</span></span>
<span class="line"><span style="color:#F8F8F2">		submission.NumComments)</span></span>
<span class="line"><span style="color:#88846F">	// get timestamp</span></span>
<span class="line"><span style="color:#F92672">	var</span><span style="color:#F8F8F2"> dateCreated </span><span style="color:#66D9EF;font-style:italic">int64</span><span style="color:#F92672"> =</span><span style="color:#66D9EF;font-style:italic"> int64</span><span style="color:#F8F8F2">(submission.DateCreated)</span></span>
<span class="line"><span style="color:#F8F8F2">	t </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> time.</span><span style="color:#A6E22E">Unix</span><span style="color:#F8F8F2">(dateCreated, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	timestamp </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> t.</span><span style="color:#A6E22E">Format</span><span style="color:#F8F8F2">(time.RFC3339)</span></span>
<span class="line"><span style="color:#F8F8F2">	title </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> fmt.</span><span style="color:#A6E22E">Sprintf</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"</span><span style="color:#AE81FF">%s</span><span style="color:#E6DB74"> - </span><span style="color:#AE81FF">%s</span><span style="color:#E6DB74">"</span><span style="color:#F8F8F2">, submission.Subreddit, submission.Title)</span></span>
<span class="line"><span style="color:#F8F8F2">	discordEmbed </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> []</span><span style="color:#A6E22E;text-decoration:underline">types</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">DiscordEmbed</span><span style="color:#F8F8F2">{{</span></span>
<span class="line"><span style="color:#F8F8F2">		Title:       title,</span></span>
<span class="line"><span style="color:#F8F8F2">		Url:         submission.URL,</span></span>
<span class="line"><span style="color:#F8F8F2">		Description: description,</span></span>
<span class="line"><span style="color:#F8F8F2">		Timestamp:   timestamp,</span></span>
<span class="line"><span style="color:#F8F8F2">	}}</span></span>
<span class="line"><span style="color:#F8F8F2">	discordPayload </span><span style="color:#F92672">:=</span><span> </span><span style="color:#A6E22E;text-decoration:underline">types</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">DiscordPayload</span><span style="color:#F8F8F2">{Embeds: discordEmbed}</span></span>
<span class="line"><span style="color:#F92672">	return</span><span style="color:#F8F8F2"> discordPayload</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"><span style="color:#F8F8F2"> </span></span></code></pre>
<p>This code is a Reddit scraper in Golang, which is a part of a project “finreddit”. It uses the geddit library for connecting to the Reddit API and retrieve submissions from given subreddit. The code filters the submissions based on various conditions such as minimum score, minimum comments, link flair text, and certain phrases. The filtered submissions are then appended to a CSV file. The code also includes a ScanSRs function, which reads subreddit configurations from a YAML file, logs into Reddit using OAuth authentication, and retrieves the submissions using the GetSubmissions function.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672"> package</span><span> </span><span style="color:#A6E22E;text-decoration:underline">csvs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">// csv utilties to prevent duplicate entries</span></span>
<span class="line"><span style="color:#88846F">// probably manually clear out every now and then</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> (</span></span>
<span class="line"><span style="color:#E6DB74">    "encoding/csv"</span></span>
<span class="line"><span style="color:#E6DB74">    "fmt"</span></span>
<span class="line"><span style="color:#E6DB74">    "os"</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">// read csv from file path</span></span>
<span class="line"><span style="color:#F92672">func</span><span style="color:#A6E22E"> ReadCsvFile</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">filePath</span><span style="color:#66D9EF;font-style:italic"> string</span><span style="color:#F8F8F2">) [][]</span><span style="color:#66D9EF;font-style:italic">string</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    f, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> os.</span><span style="color:#A6E22E">Open</span><span style="color:#F8F8F2">(filePath)</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        fmt.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"Unable to read input file "</span><span style="color:#F92672"> +</span><span style="color:#F8F8F2"> filePath, err)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F92672">    defer</span><span style="color:#F8F8F2"> f.</span><span style="color:#A6E22E">Close</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    csvReader </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> csv.</span><span style="color:#A6E22E">NewReader</span><span style="color:#F8F8F2">(f)</span></span>
<span class="line"><span style="color:#F8F8F2">    records, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> csvReader.</span><span style="color:#A6E22E">ReadAll</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        fmt.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"Unable to parse file as CSV for "</span><span style="color:#F92672"> +</span><span style="color:#F8F8F2"> filePath, err)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> records</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">func</span><span style="color:#A6E22E"> AppendRowToCsv</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">fileName</span><span style="color:#66D9EF;font-style:italic"> string</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">data</span><span style="color:#F8F8F2"> []</span><span style="color:#66D9EF;font-style:italic">string</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">    f, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> os.</span><span style="color:#A6E22E">OpenFile</span><span style="color:#F8F8F2">(fileName, os.O_WRONLY</span><span style="color:#F92672">|</span><span style="color:#F8F8F2">os.O_CREATE</span><span style="color:#F92672">|</span><span style="color:#F8F8F2">os.O_APPEND, </span><span style="color:#AE81FF">0644</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		fmt.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F92672">		return</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    w </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> csv.</span><span style="color:#A6E22E">NewWriter</span><span style="color:#F8F8F2">(f)</span></span>
<span class="line"><span style="color:#F8F8F2">    err </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> w.</span><span style="color:#A6E22E">Write</span><span style="color:#F8F8F2">(data)</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        fmt.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"Append Error"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        fmt.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    w.</span><span style="color:#A6E22E">Flush</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">// append rows to csvs</span></span>
<span class="line"><span style="color:#F92672">func</span><span style="color:#A6E22E"> AppendToCsv</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">fileName</span><span style="color:#66D9EF;font-style:italic"> string</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">data</span><span style="color:#F8F8F2"> [][]</span><span style="color:#66D9EF;font-style:italic">string</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">    f, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> os.</span><span style="color:#A6E22E">OpenFile</span><span style="color:#F8F8F2">(fileName, os.O_WRONLY</span><span style="color:#F92672">|</span><span style="color:#F8F8F2">os.O_CREATE</span><span style="color:#F92672">|</span><span style="color:#F8F8F2">os.O_APPEND, </span><span style="color:#AE81FF">0644</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		fmt.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F92672">		return</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">    w </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> csv.</span><span style="color:#A6E22E">NewWriter</span><span style="color:#F8F8F2">(f)</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> _, row</span><span style="color:#F92672">:=</span><span style="color:#F92672"> range</span><span style="color:#F8F8F2"> data {</span></span>
<span class="line"><span style="color:#F8F8F2">        err </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> w.</span><span style="color:#A6E22E">Write</span><span style="color:#F8F8F2">(row)</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            fmt.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"Append Error"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            fmt.</span><span style="color:#A6E22E">Println</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">	w.</span><span style="color:#A6E22E">Flush</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">// check if value exists in csv</span></span>
<span class="line"><span style="color:#F92672">func</span><span style="color:#A6E22E"> FindInCsv</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">filePath</span><span style="color:#66D9EF;font-style:italic"> string</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">searchValue</span><span style="color:#66D9EF;font-style:italic"> string</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">searchColumn</span><span style="color:#66D9EF;font-style:italic"> int</span><span style="color:#F8F8F2">) (</span><span style="color:#66D9EF;font-style:italic">bool</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">    records </span><span style="color:#F92672">:=</span><span style="color:#A6E22E"> ReadCsvFile</span><span style="color:#F8F8F2">(filePath)</span></span>
<span class="line"><span style="color:#F8F8F2">    foundValue </span><span style="color:#F92672">:=</span><span style="color:#AE81FF"> false</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> _, row</span><span style="color:#F92672">:=</span><span style="color:#F92672"> range</span><span style="color:#F8F8F2"> records {</span></span>
<span class="line"><span style="color:#F8F8F2">        valueInRow </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> row[searchColumn]</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#F8F8F2"> searchValue </span><span style="color:#F92672">==</span><span style="color:#F8F8F2"> valueInRow {</span></span>
<span class="line"><span style="color:#F8F8F2">            foundValue </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> true</span></span>
<span class="line"><span style="color:#F92672">            break</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> foundValue</span></span>
<span class="line"><span style="color:#F8F8F2">} </span></span></code></pre>
<p>This is a Go library for working with CSV (Comma Separated Values) files. It provides functions to read, append and check if a value exists in a CSV file.</p>
<ul>
<li><code>ReadCsvFile</code> reads a CSV file from the given file path and returns the data as a two-dimensional slice of strings.</li>
<li><code>AppendRowToCsv</code> appends a single row of data to the CSV file with the given file name.</li>
<li><code>AppendToCsv</code> appends multiple rows of data to the CSV file with the given file name.</li>
<li><code>FindInCsv</code> checks if a value exists in a specific column of the CSV file at the given file path. It returns a boolean indicating whether the value was found.</li>
</ul>
<p>A Discord webhook is a tool that allows you to send messages to a Discord channel from an external source. It is a URL that enables you to send messages to a specific Discord channel from your own website, application, or other platform. The messages appear as if they were sent by a user within Discord, but they are actually sent programmatically. This allows you to integrate Discord into your own systems, such as sending notifications, updates, or other automated messages.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672"> package</span><span> </span><span style="color:#A6E22E;text-decoration:underline">discord</span><span style="color:#F8F8F2"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> (</span></span>
<span class="line"><span style="color:#E6DB74">	"os"</span></span>
<span class="line"><span style="color:#E6DB74">	"log"</span></span>
<span class="line"><span style="color:#E6DB74">	"encoding/json"</span></span>
<span class="line"><span style="color:#E6DB74">	"net/http"</span></span>
<span class="line"><span style="color:#E6DB74">	"github.com/dli-invest/finreddit/pkg/types"</span></span>
<span class="line"><span style="color:#E6DB74">	"bytes"</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">func</span><span style="color:#A6E22E"> SendWebhook</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">discordWebhook</span><span> </span><span style="color:#A6E22E;text-decoration:underline">types</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">DiscordPayload</span><span style="color:#F8F8F2">) (</span><span style="color:#F92672">*</span><span style="color:#A6E22E;text-decoration:underline">http</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Response</span><span style="color:#F8F8F2">, </span><span style="color:#66D9EF;font-style:italic">error</span><span style="color:#F8F8F2">){</span></span>
<span class="line"><span style="color:#F8F8F2">	discordUrl </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> os.</span><span style="color:#A6E22E">Getenv</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"DISCORD_WEBHOOK"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> discordUrl </span><span style="color:#F92672">==</span><span style="color:#E6DB74"> ""</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		log.</span><span style="color:#A6E22E">Fatal</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"DISCORD_WEBHOOK not set"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">	webhookData, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> json.</span><span style="color:#A6E22E">Marshal</span><span style="color:#F8F8F2">(discordWebhook)</span></span>
<span class="line"><span style="color:#F92672">	if</span><span style="color:#F8F8F2"> err </span><span style="color:#F92672">!=</span><span style="color:#AE81FF"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">		log.</span><span style="color:#A6E22E">Fatal</span><span style="color:#F8F8F2">(err)</span></span>
<span class="line"><span style="color:#F8F8F2">	}</span></span>
<span class="line"><span style="color:#F8F8F2">	resp, err </span><span style="color:#F92672">:=</span><span style="color:#F8F8F2"> http.</span><span style="color:#A6E22E">Post</span><span style="color:#F8F8F2">(discordUrl, </span><span style="color:#E6DB74">"application/json"</span><span style="color:#F8F8F2">, bytes.</span><span style="color:#A6E22E">NewBuffer</span><span style="color:#F8F8F2">(webhookData))</span></span>
<span class="line"><span style="color:#F92672">	return</span><span style="color:#F8F8F2"> resp, err</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"><span style="color:#F8F8F2"> </span></span></code></pre>
<p>This is a Go function named “SendWebhook” that posts a Discord webhook to a specified Discord channel. The Discord webhook URL is obtained from an environment variable named “DISCORD_WEBHOOK”. The input to the function is a DiscordPayload of type “types.DiscordPayload” and contains the data to be sent in the webhook. The function then uses the “json” package to marshal the input into a JSON string, and the “http” package to send a HTTP POST request to the Discord webhook URL with the JSON string as the payload. The response from the POST request and any error are returned from the function.</p>
<p>GitHub Actions allows you to automate tasks such as building, testing, and deploying code. It also supports automating tasks to run on a schedule using workflows. You can create a workflow that runs on a schedule using the “schedule” trigger in your workflow file.</p>
<p>Here’s an example of a workflow that runs every day at 8pm UTC:</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672">name</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">Schedule Task</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AE81FF">on</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672"> schedule</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2"> - </span><span style="color:#F92672">cron</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">'0 20 \* \* \*'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">jobs</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672"> task</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672"> runs-on</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">ubuntu-latest</span></span>
<span class="line"><span style="color:#F92672"> steps</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2"> - </span><span style="color:#F92672">name</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">Run Task</span></span>
<span class="line"><span style="color:#F92672"> run</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">echo "Running Task on Schedule"</span></span></code></pre>
<p>This workflow specifies that it should run on a schedule using the <code>schedule</code> trigger and the <code>cron</code> value of <code>0 20 * * *</code>. The <code>cron</code> value represents a standard cron syntax that specifies the schedule. In this case, it runs every day at 8pm UTC.</p>
<p>You can add additional steps in the <code>steps</code> section to perform any other tasks you need to automate. You can also use environment variables in your workflow to pass in any required information, such as API keys or file paths.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#AE81FF"> on</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">  schedule</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#88846F">    # * is a special character in YAML so you have to quote this string</span></span>
<span class="line"><span style="color:#F8F8F2">    - </span><span style="color:#F92672">cron</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">'50 * * * *'</span></span>
<span class="line"><span style="color:#F92672">  push</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">    branches</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">      - </span><span style="color:#E6DB74">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">env</span><span style="color:#F8F8F2">: </span></span>
<span class="line"><span style="color:#F92672">  REDDIT_CLIENT_ID</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">${{ secrets.REDDIT_CLIENT_ID }}</span></span>
<span class="line"><span style="color:#F92672">  REDDIT_CLIENT_SECRET</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">${{ secrets.REDDIT_CLIENT_SECRET }}</span></span>
<span class="line"><span style="color:#F92672">  REDDIT_PASSWORD</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">${{ secrets.REDDIT_PASSWORD }}</span></span>
<span class="line"><span style="color:#F92672">  REDDIT_USERNAME</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">${{ secrets.REDDIT_USERNAME }}</span></span>
<span class="line"><span style="color:#F92672">  DISCORD_WEBHOOK</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">${{ secrets.DISCORD_REDDIT_WEBHOOK}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">name</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">Send Updates</span></span>
<span class="line"><span style="color:#F92672">jobs</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">  run</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">    strategy</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">      matrix</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">        go-version</span><span style="color:#F8F8F2">: [</span><span style="color:#E6DB74">1.15.x</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F92672">        platform</span><span style="color:#F8F8F2">: [</span><span style="color:#E6DB74">ubuntu-latest</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F92672">    runs-on</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">${{ matrix.platform }}</span></span>
<span class="line"><span style="color:#F92672">    steps</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">    - </span><span style="color:#F92672">name</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">Install Go</span></span>
<span class="line"><span style="color:#F92672">      if</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">success()</span></span>
<span class="line"><span style="color:#F92672">      uses</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">actions/setup-go@v2</span></span>
<span class="line"><span style="color:#F92672">      with</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">        go-version</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">${{ matrix.go-version }}</span></span>
<span class="line"><span style="color:#F8F8F2">    - </span><span style="color:#F92672">name</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">Checkout code</span></span>
<span class="line"><span style="color:#F92672">      uses</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">actions/checkout@v2</span></span>
<span class="line"><span style="color:#F8F8F2">    - </span><span style="color:#F92672">name</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">Run job</span></span>
<span class="line"><span style="color:#F92672">      run</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">go run cmd/scan_sr/manga.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    - </span><span style="color:#F92672">name</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">Commit files</span></span>
<span class="line"><span style="color:#F92672">      id</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">commit</span></span>
<span class="line"><span style="color:#F92672">      run</span><span style="color:#F8F8F2">: </span><span style="color:#F92672">|</span></span>
<span class="line"><span style="color:#E6DB74">        git config --local user.email "action@github.com"</span></span>
<span class="line"><span style="color:#E6DB74">        git config --local user.name "GitHub Action"</span></span>
<span class="line"><span style="color:#E6DB74">        git add internal/*.csv</span></span>
<span class="line"><span style="color:#E6DB74">        git commit -m "Updating csv"</span></span>
<span class="line"><span style="color:#F92672">      continue-on-error</span><span style="color:#F8F8F2">: </span><span style="color:#AE81FF">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    - </span><span style="color:#F92672">name</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">Push changes</span></span>
<span class="line"><span style="color:#F92672">      uses</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">ad-m/github-push-action@master</span></span>
<span class="line"><span style="color:#F92672">      continue-on-error</span><span style="color:#F8F8F2">: </span><span style="color:#AE81FF">true</span></span>
<span class="line"><span style="color:#F92672">      with</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">        github_token</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="color:#F92672">        branch</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">${{ github.ref }}</span></span>
<span class="line"><span style="color:#F8F8F2"> </span></span></code></pre>
<p>This code is a GitHub Actions workflow that automates the task of sending updates. The schedule of the task is set to run every hour at 50 minutes past the hour, and it will only run when the main branch is pushed.</p>
<p>The workflow sets environment variables for Reddit API credentials (client ID, client secret, password, and username) and a Discord webhook URL, all of which are stored as GitHub secrets.</p>
<p>The job runs on an Ubuntu latest machine and uses Go version 1.15.x. The job checks out the code, runs the scan_sr/manga.go script, and if successful, commits the updated csv files to the repository and pushes the changes. The action uses a GitHub push action to push the changes.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://github.com/dli-invest/finreddit">https://github.com/dli-invest/finreddit</a></li>
<li><a href="https://pkg.go.dev/github.com/dli-invest/finreddit">https://pkg.go.dev/github.com/dli-invest/finreddit</a></li>
</ul> <h5>Related Projects</h5> <a href="https://github.com/dli-invest/finreddit" style="text-decoration:none;width:200px;text-align:center"> <h3> <div class="rounded-md px-2 py-1 text-xs font-semibold undefined">finreddit</div> </h3> </a> </content></div></div></div></div> <div class="mx-auto max-w-screen-lg px-3 py-6"> <div class="no-print flex w-full"> <form class="max-w-lg" action="https://formspree.io/f/davidli012345@gmail.com" method="POST"><div class="-mx-3 mb-6 flex flex-wrap"><div class="mb-6 w-full px-3 md:mb-0 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-first-name">First Name</label><input class="mb-3 block w-full appearance-none rounded py-3 px-4 leading-tight text-gray-700 focus:bg-white focus:outline-none" id="grid-first-name" type="text" placeholder="Jane"/></div><div class="w-full px-3 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-last-name">Last Name</label><input class="block w-full appearance-none rounded border border-gray-200  py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="grid-last-name" type="text" placeholder="Doe"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">E-mail</label><input class="mb-3 block w-full appearance-none rounded border py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="email" type="email"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">Message</label><textarea class="no-resize mb-3 block h-48 w-full resize-none appearance-none rounded border border-gray-200 py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="message"></textarea></div></div><div class="md:flex md:items-center"><div class="md:w-1/3"><button class="ml-2 shrink-0 rounded-full bg-gradient-to-br from-sky-500 to-cyan-400 px-3 py-1 text-sm font-medium text-gray-700 hover:from-sky-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-600/50" type="submit">Send</button></div><div class="md:w-2/3"></div></div></form> <div class="ml-3 max-w-lg bg-slate-300"> <link href="/_pagefind/pagefind-ui.css" rel="stylesheet"> <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script> <div id="search" class="ml-3 p-4"></div>  </div> </div> </div>  </div> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="no-print border-t border-gray-600 pt-5"><div class="text-sm text-gray-200">© Copyright <!-- -->2024<!-- --> by <!-- -->FriendlyUsers Tech Blog<!-- -->. Built with ♥ by<!-- --> <a class="text-cyan-400 hover:underline" href="https://github.com/FriendlyUser" target="_blank" rel="noopener noreferrer">FriendlyUser</a>. Last updated on <!-- -->2024-12-12<!-- -->.</div></div><script src="https://cdn.botpress.cloud/webchat/v0/inject.js"></script><script src="https://mediafiles.botpress.cloud/0df54034-3318-451a-aed0-3923a4ee25a5/webchat/config.js" defer=""></script></div> </body></html>