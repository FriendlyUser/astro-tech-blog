<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- Primary Meta Tags -->
<title>Extracting types automatically from typescript-axios openapi generator</title>
<meta name="title" content="Extracting types automatically from typescript-axios openapi generator">
<meta name="description" content="My Thoughts on what todo with jcenter/bintray going down.">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url">
<meta property="og:title" content="Extracting types automatically from typescript-axios openapi generator">
<meta property="og:description" content="My Thoughts on what todo with jcenter/bintray going down.">
<meta property="og:image" content="https://astro.build/social.png?v=1">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url">
<meta property="twitter:title" content="Extracting types automatically from typescript-axios openapi generator">
<meta property="twitter:description" content="My Thoughts on what todo with jcenter/bintray going down.">
<meta property="twitter:image" content="https://astro.build/social.png?v=1">

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&family=IBM+Plex+Sans:wght@400;700&display=swap">

    <link rel="stylesheet" href="../styles/blog.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6"></script>
  <link rel="stylesheet" href="/assets/asset.a9c392e8.css"></link><script type="module" src="/entry.701f7b449.js" astro-script="/posts/extracting_types_from_openapi/script-0"></script>
</head>

  <body>
    

<header class="wrapper astro-ETUIJHWM">
  <article class="astro-ETUIJHWM">
    <h3 class="astro-ETUIJHWM">
      <a href="/astro-tech-blog" class="astro-ETUIJHWM">
        <svg class="logo astro-ETUIJHWM" width="32" height="32" viewBox="0 0 256 256" fill="none" xmlns="http://www.w3.org/2000/svg">
          <style>
            #flame {
              fill: #ff5d01;
            }
            #a {
              fill: #000014;
            }
          </style>
          <title>Logo</title>
          <path id="a" fill-rule="evenodd" clip-rule="evenodd" d="M163.008 18.929c1.944 2.413 2.935 5.67 4.917 12.181l43.309 142.27a180.277 180.277 0 00-51.778-17.53l-28.198-95.29a3.67 3.67 0 00-7.042.01l-27.857 95.232a180.225 180.225 0 00-52.01 17.557l43.52-142.281c1.99-6.502 2.983-9.752 4.927-12.16a15.999 15.999 0 016.484-4.798c2.872-1.154 6.271-1.154 13.07-1.154h31.085c6.807 0 10.211 0 13.086 1.157a16.004 16.004 0 016.487 4.806z" class="astro-ETUIJHWM"></path>
          <path id="flame" fill-rule="evenodd" clip-rule="evenodd" d="M168.19 180.151c-7.139 6.105-21.39 10.268-37.804 10.268-20.147 0-37.033-6.272-41.513-14.707-1.602 4.835-1.961 10.367-1.961 13.902 0 0-1.056 17.355 11.015 29.426 0-6.268 5.081-11.349 11.349-11.349 10.743 0 10.731 9.373 10.721 16.977v.679c0 11.542 7.054 21.436 17.086 25.606a23.27 23.27 0 01-2.339-10.2c0-11.008 6.463-15.107 13.974-19.87 5.976-3.79 12.616-8.001 17.192-16.449a31.024 31.024 0 003.743-14.82c0-3.299-.513-6.479-1.463-9.463z" class="astro-ETUIJHWM"></path>
        </svg>
        <span class="astro-ETUIJHWM">My Blog</span>
      </a>
    </h3>
    <a href="/about" class="astro-ETUIJHWM">
      About Me
    </a> &nbsp; &nbsp;
    <div class="navbar-right-item astro-ETUIJHWM">
		<svg fill="#000000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30px" height="30px" class="astro-ETUIJHWM"><path d="M 13 3 C 7.4889971 3 3 7.4889971 3 13 C 3 18.511003 7.4889971 23 13 23 C 15.396508 23 17.597385 22.148986 19.322266 20.736328 L 25.292969 26.707031 A 1.0001 1.0001 0 1 0 26.707031 25.292969 L 20.736328 19.322266 C 22.148986 17.597385 23 15.396508 23 13 C 23 7.4889971 18.511003 3 13 3 z M 13 5 C 17.430123 5 21 8.5698774 21 13 C 21 17.430123 17.430123 21 13 21 C 8.5698774 21 5 17.430123 5 13 C 5 8.5698774 8.5698774 5 13 5 z" class="astro-ETUIJHWM"></path></svg> &nbsp;
     <a href="/search" class="astro-ETUIJHWM">
        Search
      </a>
    </div>
  </article>
</header>
    <div class="wrapper">
      <!-- <a href={window.location.href}>
        <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 30 30" width="30px" height="30px"><path d="M 23 3 A 4 4 0 0 0 19 7 A 4 4 0 0 0 19.09375 7.8359375 L 10.011719 12.376953 A 4 4 0 0 0 7 11 A 4 4 0 0 0 3 15 A 4 4 0 0 0 7 19 A 4 4 0 0 0 10.013672 17.625 L 19.089844 22.164062 A 4 4 0 0 0 19 23 A 4 4 0 0 0 23 27 A 4 4 0 0 0 27 23 A 4 4 0 0 0 23 19 A 4 4 0 0 0 19.986328 20.375 L 10.910156 15.835938 A 4 4 0 0 0 11 15 A 4 4 0 0 0 10.90625 14.166016 L 19.988281 9.625 A 4 4 0 0 0 23 11 A 4 4 0 0 0 27 7 A 4 4 0 0 0 23 3 z"/></svg> 
          Share
      </a>   -->
      <div class="layout astro-FTYJ6LBH">
	<article class="content astro-FTYJ6LBH">
		<div class="astro-FTYJ6LBH">
			<header class="astro-FTYJ6LBH">
				
				<p class="publish-date astro-FTYJ6LBH"></p>
				<h1 class="title astro-FTYJ6LBH">Extracting types automatically from typescript-axios openapi generator</h1>
				<div class="author astro-KO5QTRDP">
	<p class="astro-KO5QTRDP"><a href="https://friendlyuser.github.io" class="astro-KO5QTRDP">@FriendlyUser</a></p>
</div>



				<div class="tag-list astro-FTYJ6LBH">
					<span class="bg-yellow-100 text-yellow-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded dark:bg-yellow-200 dark:text-yellow-800 astro-FTYJ6LBH"><a href="/tags/openapi" class="astro-FTYJ6LBH">openapi</a></span>
					</div>
			</header>
			<main class="astro-FTYJ6LBH">
				<h1 id="summary">Summary</h1><p>An OpenAPI file allows you to describe your entire API and as a result automatically produce clients to interact with them.</p><p>Previously, the implementation of the openapi client was poor as types were missing and inconsistent. Since then, the typing has been fixed, but in the meanwhile I shall go over my code to extract types from the outputted files.</p><p>First we read the produced api file, go through line by line, for typescript/javascript, the types will be annotated with the keyword export. Since we are only looking for types we can ignore any functions or async calls.</p><p>We also ignore any comments and perform brace matching in order to know when a type ends.</p><p>With all this information we can extract all the lines that has types and move them into another file.</p><h2 id="full-source-code">Full Source Code</h2><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">with</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">open</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;api.ts&#39;</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">as</span><span style="color: #C9D1D9"> f:</span></span>
<span class="line"><span style="color: #C9D1D9">    lines </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> f.readlines()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E"># scan for export interface and export type</span></span>
<span class="line"><span style="color: #C9D1D9">type_start </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span></span>
<span class="line"><span style="color: #C9D1D9">found_export </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">False</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">type_start_line </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">None</span></span>
<span class="line"><span style="color: #C9D1D9">type_end_line </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">None</span></span>
<span class="line"><span style="color: #C9D1D9">matches </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> []</span></span>
<span class="line"><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">range</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">len</span><span style="color: #C9D1D9">(lines)):</span></span>
<span class="line"><span style="color: #C9D1D9">    line </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> lines[i]</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E"># make sure this isnt a comment </span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;@&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">and</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;*&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> line:</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">continue</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E"># ignore anything with function or async</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;function&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> line </span><span style="color: #FF7B72">or</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;async&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> line:</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">continue</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> type_start_line </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">not</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">None</span><span style="color: #C9D1D9">:</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;}&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> line:</span></span>
<span class="line"><span style="color: #C9D1D9">            type_end_line </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> i</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #8B949E"># append entry to matches</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #8B949E"># get all rows from type_start_line to type_end_line</span></span>
<span class="line"><span style="color: #C9D1D9">            matches.append({</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #A5D6FF">&quot;type_start&quot;</span><span style="color: #C9D1D9">: type_start_line,</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #A5D6FF">&quot;type_end&quot;</span><span style="color: #C9D1D9">: type_end_line,</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #A5D6FF">&quot;data&quot;</span><span style="color: #C9D1D9">: lines[type_start_line:type_end_line</span><span style="color: #FF7B72">+</span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">]</span></span>
<span class="line"><span style="color: #C9D1D9">            })</span></span>
<span class="line"><span style="color: #C9D1D9">            type_start_line </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">None</span></span>
<span class="line"><span style="color: #C9D1D9">            type_end_line </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">None</span></span>
<span class="line"><span style="color: #C9D1D9">            found_export </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">False</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">continue</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;export&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> line:</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;class&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> line:</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">pass</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;interface&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> line:</span></span>
<span class="line"><span style="color: #C9D1D9">            type_start </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> i</span></span>
<span class="line"><span style="color: #C9D1D9">            found_export </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">True</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;type&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> line:</span></span>
<span class="line"><span style="color: #C9D1D9">            type_start </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> i</span></span>
<span class="line"><span style="color: #C9D1D9">            found_export </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">True</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;const&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> line:</span></span>
<span class="line"><span style="color: #C9D1D9">            type_start </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> i</span></span>
<span class="line"><span style="color: #C9D1D9">            found_export </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">True</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> found_export:</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;{&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> line:</span></span>
<span class="line"><span style="color: #C9D1D9">                type_start_line </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> i</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9">:</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #8B949E"># no brace found, so we are at the end of the type</span></span>
<span class="line"><span style="color: #C9D1D9">                matches.append({</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #A5D6FF">&#39;type_start&#39;</span><span style="color: #C9D1D9">: type_start,</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #A5D6FF">&#39;type_end&#39;</span><span style="color: #C9D1D9">: type_start,</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #A5D6FF">&#39;data&#39;</span><span style="color: #C9D1D9">: line,</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #A5D6FF">&#39;line_no&#39;</span><span style="color: #C9D1D9">: i</span></span>
<span class="line"><span style="color: #C9D1D9">                })</span></span>
<span class="line"><span style="color: #C9D1D9">                found_export </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">False</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">print</span><span style="color: #C9D1D9">(matches)</span></span>
<span class="line"><span style="color: #8B949E"># check for braces in line</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E"># write output of types to file overmind/types/oaClientTypes.ts</span></span>
<span class="line"><span style="color: #FF7B72">with</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">open</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;clientTypes.ts&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;w&#39;</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">as</span><span style="color: #C9D1D9"> f:</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> match </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> matches:</span></span>
<span class="line"><span style="color: #C9D1D9">        f.write(</span><span style="color: #A5D6FF">&quot;&quot;</span><span style="color: #C9D1D9">.join(match[</span><span style="color: #A5D6FF">&#39;data&#39;</span><span style="color: #C9D1D9">]))</span></span>
<span class="line"><span style="color: #C9D1D9">        f.write(</span><span style="color: #A5D6FF">&quot;</span><span style="color: #79C0FF">\n</span><span style="color: #A5D6FF">&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"></span></code></pre><br>
Future improvements could include
<ul>
<li>generalization to extract functions and classes</li>
<li>porting comments over as well</li>
</ul>
			</main>
		</div>
	</article>
</div>



    </div>
  </body></html>