<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- Primary Meta Tags -->
<title>Flutter Remove background from image web app Part I</title>
<meta name="title" content="Flutter Remove background from image web app Part I">
<meta name="description" content="Web app / mobile app that allows the user to download an image after the remove.bg api has been applied.">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url">
<meta property="og:title" content="Flutter Remove background from image web app Part I">
<meta property="og:description" content="Web app / mobile app that allows the user to download an image after the remove.bg api has been applied.">
<meta property="og:image" content="https://astro.build/social.png?v=1">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url">
<meta property="twitter:title" content="Flutter Remove background from image web app Part I">
<meta property="twitter:description" content="Web app / mobile app that allows the user to download an image after the remove.bg api has been applied.">
<meta property="twitter:image" content="https://astro.build/social.png?v=1">

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&family=IBM+Plex+Sans:wght@400;700&display=swap">

    <link rel="stylesheet" href="../styles/blog.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6"></script>
  <link rel="stylesheet" href="/assets/asset.4e560fdc.css"></link><script type="module" src="/entry.701f7b449.js" astro-script="/posts/remove_background_from_image/script-0"></script>
</head>

  <body>
    

<header class="wrapper astro-RL6NTRP6">
  <article class="astro-RL6NTRP6">
    <h1 class="astro-RL6NTRP6">
      <a href="/astro-tech-blog" class="astro-RL6NTRP6">
        <svg class="logo astro-RL6NTRP6" width="32" height="32" viewBox="0 0 256 256" fill="none" xmlns="http://www.w3.org/2000/svg">
          <style>
            #flame {
              fill: #ff5d01;
            }
            #a {
              fill: #000014;
            }
          </style>
          <title>Logo</title>
          <path id="a" fill-rule="evenodd" clip-rule="evenodd" d="M163.008 18.929c1.944 2.413 2.935 5.67 4.917 12.181l43.309 142.27a180.277 180.277 0 00-51.778-17.53l-28.198-95.29a3.67 3.67 0 00-7.042.01l-27.857 95.232a180.225 180.225 0 00-52.01 17.557l43.52-142.281c1.99-6.502 2.983-9.752 4.927-12.16a15.999 15.999 0 016.484-4.798c2.872-1.154 6.271-1.154 13.07-1.154h31.085c6.807 0 10.211 0 13.086 1.157a16.004 16.004 0 016.487 4.806z" class="astro-RL6NTRP6"></path>
          <path id="flame" fill-rule="evenodd" clip-rule="evenodd" d="M168.19 180.151c-7.139 6.105-21.39 10.268-37.804 10.268-20.147 0-37.033-6.272-41.513-14.707-1.602 4.835-1.961 10.367-1.961 13.902 0 0-1.056 17.355 11.015 29.426 0-6.268 5.081-11.349 11.349-11.349 10.743 0 10.731 9.373 10.721 16.977v.679c0 11.542 7.054 21.436 17.086 25.606a23.27 23.27 0 01-2.339-10.2c0-11.008 6.463-15.107 13.974-19.87 5.976-3.79 12.616-8.001 17.192-16.449a31.024 31.024 0 003.743-14.82c0-3.299-.513-6.479-1.463-9.463z" class="astro-RL6NTRP6"></path>
        </svg>
        <span class="astro-RL6NTRP6">My Blog</span>
      </a>
    </h1>
    <a href="/about" class="astro-RL6NTRP6">
      About Me
    </a> &nbsp; &nbsp;
    <div class="navbar-right-item astro-RL6NTRP6">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="astro-RL6NTRP6"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" class="astro-RL6NTRP6"></path></svg> &nbsp;
     <a href="https://github.com/FriendlyUser" class="astro-RL6NTRP6">
        Github
      </a>
    </div>
  </article>
</header>
    <div class="wrapper">
      <!-- <a href={window.location.href}>
        <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 30 30" width="30px" height="30px"><path d="M 23 3 A 4 4 0 0 0 19 7 A 4 4 0 0 0 19.09375 7.8359375 L 10.011719 12.376953 A 4 4 0 0 0 7 11 A 4 4 0 0 0 3 15 A 4 4 0 0 0 7 19 A 4 4 0 0 0 10.013672 17.625 L 19.089844 22.164062 A 4 4 0 0 0 19 23 A 4 4 0 0 0 23 27 A 4 4 0 0 0 27 23 A 4 4 0 0 0 23 19 A 4 4 0 0 0 19.986328 20.375 L 10.910156 15.835938 A 4 4 0 0 0 11 15 A 4 4 0 0 0 10.90625 14.166016 L 19.988281 9.625 A 4 4 0 0 0 23 11 A 4 4 0 0 0 27 7 A 4 4 0 0 0 23 3 z"/></svg> 
          Share
      </a>   -->
      <div class="layout astro-RIREK42R">
	<article class="content astro-RIREK42R">
		<div class="astro-RIREK42R">
			<header class="astro-RIREK42R">
				
				<p class="publish-date astro-RIREK42R"></p>
				<h1 class="title astro-RIREK42R">Flutter Remove background from image web app Part I</h1>
				<div class="author astro-KO5QTRDP">
	<p class="astro-KO5QTRDP"><a href="https://friendlyuser.github.io" class="astro-KO5QTRDP">@FriendlyUser</a></p>
</div>



				<div class="tag-list astro-RIREK42R">
					<span class="bg-black-100 text-black-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded dark:bg-black-200 dark:text-black-800 astro-RIREK42R"><p href="/tags/flutter" class="astro-RIREK42R">flutter</p></span>
					</div>
			</header>
			<main class="astro-RIREK42R">
				<p>Full code for this post can be seen at <a href="https://github.com/FriendlyUser/remove_bg_flutter_app/tree/483074e626afb9118213a5942bcfac1e3cbb6493">github</a>.</p><p>In order to familarize myself with flutter, I decided to create a flutter 3 project that allowed me to remove background images from photos.</p><p>Using the excellent remove bg api (limit to 50 api calls a month for free tier), I can simply send an image over and then display it to the user.</p><p>Due to my lack of familarity with the flutter ecosystem, I ran into a number of issues.</p><p>The first one is due to the <code>dio</code> http library in flutter. Calling the remove.bg api returns a file in bytes, but unless you specific bytes in the http request, you get a string that cannot be used for anything/.</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> formData </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FormData</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> dio </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Dio</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// flutter add api token</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// hardcoded free access token</span></span>
<span class="line"><span style="color: #C9D1D9">    dio.options.headers[</span><span style="color: #A5D6FF">&quot;X-Api-Key&quot;</span><span style="color: #C9D1D9">] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;&lt;API_KEY&gt;&quot;</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">try</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (kIsWeb) {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> _bytes </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> image.</span><span style="color: #D2A8FF">readAsBytes</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">        formData.files.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">MapEntry</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #A5D6FF">&quot;image_file&quot;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #79C0FF">MultipartFile</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromBytes</span><span style="color: #C9D1D9">(_bytes, filename</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;pic-name.png&quot;</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">        ));</span></span>
<span class="line"><span style="color: #C9D1D9">      } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        formData.files.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">MapEntry</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #A5D6FF">&quot;image_file&quot;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">MultipartFile</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromFile</span><span style="color: #C9D1D9">(image.path, filename</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;pic-name.png&quot;</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">        ));</span></span>
<span class="line"><span style="color: #C9D1D9">      }</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">Response</span><span style="color: #C9D1D9">&lt;</span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&lt;</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">&gt;&gt; response </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> dio.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #A5D6FF">&quot;https://api.remove.bg/v1.0/removebg&quot;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">          data</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> formData,</span></span>
<span class="line"><span style="color: #C9D1D9">          options</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Options</span><span style="color: #C9D1D9">(responseType</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ResponseType</span><span style="color: #C9D1D9">.bytes));</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> response.data;</span></span></code></pre><p>The remove.bg api expects form_data with the property image data.</p><p>For the dio http client</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">Response</span><span style="color: #C9D1D9">&lt;</span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&lt;</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">&gt;&gt; response </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> dio.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #A5D6FF">&quot;https://api.remove.bg/v1.0/removebg&quot;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">          data</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> formData,</span></span>
<span class="line"><span style="color: #C9D1D9">          options</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Options</span><span style="color: #C9D1D9">(responseType</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ResponseType</span><span style="color: #C9D1D9">.bytes));</span></span></code></pre><p>you must specific the response type for images otherwise you will get a messed up binary encoded string that is difficult to interact with.</p><p>This causes issues and crashes with the loaded image, very difficult to debug, might have been easier with more knowledge of flutter and knowing how and where to track errors.</p><p>One additional feature of interest is the download logic. <code>dart:io</code> is not supported on web, as a result I needed to have a reach around for the download logic, in case the anchor element is throwing error for mobile complication I will need to conditionally render it based on the situtation or use a dynamic import only for web.</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">              downloadButton </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _html.</span><span style="color: #79C0FF">AnchorElement</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                href</span><span style="color: #FF7B72">:</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #A5D6FF">&quot;$</span><span style="color: #79C0FF">header</span><span style="color: #A5D6FF">,$</span><span style="color: #79C0FF">base64String</span><span style="color: #A5D6FF">&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">              ..</span><span style="color: #D2A8FF">setAttribute</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;download&quot;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&quot;file.png&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">              ..</span><span style="color: #D2A8FF">click</span><span style="color: #C9D1D9">()</span></span></code></pre><p>Overall adapting the flutter code to the web is a bit of a challenge, but I am confident that I have a solid foundation to build upon.</p><p>See <a href="https://docs.flutter.dev/cookbook/plugins/picture-using-camera">https://docs.flutter.dev/cookbook/plugins/picture-using-camera</a> for more details.</p><p>For those interested, I have added a github action to automatically deploy to the github pages website.</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">name</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Flutter</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Web</span></span>
<span class="line"><span style="color: #FF7B72">on:</span></span>
<span class="line"><span style="color: #C9D1D9">  push</span><span style="color: #FF7B72">:</span></span>
<span class="line"><span style="color: #C9D1D9">    branches</span><span style="color: #FF7B72">:</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">jobs</span><span style="color: #FF7B72">:</span></span>
<span class="line"><span style="color: #C9D1D9">  build</span><span style="color: #FF7B72">:</span></span>
<span class="line"><span style="color: #C9D1D9">    name</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Build</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Web</span></span>
<span class="line"><span style="color: #C9D1D9">    env</span><span style="color: #FF7B72">:</span></span>
<span class="line"><span style="color: #C9D1D9">      my_secret</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> ${{secrets.commit_secret}}</span></span>
<span class="line"><span style="color: #C9D1D9">    runs</span><span style="color: #FF7B72">-on:</span><span style="color: #C9D1D9"> ubuntu</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">latest</span></span>
<span class="line"><span style="color: #C9D1D9">    steps</span><span style="color: #FF7B72">:</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> uses</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> actions</span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9">checkout</span><span style="color: #FF7B72">@v</span><span style="color: #C9D1D9">1</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> uses</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> subosito</span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9">flutter</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">action</span><span style="color: #FF7B72">@v</span><span style="color: #C9D1D9">2</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">with:</span></span>
<span class="line"><span style="color: #C9D1D9">          flutter</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">version</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;3.0.3&#39;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> run</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> flutter pub </span><span style="color: #FF7B72">get</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> run</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> flutter build web </span><span style="color: #FF7B72">--</span><span style="color: #C9D1D9">release</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> name</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Deploy</span><span style="color: #C9D1D9"> 🚀</span></span>
<span class="line"><span style="color: #C9D1D9">        uses</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">JamesIves</span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9">github</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">pages</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">deploy</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">action</span><span style="color: #FF7B72">@v</span><span style="color: #C9D1D9">4</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">with:</span></span>
<span class="line"><span style="color: #C9D1D9">          branch</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> gh</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">pages # </span><span style="color: #79C0FF">The</span><span style="color: #C9D1D9"> branch the action should deploy to.</span></span>
<span class="line"><span style="color: #C9D1D9">          folder</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> build</span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9">web # </span><span style="color: #79C0FF">The</span><span style="color: #C9D1D9"> folder the action should deploy.</span></span></code></pre><p>This action will build web for flutter 3.0.3 and then deploy it to the branch that will be displayed on github pages.</p><p>In order to have platform specific implementations, the best way is to have nested imports</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;package:rm_img_bg/download_button_main.dart&#39;</span></span>
<span class="line"><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (dart.library.html) </span><span style="color: #A5D6FF">&#39;package:rm_img_bg/download_button_web.dart&#39;</span><span style="color: #C9D1D9">;</span></span></code></pre><p>Make sure the functions and classes are defined the same</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;package:flutter/material.dart&#39;</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;dart:convert&#39;</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;dart:html&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">as</span><span style="color: #C9D1D9"> _html;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;dart:typed_data&#39;</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">DownloadButtonProps</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&lt;</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">&gt; imageInBytes;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">DownloadButtonProps</span><span style="color: #C9D1D9">({ </span><span style="color: #FF7B72">required</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.imageInBytes});</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">DownloadButton</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatelessWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">DownloadButtonProps</span><span style="color: #C9D1D9"> data;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">DownloadButton</span><span style="color: #C9D1D9">({</span><span style="color: #79C0FF">Key</span><span style="color: #FF7B72">?</span><span style="color: #C9D1D9"> key, </span><span style="color: #FF7B72">required</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.data})</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(key</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> key);</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">String</span><span style="color: #C9D1D9"> base64String </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">base64Encode</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Uint8List</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromList</span><span style="color: #C9D1D9">(data.imageInBytes));</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">String</span><span style="color: #C9D1D9"> header </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&quot;data:image/png;base64&quot;</span><span style="color: #C9D1D9">; </span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ElevatedButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// saveFile(uploadedImage.toString())</span></span>
<span class="line"><span style="color: #C9D1D9">          {</span></span>
<span class="line"><span style="color: #C9D1D9">            _html.</span><span style="color: #79C0FF">AnchorElement</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              href</span><span style="color: #FF7B72">:</span></span>
<span class="line"><span style="color: #C9D1D9">                  </span><span style="color: #A5D6FF">&quot;$</span><span style="color: #79C0FF">header</span><span style="color: #A5D6FF">,$</span><span style="color: #79C0FF">base64String</span><span style="color: #A5D6FF">&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">            ..</span><span style="color: #D2A8FF">setAttribute</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;download&quot;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&quot;file.png&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">            ..</span><span style="color: #D2A8FF">click</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">      },</span></span>
<span class="line"><span style="color: #C9D1D9">      child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Text</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Save File&quot;</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre><p>This is my initial logic for the mobile download button, will be fleshed out in part II.</p><p>Right now it only works on web, but I am working on a mobile implementation.</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;package:flutter/material.dart&#39;</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">DownloadButtonProps</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&lt;</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">&gt; imageInBytes;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">DownloadButtonProps</span><span style="color: #C9D1D9">({ </span><span style="color: #FF7B72">required</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.imageInBytes});</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">DownloadButton</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatelessWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">DownloadButtonProps</span><span style="color: #C9D1D9"> data;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">DownloadButton</span><span style="color: #C9D1D9">({</span><span style="color: #79C0FF">Key</span><span style="color: #FF7B72">?</span><span style="color: #C9D1D9"> key, </span><span style="color: #FF7B72">required</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.data})</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(key</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> key);</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ElevatedButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// saveFile(uploadedImage.toString())</span></span>
<span class="line"><span style="color: #C9D1D9">          {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #D2A8FF">print</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;DO SOMETHING HERE&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">      },</span></span>
<span class="line"><span style="color: #C9D1D9">      child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Text</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;Save File&quot;</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre><p>Next post is available at <a href="/posts/remove_background_from_image_II">Part II</a></p>
			</main>
		</div>
	</article>
</div>



    </div>
  </body></html>