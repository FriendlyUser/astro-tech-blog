<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaceshooter in Go - Astro Tech Blog</title>
    <meta name="description" content="This covers how to take make a space shooter game in go using the ebiten library.">
    <meta name="author" content="David Li">

    <link rel="alternate" type="application/rss+xml" href="/rss.xml">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">

    </script>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6">

    </script>
    
    <script type="text/javascript">
      let slideIndex = 1;
      showSlides(slideIndex);

      function plusSlides(n) {
        showSlides((slideIndex += n));
      }

      function currentSlide(n) {
        showSlides((slideIndex = n));
      }

      function showSlides(n) {
        try {
          let i;
          let slides = document.getElementsByClassName('mySlides');
          let dots = document.getElementsByClassName('demo');
          let captionText = document.getElementById('caption');
          if (n > slides.length) {
            slideIndex = 1;
          }
          if (n < 1) {
            slideIndex = slides.length;
          }
          for (i = 0; i < slides.length; i++) {
            slides[i].style.display = 'none';
          }
          for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(' active', '');
          }
          slides[slideIndex - 1].style.display = 'block';
          dots[slideIndex - 1].className += ' active';
          captionText.innerHTML = dots[slideIndex - 1].alt;
        } catch(err) {
          // do nothing here
        }
      }
    </script>
  <link rel="stylesheet" href="/_astro/index.a14bf900.css" />
<link rel="stylesheet" href="/_astro/index.be9bd85e.css" /><script type="module" src="/_astro/hoisted.4b7a3691.js"></script></head>
  <body class="bg-slate-900 text-gray-100">
    <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between"><a href="/"><div class="flex items-center bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text text-xl font-bold text-transparent"><svg class="mr-1 h-10 w-10 stroke-cyan-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none"></path><rect x="3" y="12" width="6" height="8" rx="1"></rect><rect x="9" y="8" width="6" height="12" rx="1"></rect><rect x="15" y="4" width="6" height="16" rx="1"></rect><path d="M4 20h14"></path></svg>David&#x27;s Blog</div></a><nav><ul class="flex gap-x-3 font-medium text-gray-200"><li class="hover:text-white"><a href="/posts">Blogs</a></li><li class="hover:text-white"><a href="https://github.com/FriendlyUser/astro-tech-blog">GitHub</a></li><li class="hover:text-white"><a href="/photos">Photos</a></li></ul></nav></div></div>
    <div data-pagefind-body>
      
  <div class="mx-auto max-w-screen-lg px-3 py-6"><div><h1 class="text-center text-3xl font-bold">Spaceshooter in Go</h1><div class="mt-2 text-center text-sm text-gray-400">By <!-- -->David Li<!-- --> on <!-- -->Wed, 13 March 2023 13:00:00 GMT</div><div class="flex place-content-center pt-2"><div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/ebiten" style="padding-right:3px"> <category>ebiten<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-orange-400 text-orange-900"> <a href="/tags/golang" style="padding-right:3px"> <category>golang<!-- --> </category></a></div> </div><div class="mx-auto mt-5 max-w-prose"><div class="aspect-w-3 aspect-h-2"><img class="h-full w-full rounded-lg object-cover object-center" src="/imgs/2022/android_emulator_pixel_3.png" alt="Image post 6" loading="lazy"/></div><div class="prose prose-invert mt-8 prose-img:rounded-lg"><content>
    <p>This code initializes the audio context and players for the game. The audio context is created with a sample rate of 22050 Hz, which is a common sample rate used in audio production. The audio context is then used to create players for the laser and music sounds.</p>
<p>The laser sound is loaded using the wav package, which is part of the ebiten library. The laser sound is then decoded and a player is created for it using the NewPlayer function. The volume of the laser player is set to 0.25.</p>
<p>The music sound is loaded using the vorbis package, which is also part of the ebiten library. The music sound is then decoded and an infinite loop stream is created from the decoded bytes. This stream is used to create a player for the music using the NewPlayer function. The volume of the music player is set to 0.5 and the player is started using the Play function.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto;"><code><span class="line"><span style="color: #F92672">package</span><span style="color: #F8F8F2"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// imported packages, most of them are for the golang game engine</span></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"image/color"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"bytes"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"image"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"fmt"</span></span>
<span class="line"><span style="color: #F8F8F2">    _ </span><span style="color: #E6DB74">"image/png"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"log"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"github.com/hajimehoshi/ebiten"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"github.com/hajimehoshi/ebiten/ebitenutil"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"time"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"math/rand"</span></span>
<span class="line"><span style="color: #F8F8F2">    utils </span><span style="color: #E6DB74">"github.com/FriendlyUser/spaceshooter/utils"</span></span>
<span class="line"><span style="color: #F8F8F2">    resources </span><span style="color: #E6DB74">"github.com/FriendlyUser/spaceshooter/resources"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// "github.com/hajimehoshi/go-inovation/ino/internal/input"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// "github.com/hajimehoshi/ebiten/inpututil"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"github.com/hajimehoshi/ebiten/audio"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"github.com/hajimehoshi/ebiten/audio/wav"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"github.com/hajimehoshi/ebiten/audio/vorbis"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"github.com/golang/freetype/truetype"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"golang.org/x/image/font"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"github.com/hajimehoshi/ebiten/examples/resources/fonts"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"github.com/hajimehoshi/ebiten/inpututil"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"github.com/hajimehoshi/ebiten/text"</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// hardcoded animation and sprite numbers from resources/sheet.xml</span></span>
<span class="line"><span style="color: #F92672">const</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">  playerSpriteStartNum </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">207</span></span>
<span class="line"><span style="color: #F8F8F2">  playerSpriteEndNum </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">215</span></span>
<span class="line"><span style="color: #F8F8F2">  ScreenWidth </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1920</span></span>
<span class="line"><span style="color: #F8F8F2">  ScreenHeight </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1440</span></span>
<span class="line"><span style="color: #F8F8F2">  ScaleFactor </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0.5</span></span>
<span class="line"><span style="color: #F8F8F2">  fontSize         </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">64</span></span>
<span class="line"><span style="color: #F8F8F2">  smallFontSize    </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> fontSize </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// game images</span></span>
<span class="line"><span style="color: #F92672">var</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #88846F">// global metadata for images from sheet.xml</span></span>
<span class="line"><span style="color: #F8F8F2">  images, _ </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ReadImageData</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #88846F">// delay beginning on ticker until actually game mode</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #88846F">// collision checker </span></span>
<span class="line"><span style="color: #F8F8F2">  gameImages </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image</span></span>
<span class="line"><span style="color: #F8F8F2">  bgImage </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image</span></span>
<span class="line"><span style="color: #F8F8F2">  count </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">const</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">    loopLengthInSecond  </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">17</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #88846F">// sounds </span></span>
<span class="line"><span style="color: #F92672">var</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">	audioContext </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">audio.Context</span></span>
<span class="line"><span style="color: #F8F8F2">	laserPlayer  </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">audio.Player</span></span>
<span class="line"><span style="color: #F8F8F2">	musicPlayer  </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">audio.Player</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">init</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// sampling := </span></span>
<span class="line"><span style="color: #F8F8F2">	audioContext, _ </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> audio.</span><span style="color: #66D9EF">NewContext</span><span style="color: #F8F8F2">(</span><span style="color: #AE81FF">22050</span><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	laser, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> wav.</span><span style="color: #66D9EF">Decode</span><span style="color: #F8F8F2">(audioContext, audio.</span><span style="color: #66D9EF">BytesReadSeekCloser</span><span style="color: #F8F8F2">(resources.Laser_wav))</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		log.</span><span style="color: #66D9EF">Fatal</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">    laserPlayer, err </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> audio.</span><span style="color: #66D9EF">NewPlayer</span><span style="color: #F8F8F2">(audioContext, laser)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		log.</span><span style="color: #66D9EF">Fatal</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">    laserPlayer.</span><span style="color: #66D9EF">SetVolume</span><span style="color: #F8F8F2">(</span><span style="color: #AE81FF">0.25</span><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    oggS, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> vorbis.</span><span style="color: #66D9EF">Decode</span><span style="color: #F8F8F2">(audioContext, audio.</span><span style="color: #66D9EF">BytesReadSeekCloser</span><span style="color: #F8F8F2">(resources.OST_ogg))</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        log.</span><span style="color: #66D9EF">Fatal</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// Create an infinite loop stream from the decoded bytes.</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// s is still an io.ReadCloser and io.Seeker.</span></span>
<span class="line"><span style="color: #F8F8F2">    s </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> audio.</span><span style="color: #66D9EF">NewInfiniteLoop</span><span style="color: #F8F8F2">(oggS, loopLengthInSecond</span><span style="color: #F92672">*</span><span style="color: #AE81FF">600</span><span style="color: #F92672">*</span><span style="color: #AE81FF">22050</span><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    musicPlayer, err </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> audio.</span><span style="color: #66D9EF">NewPlayer</span><span style="color: #F8F8F2">(audioContext, s)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        log.</span><span style="color: #66D9EF">Fatal</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">    musicPlayer.</span><span style="color: #66D9EF">SetVolume</span><span style="color: #F8F8F2">(</span><span style="color: #AE81FF">0.5</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// Play the infinite-length stream. This never ends.</span></span>
<span class="line"><span style="color: #F8F8F2">    musicPlayer.</span><span style="color: #66D9EF">Play</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>This code defines several types and variables for the game.</p>
<p>The Body type represents a basic object in the game with a position, velocity, and dimensions. The Enemy and Laser types both embed a Body and have additional fields specific to their roles in the game. The Enemy type has an additional field for its sprite number and health, while the Laser type has an additional field for its sprite number.</p>
<p>The Mode type is an enumeration of the different modes that the game can be in, such as the title screen, the main game, and the game over screen.</p>
<p>The Game type represents the state of the game and includes information about the player, the player’s lasers, the enemies, the enemy lasers, and the current game mode.</p>
<p>The viewport type represents the portion of the background image that is currently being displayed. It has fields for the horizontal and vertical positions of the viewport in 16th pixels. The Move method updates the viewport’s position by a small amount each frame.</p>
<p>Finally, the init function loads the sprite and background images into memory and initializes the fonts used in the game.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto;"><code><span class="line"><span style="color: #88846F">// consider having a laser type to deal with orientation, etc</span></span>
<span class="line"><span style="color: #88846F">// basic information to draw sprites, track position and update position</span></span>
<span class="line"><span style="color: #F92672">type</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; font-weight: bold">Body</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">struct</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// positions</span></span>
<span class="line"><span style="color: #F8F8F2">    x </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">    y </span><span style="color: #66D9EF">float64</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// velocities</span></span>
<span class="line"><span style="color: #F8F8F2">    vx </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">    vy </span><span style="color: #66D9EF">float64</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// get height and width from sheet.xml using sp</span></span>
<span class="line"><span style="color: #F8F8F2">    width </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">    height </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">type</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; font-weight: bold">Enemy</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">struct</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    Body </span></span>
<span class="line"><span style="color: #F8F8F2">    sp </span><span style="color: #66D9EF">int</span></span>
<span class="line"><span style="color: #F8F8F2">    health </span><span style="color: #66D9EF">int</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">type</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; font-weight: bold">Laser</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">struct</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    Body</span></span>
<span class="line"><span style="color: #F8F8F2">    sp </span><span style="color: #66D9EF">int</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">type</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; font-weight: bold">Mode</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">int</span></span>
<span class="line"><span style="color: #F92672">const</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">	ModeTitle Mode </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">iota</span></span>
<span class="line"><span style="color: #F8F8F2">	ModeGame</span></span>
<span class="line"><span style="color: #F8F8F2">	ModeGameOver</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F92672">var</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">    arcadeFont      font.Face</span></span>
<span class="line"><span style="color: #F8F8F2">	smallArcadeFont font.Face</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #88846F">// fonts and sizes</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">init</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">	tt, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> truetype.</span><span style="color: #66D9EF">Parse</span><span style="color: #F8F8F2">(fonts.ArcadeN_ttf)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		log.</span><span style="color: #66D9EF">Fatal</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">const</span><span style="color: #F8F8F2"> dpi </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">72</span></span>
<span class="line"><span style="color: #F8F8F2">	arcadeFont </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> truetype.</span><span style="color: #66D9EF">NewFace</span><span style="color: #F8F8F2">(tt, </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">truetype.Options{</span></span>
<span class="line"><span style="color: #F8F8F2">		Size:    fontSize,</span></span>
<span class="line"><span style="color: #F8F8F2">		DPI:     dpi,</span></span>
<span class="line"><span style="color: #F8F8F2">		Hinting: font.HintingFull,</span></span>
<span class="line"><span style="color: #F8F8F2">	})</span></span>
<span class="line"><span style="color: #F8F8F2">	smallArcadeFont </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> truetype.</span><span style="color: #66D9EF">NewFace</span><span style="color: #F8F8F2">(tt, </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">truetype.Options{</span></span>
<span class="line"><span style="color: #F8F8F2">		Size:    smallFontSize,</span></span>
<span class="line"><span style="color: #F8F8F2">		DPI:     dpi,</span></span>
<span class="line"><span style="color: #F8F8F2">		Hinting: font.HintingFull,</span></span>
<span class="line"><span style="color: #F8F8F2">	})</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"><span style="color: #88846F">// in the future have a laser type struct, spriteImgNum, and number of animations</span></span>
<span class="line"><span style="color: #F92672">type</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; font-weight: bold">Game</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">struct</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    mode Mode</span></span>
<span class="line"><span style="color: #F8F8F2">    level </span><span style="color: #66D9EF">int</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// tracks location of player and maybe health</span></span>
<span class="line"><span style="color: #F8F8F2">    Player </span><span style="color: #F92672">struct</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        Body</span></span>
<span class="line"><span style="color: #F8F8F2">        health    </span><span style="color: #66D9EF">int</span></span>
<span class="line"><span style="color: #F8F8F2">        laserType </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">        canShoot  </span><span style="color: #66D9EF">bool</span></span>
<span class="line"><span style="color: #F8F8F2">        sp        </span><span style="color: #66D9EF">int</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// consider adding in height and width of player object</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// all of the sprites seem to be the same</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// TODO set global width</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">    PLasers []</span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Laser</span></span>
<span class="line"><span style="color: #F8F8F2">    Enemies []</span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Enemy</span></span>
<span class="line"><span style="color: #F8F8F2">    ELasers []</span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Laser</span></span>
<span class="line"><span style="color: #F8F8F2">    gameoverCount </span><span style="color: #66D9EF">int</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// load images</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">init</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// sprites</span></span>
<span class="line"><span style="color: #F8F8F2">	img, _, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> image.</span><span style="color: #66D9EF">Decode</span><span style="color: #F8F8F2">(bytes.</span><span style="color: #66D9EF">NewReader</span><span style="color: #F8F8F2">(resources.Sprites_png))</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		log.</span><span style="color: #66D9EF">Fatal</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">    gameImages, _ </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">NewImageFromImage</span><span style="color: #F8F8F2">(img, ebiten.FilterDefault)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// backgrounds</span></span>
<span class="line"><span style="color: #F8F8F2">    img, _, err </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> image.</span><span style="color: #66D9EF">Decode</span><span style="color: #F8F8F2">(bytes.</span><span style="color: #66D9EF">NewReader</span><span style="color: #F8F8F2">(resources.Starfieldreal_jpg))</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		log.</span><span style="color: #66D9EF">Fatal</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	bgImage, _ </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">NewImageFromImage</span><span style="color: #F8F8F2">(img, ebiten.FilterDefault)</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// background image logic from </span></span>
<span class="line"><span style="color: #88846F">// # https://github.com/hajimehoshi/ebiten/blob/master/examples/infinitescroll/main.go</span></span>
<span class="line"><span style="color: #F92672">var</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">    theViewport </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">viewport{}</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">type</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E; font-weight: bold">viewport</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">struct</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">	x16 </span><span style="color: #66D9EF">int</span></span>
<span class="line"><span style="color: #F8F8F2">	y16 </span><span style="color: #66D9EF">int</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (p </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">viewport) </span><span style="color: #A6E22E">Move</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">	w, h </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> bgImage.</span><span style="color: #66D9EF">Size</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">	maxX16 </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> w </span><span style="color: #F92672">*</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">16</span></span>
<span class="line"><span style="color: #F8F8F2">	maxY16 </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> h </span><span style="color: #F92672">*</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">16</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	p.x16 </span><span style="color: #F92672">+=</span><span style="color: #F8F8F2"> w </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">32</span></span>
<span class="line"><span style="color: #F8F8F2">	p.y16 </span><span style="color: #F92672">+=</span><span style="color: #F8F8F2"> h </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">32</span></span>
<span class="line"><span style="color: #F8F8F2">	p.x16 </span><span style="color: #F92672">%=</span><span style="color: #F8F8F2"> maxX16</span></span>
<span class="line"><span style="color: #F8F8F2">	p.y16 </span><span style="color: #F92672">%=</span><span style="color: #F8F8F2"> maxY16</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>This code contains the main game loop and various functions that are called each frame to update and draw the game.</p>
<p>The Update function is called each frame and handles the different game modes. In the ModeTitle mode, the function displays a message on the screen and waits for the player to press a key or touch the screen to start the game. In the ModeGame mode, the function updates the game state, moves and draws the objects, and checks for collisions. In the ModeGameOver mode, the function displays a message on the screen and waits for the player to press a key or touch the screen to restart the game.</p>
<p>The CreateLevel function is called to create a new level of enemies for the game. It clears the existing bullets and spawns a number of enemies based on the current level.</p>
<p>The jump function returns true if the player has pressed a key, clicked the mouse, or touched the screen.</p>
<p>The moveShip function moves the player’s ship based on user input. The shootLaser function shoots a laser from the player’s ship if the player has pressed a key or clicked the mouse. The moveAndDrawLasers function moves and draws the player’s lasers, while the moveAndDrawEnemies function moves and draws the enemies. The drawShip function draws the player’s ship on the screen. The drawHealthBar function draws a health bar for the player. The moveAndDrawEnemyLasers function moves and draws the enemy lasers. The checkCollisions function checks for collisions between the enemies and the player’s lasers. The checkPlayerLaserCollision function checks for collisions between the player and the enemy lasers. The checkGameOver function checks if the game is over and changes the game mode accordingly.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto;"><code><span class="line"></span>
<span class="line"><span style="color: #88846F">// player health bar</span></span>
<span class="line"><span style="color: #F92672">var</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">    playerHB </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image</span></span>
<span class="line"><span style="color: #F8F8F2">    playerHBoutline </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (p </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">viewport) </span><span style="color: #A6E22E">Position</span><span style="color: #F8F8F2">() (</span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">, </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> p.x16, p.y16</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">NewGame</span><span style="color: #F8F8F2">() </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game {</span></span>
<span class="line"><span style="color: #F8F8F2">	g </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">Game{}</span></span>
<span class="line"><span style="color: #F8F8F2">	g.</span><span style="color: #66D9EF">init</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> g</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// random number generation</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">init</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">    rand.</span><span style="color: #66D9EF">Seed</span><span style="color: #F8F8F2">(time.</span><span style="color: #66D9EF">Now</span><span style="color: #F8F8F2">().</span><span style="color: #66D9EF">UnixNano</span><span style="color: #F8F8F2">())</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// initial Player</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">init</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span></span>
<span class="line"><span style="color: #F8F8F2">    _, _, _, width, height </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[playerSpriteStartNum])</span></span>
<span class="line"><span style="color: #F8F8F2">    g.Player.sp </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> playerSpriteStartNum</span></span>
<span class="line"><span style="color: #F8F8F2">    g.Player.Body.x </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ScreenWidth </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span></span>
<span class="line"><span style="color: #F8F8F2">    g.Player.Body.y </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ScreenHeight </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">100</span></span>
<span class="line"><span style="color: #F8F8F2">    g.Player.Body.width </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> width </span></span>
<span class="line"><span style="color: #F8F8F2">    g.Player.Body.height </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> height</span></span>
<span class="line"><span style="color: #F8F8F2">    g.Player.health </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">100</span></span>
<span class="line"><span style="color: #F8F8F2">    g.Player.canShoot </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">true</span><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">    g.level </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span></span>
<span class="line"><span style="color: #F8F8F2">    g.Player.Body.vx </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">5</span></span>
<span class="line"><span style="color: #F8F8F2">    g.Player.Body.vy </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">5</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    g.</span><span style="color: #66D9EF">CreateLevel</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">CreateLevel</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">    g.level </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> g.level </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">    gameLevel </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.level </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">10</span></span>
<span class="line"><span style="color: #F8F8F2">    enemySprite </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">50</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// clear bullets </span></span>
<span class="line"><span style="color: #F8F8F2">    g.PLasers </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span></span>
<span class="line"><span style="color: #F8F8F2">    g.ELasers </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// spawn enemies based on level</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">; i </span><span style="color: #F92672">&#x3C;=</span><span style="color: #F8F8F2"> gameLevel; i</span><span style="color: #F92672">++</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        enemySprite </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> (rand.</span><span style="color: #66D9EF">Intn</span><span style="color: #F8F8F2">(</span><span style="color: #AE81FF">10</span><span style="color: #F8F8F2">)) </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">50</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">addEnemyRand</span><span style="color: #F8F8F2">(enemySprite)</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"><span style="color: #88846F">// copied from flappyplane, but basic functionality any key pressed</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">jump</span><span style="color: #F8F8F2">() </span><span style="color: #66D9EF">bool</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> inpututil.</span><span style="color: #66D9EF">IsKeyJustPressed</span><span style="color: #F8F8F2">(ebiten.KeySpace) {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">true</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> inpututil.</span><span style="color: #66D9EF">IsMouseButtonJustPressed</span><span style="color: #F8F8F2">(ebiten.MouseButtonLeft) {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">true</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(inpututil.</span><span style="color: #66D9EF">JustPressedTouchIDs</span><span style="color: #F8F8F2">()) </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">true</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">false</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// main game loop</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">Update</span><span style="color: #F8F8F2">(screen </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image) </span><span style="color: #66D9EF">error</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">switch</span><span style="color: #F8F8F2"> g.mode {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// allow user to jump from title screen</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// and title screen</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">case</span><span style="color: #F8F8F2"> ModeTitle:</span></span>
<span class="line"><span style="color: #F8F8F2">        msg </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> []</span><span style="color: #66D9EF">string</span><span style="color: #F8F8F2">{</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #E6DB74">"Game Created Using Ebiten"</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #E6DB74">"Created By David Li."</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">		}</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i, l </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">range</span><span style="color: #F8F8F2"> msg {</span></span>
<span class="line"><span style="color: #F8F8F2">            x </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> (ScreenWidth </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(l)) </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span></span>
<span class="line"><span style="color: #F8F8F2">            y </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> (ScreenHeight) </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span></span>
<span class="line"><span style="color: #F8F8F2">			text.</span><span style="color: #66D9EF">Draw</span><span style="color: #F8F8F2">(screen, l, smallArcadeFont, x, y </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> i</span><span style="color: #F92672">*</span><span style="color: #AE81FF">40</span><span style="color: #F8F8F2">, color.White)</span></span>
<span class="line"><span style="color: #F8F8F2">		}</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">jump</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">			g.mode </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ModeGame</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// main game mode with enemies, move objects and draw objects</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// main game loop</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// TODO refactor to separate movement and drawing, perhaps for efficiency reasons</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">case</span><span style="color: #F8F8F2"> ModeGame:</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">IsDrawingSkipped</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// draw background</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #66D9EF">ScrollBG</span><span style="color: #F8F8F2">(screen)</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// TPS counter</span></span>
<span class="line"><span style="color: #F8F8F2">        fps </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> fmt.</span><span style="color: #66D9EF">Sprintf</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"TPS: </span><span style="color: #AE81FF">%f</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2">, ebiten.</span><span style="color: #66D9EF">CurrentTPS</span><span style="color: #F8F8F2">())</span></span>
<span class="line"><span style="color: #F8F8F2">        ebitenutil.</span><span style="color: #66D9EF">DebugPrint</span><span style="color: #F8F8F2">(screen, fps)</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// show if ship should move</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">moveShip</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// check if laser is shot</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">shootLaser</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// draw and update lasers</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// maybe goroutine some of this</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">moveAndDrawLasers</span><span style="color: #F8F8F2">(screen)</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">moveAndDrawEnemies</span><span style="color: #F8F8F2">(screen)</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">drawShip</span><span style="color: #F8F8F2">(screen)   </span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">drawHealthBar</span><span style="color: #F8F8F2">(screen)</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">moveAndDrawEnemyLasers</span><span style="color: #F8F8F2">(screen)</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">checkCollisions</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">checkPlayerLaserCollision</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// g.drawLasers(screen)</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// check if game over</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">checkGameOver</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// game over instance</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">case</span><span style="color: #F8F8F2"> ModeGameOver:</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// TODO DELETE ALL LASER, RESET PLAYER HEALTH, ETC, or add it to init</span></span>
<span class="line"><span style="color: #F8F8F2">        msg </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> []</span><span style="color: #66D9EF">string</span><span style="color: #F8F8F2">{</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #E6DB74">"Game Over :("</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #E6DB74">"Created By David Li."</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">		}</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i, l </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">range</span><span style="color: #F8F8F2"> msg {</span></span>
<span class="line"><span style="color: #F8F8F2">            x </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> (ScreenWidth </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(l)) </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span></span>
<span class="line"><span style="color: #F8F8F2">            y </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> (ScreenHeight) </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span></span>
<span class="line"><span style="color: #F8F8F2">			text.</span><span style="color: #66D9EF">Draw</span><span style="color: #F8F8F2">(screen, l, smallArcadeFont, x, y </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> i</span><span style="color: #F92672">*</span><span style="color: #AE81FF">40</span><span style="color: #F8F8F2">, color.White)</span></span>
<span class="line"><span style="color: #F8F8F2">		}</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> g.gameoverCount </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.gameoverCount</span><span style="color: #F92672">--</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> g.gameoverCount </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">jump</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.</span><span style="color: #66D9EF">init</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">            g.mode </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ModeTitle</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// check if player got hit by enemy lasers</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">checkPlayerLaserCollision</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// issues occur if you delete the same object during iteration</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// instead have a list of lasers to delete and then delete them outside the loop</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// check player lasers to player collisions</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (count </span><span style="color: #F92672">%</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">5</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> j </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">; j </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(g.ELasers); j</span><span style="color: #F92672">++</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">            pelHit </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.</span><span style="color: #66D9EF">checkPlayerELaserCollision</span><span style="color: #F8F8F2">(j)</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (pelHit) {</span></span>
<span class="line"><span style="color: #F8F8F2">                g.Player.health </span><span style="color: #F92672">-=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1</span></span>
<span class="line"><span style="color: #F8F8F2">                pelHit </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">false</span></span>
<span class="line"><span style="color: #F8F8F2">                g.</span><span style="color: #66D9EF">removeEnemyLaser</span><span style="color: #F8F8F2">(j)</span></span>
<span class="line"><span style="color: #F8F8F2">            }</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>The game has three modes: title screen, game, and game over. The game has a background image that scrolls indefinitely and the player can shoot lasers to destroy enemies. The player’s health is tracked and if it reaches 0, the game enters game over mode.</p>
<p>The Game struct contains information about the current game mode, level, player, player’s lasers, enemies, enemy lasers, and gameover count. The Body struct represents the basic information needed to draw and update the position of a sprite. The Enemy struct is a type of Body with additional fields for its sprite number and health. The Laser struct is also a type of Body with an additional field for its sprite number.</p>
<p>The game has a number of initialization functions that set up the game images, audio, and fonts. The Update function is the main game loop that handles the different game modes and updates the game state. The game has functions for moving and drawing the player, lasers, and enemies, and for checking collisions between these objects. There are also functions for adding and removing enemies and lasers.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto;"><code><span class="line"></span>
<span class="line"><span style="color: #88846F">// not sure if I should "goroutine it all", it appears game is using goroutines already</span></span>
<span class="line"><span style="color: #88846F">// goroutine still causes issues, I think I want collisions to be synced.</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">checkCollisions</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (count </span><span style="color: #F92672">%</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">5</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">; i </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(g.Enemies); i</span><span style="color: #F92672">++</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">            s </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.Enemies[i]</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #88846F">// since we are only checking collision between all enemies and a single player, this approach is fine</span></span>
<span class="line"><span style="color: #F8F8F2">            pHit </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.</span><span style="color: #66D9EF">checkPlayerEnemyCollision</span><span style="color: #F8F8F2">(s)</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (pHit) {</span></span>
<span class="line"><span style="color: #F8F8F2">                g.Player.health </span><span style="color: #F92672">-=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1</span></span>
<span class="line"><span style="color: #F8F8F2">            }</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> j </span><span style="color: #F92672">:=</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">; j </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(g.PLasers); j</span><span style="color: #F92672">++</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">                eHit </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.</span><span style="color: #66D9EF">checkEnemyLaserCollision</span><span style="color: #F8F8F2">(s,j)</span></span>
<span class="line"><span style="color: #F8F8F2">                </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (eHit) {</span></span>
<span class="line"><span style="color: #F8F8F2">                    eHit </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">false</span></span>
<span class="line"><span style="color: #F8F8F2">                    g.</span><span style="color: #66D9EF">removeLaser</span><span style="color: #F8F8F2">(j)</span></span>
<span class="line"><span style="color: #F8F8F2">                    </span><span style="color: #88846F">// make sure enemy exists before removing in, thats what you got to do with goroutines</span></span>
<span class="line"><span style="color: #F8F8F2">                    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(g.Enemies) </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> i {</span></span>
<span class="line"><span style="color: #F8F8F2">                        g.Enemies[i].health </span><span style="color: #F92672">-=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">3</span></span>
<span class="line"><span style="color: #F8F8F2">                    }</span></span>
<span class="line"><span style="color: #F8F8F2">                    </span><span style="color: #88846F">// remove enemy, convert to explosion object that will be erased later</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">                }</span></span>
<span class="line"><span style="color: #F8F8F2">            }</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// Collision Functions</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// check laserEnemyCollision</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2">  (g</span><span style="color: #F92672">*</span><span style="color: #F8F8F2"> Game) </span><span style="color: #A6E22E">checkPlayerELaserCollision</span><span style="color: #F8F8F2">(j </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">) (</span><span style="color: #66D9EF">bool</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    el </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.ELasers[j]</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// adjust body to correct looking </span></span>
<span class="line"><span style="color: #F8F8F2">    p </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.Player</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">BodyCollided</span><span style="color: #F8F8F2">(</span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">p.Body, </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">el.Body)</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g</span><span style="color: #F92672">*</span><span style="color: #F8F8F2"> Game) </span><span style="color: #A6E22E">checkEnemyLaserCollision</span><span style="color: #F8F8F2">(e</span><span style="color: #F92672">*</span><span style="color: #F8F8F2"> Enemy, j </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">) (</span><span style="color: #66D9EF">bool</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    p </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.PLasers[j]</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">BodyCollided</span><span style="color: #F8F8F2">(</span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">e.Body, </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">p.Body)</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// check laserEnemyCollision</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2">  (g</span><span style="color: #F92672">*</span><span style="color: #F8F8F2"> Game) </span><span style="color: #A6E22E">checkPlayerEnemyCollision</span><span style="color: #F8F8F2">(e</span><span style="color: #F92672">*</span><span style="color: #F8F8F2"> Enemy) (</span><span style="color: #66D9EF">bool</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// fmt.Println(g.Player.Body)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">BodyCollided</span><span style="color: #F8F8F2">(</span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">e.Body,</span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">g.Player.Body)</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"><span style="color: #88846F">// check if bodies have collided</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">BodyCollided</span><span style="color: #F8F8F2">(r1 </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Body,  r2 </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Body) (</span><span style="color: #66D9EF">bool</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// compute rectangle 1</span></span>
<span class="line"><span style="color: #F8F8F2">    r1L, r1R, r1T, r1B </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">ComputeRect</span><span style="color: #F8F8F2">(r1)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// compute rectangle 2</span></span>
<span class="line"><span style="color: #F8F8F2">    r2L, r2R, r2T, r2B </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">ComputeRect</span><span style="color: #F8F8F2">(r2)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// fmt.Println(r1L, r1R, r1T, r1B)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// fmt.Println(r2L, r2R, r2T, r2B)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> (r1L </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> r2R </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> r1R </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> r2L </span><span style="color: #F92672">&#x26;&#x26;</span></span>
<span class="line"><span style="color: #F8F8F2">        r1B </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> r2T </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> r1T </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> r2B)</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">ComputeRect</span><span style="color: #F8F8F2">(rect </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Body) (</span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">, </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">, </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">, </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    rectL </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> rect.x </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(rect.width </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    rectR </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> rect.x </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(rect.width </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    rectT </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> rect.y </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(rect.height </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    rectB </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> rect.y </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(rect.height </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> rectL, rectR, rectT, rectB</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// since I am using goroutines I need to check if the specified enemy exists every time this function </span></span>
<span class="line"><span style="color: #88846F">// is called</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">removeEnemy</span><span style="color: #F8F8F2">(i </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    s </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.Enemies</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">>=</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(s) {</span></span>
<span class="line"><span style="color: #F8F8F2">        s[i] </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> s[</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(s)</span><span style="color: #F92672">-</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">        g.Enemies </span><span style="color: #F92672">=</span><span style="color: #F8F8F2">  s[:</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(s)</span><span style="color: #F92672">-</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">removeEnemyLaser</span><span style="color: #F8F8F2">(i </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    s </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.ELasers</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">>=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(s) {</span></span>
<span class="line"><span style="color: #F8F8F2">        s[i] </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> s[</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(s)</span><span style="color: #F92672">-</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">        g.ELasers </span><span style="color: #F92672">=</span><span style="color: #F8F8F2">  s[:</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(s)</span><span style="color: #F92672">-</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">removeLaser</span><span style="color: #F8F8F2">(i </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    s </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.PLasers</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">>=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(s) {</span></span>
<span class="line"><span style="color: #F8F8F2">        s[i] </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> s[</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(s)</span><span style="color: #F92672">-</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">        g.PLasers </span><span style="color: #F92672">=</span><span style="color: #F8F8F2">  s[:</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(s)</span><span style="color: #F92672">-</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// give player laser type, add laser struct to Player struct</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">shootLaser</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// if issue persists, use count instead of goroutine to determine when player can shoot</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">IsKeyPressed</span><span style="color: #F8F8F2">(ebiten.KeySpace) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// Selects preloaded sprite</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (g.Player.canShoot) {</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #88846F">// make new laser</span></span>
<span class="line"><span style="color: #F8F8F2">            g.</span><span style="color: #66D9EF">addLaser</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">            g.Player.canShoot </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">false</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// wait 200 millseconds before player can shoot</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (count </span><span style="color: #F92672">%</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">20</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">        g.Player.canShoot </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">true</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">/*</span></span>
<span class="line"><span style="color: #88846F"> *</span></span>
<span class="line"><span style="color: #88846F"> * Adding Lasers, Enemies functions, and powerups in the future</span></span>
<span class="line"><span style="color: #88846F"> */</span></span>
<span class="line"><span style="color: #88846F">// adding new </span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">addLaser</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">    laserPlayer.</span><span style="color: #66D9EF">Rewind</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">    laserPlayer.</span><span style="color: #66D9EF">Play</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">    _, _, _, ipw, iph </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[playerSpriteStartNum])</span></span>
<span class="line"><span style="color: #F8F8F2">    pw </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(ipw)</span></span>
<span class="line"><span style="color: #F8F8F2">    ph </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(iph)</span></span>
<span class="line"><span style="color: #F8F8F2">    px </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.Player.Body.x </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> pw </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span></span>
<span class="line"><span style="color: #F8F8F2">    py </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.Player.Body.y </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> ph</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// vx not used outside of initialization</span></span>
<span class="line"><span style="color: #F8F8F2">    vx </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1.00</span></span>
<span class="line"><span style="color: #F8F8F2">    vy </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">3.00</span></span>
<span class="line"><span style="color: #F8F8F2">    snum </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">105</span></span>
<span class="line"><span style="color: #F8F8F2">    _, _, _, width, height </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[snum])</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// fmt.Println("shooting a laser")</span></span>
<span class="line"><span style="color: #F8F8F2">    g.PLasers </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">append</span><span style="color: #F8F8F2">(g.PLasers, </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">Laser{Body{px, py, vx, vy, width, height}, snum})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// TODO FInish this function</span></span>
<span class="line"><span style="color: #88846F">// ADD SPECIFIC FUNCTIONALITY for enemy</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">addEnemyLoc</span><span style="color: #F8F8F2">(snum </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    emax </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">5</span><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">    emin </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">-</span><span style="color: #AE81FF">5</span></span>
<span class="line"><span style="color: #F8F8F2">    px </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(rand.</span><span style="color: #66D9EF">Intn</span><span style="color: #F8F8F2">(ScreenWidth))</span></span>
<span class="line"><span style="color: #F8F8F2">    py </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(rand.</span><span style="color: #66D9EF">Intn</span><span style="color: #F8F8F2">(ScreenHeight </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">) </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> ScreenHeight </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">4</span><span style="color: #F8F8F2">) </span></span>
<span class="line"><span style="color: #F8F8F2">    vx </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(emin </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> rand.</span><span style="color: #66D9EF">Intn</span><span style="color: #F8F8F2">(emax</span><span style="color: #F92672">-</span><span style="color: #F8F8F2">emin</span><span style="color: #F92672">+</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">))</span></span>
<span class="line"><span style="color: #F8F8F2">    vy </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(emin </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> rand.</span><span style="color: #66D9EF">Intn</span><span style="color: #F8F8F2">(emax</span><span style="color: #F92672">-</span><span style="color: #F8F8F2">emin</span><span style="color: #F92672">+</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    _, _, _, width, height </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[snum])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    health </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// fmt.Println("shooting a laser")</span></span>
<span class="line"><span style="color: #F8F8F2">    g.Enemies </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">append</span><span style="color: #F8F8F2">(g.Enemies, </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">Enemy{Body{px, py, vx, vy, width, height}, snum, health})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>It looks like this code is for a 2D space shooter game. The Game struct appears to store the state of the game, including the player’s ship and any enemies, bullets, or other objects in the game. The Update function appears to be the main game loop, where the game logic is executed and objects are moved and drawn on the screen. The init function appears to be used to set up the initial state of the game, including the position of the player’s ship and the number of enemies to spawn. The CreateLevel function appears to be used to create a new level of the game, which involves clearing any existing bullets and spawning new enemies based on the current level number. The jump function appears to be used to detect when the player has pressed a key or mouse button to perform some action, such as starting the game or jumping in a platformer. The checkCollisions function appears to be used to detect when objects in the game have collided with each other and update their state accordingly. The resetLevel function appears to be used to reset the game state when the player has lost or completed a level. The addEnemyRand function appears to be used to spawn a new enemy at a random location on the screen, and the enemyShootLaser function appears to be used to make an enemy shoot a bullet. The drawShip and drawHealthBar functions appear to be used to draw the player’s ship and health bar on the screen, respectively.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto;"><code><span class="line"><span style="color: #88846F">// TODO Make the spawn location within a randomized region</span></span>
<span class="line"><span style="color: #88846F">// sum is the sprite num corresponding to sheet.xml</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">addEnemyRand</span><span style="color: #F8F8F2">(snum </span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    emax </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">5</span><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">    emin </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">-</span><span style="color: #AE81FF">5</span></span>
<span class="line"><span style="color: #F8F8F2">    spawny </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0.75</span></span>
<span class="line"><span style="color: #F8F8F2">    px </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(rand.</span><span style="color: #66D9EF">Intn</span><span style="color: #F8F8F2">(ScreenWidth))</span></span>
<span class="line"><span style="color: #F8F8F2">    py </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(spawny</span><span style="color: #F92672">*</span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(rand.</span><span style="color: #66D9EF">Intn</span><span style="color: #F8F8F2">(ScreenHeight)) </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> ScreenHeight </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">8</span><span style="color: #F8F8F2">) </span></span>
<span class="line"><span style="color: #F8F8F2">    vx </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(emin </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> rand.</span><span style="color: #66D9EF">Intn</span><span style="color: #F8F8F2">(emax</span><span style="color: #F92672">-</span><span style="color: #F8F8F2">emin</span><span style="color: #F92672">+</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">))</span></span>
<span class="line"><span style="color: #F8F8F2">    vy </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(emin </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> rand.</span><span style="color: #66D9EF">Intn</span><span style="color: #F8F8F2">(emax</span><span style="color: #F92672">-</span><span style="color: #F8F8F2">emin</span><span style="color: #F92672">+</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    _, _, _, width, height </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[snum])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    health </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span></span>
<span class="line"><span style="color: #F8F8F2">    g.Enemies </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">append</span><span style="color: #F8F8F2">(g.Enemies, </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">Enemy{Body{px, py, vx, vy, width, height}, snum, health})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// destroy all generated game objects, return player to starting point, etc ...</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g</span><span style="color: #F92672">*</span><span style="color: #F8F8F2"> Game) </span><span style="color: #A6E22E">resetLevel</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// create new enemy laser</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">enemyShootLaser</span><span style="color: #F8F8F2">(x </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">, y </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// vx not used outside of initialization</span></span>
<span class="line"><span style="color: #F8F8F2">    vx </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1.00</span><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">    vy </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> rand.</span><span style="color: #66D9EF">Float64</span><span style="color: #F8F8F2">() </span><span style="color: #F92672">*</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">4</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0.01</span></span>
<span class="line"><span style="color: #F8F8F2">    snum </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> rand.</span><span style="color: #66D9EF">Intn</span><span style="color: #F8F8F2">(</span><span style="color: #AE81FF">10</span><span style="color: #F8F8F2">) </span><span style="color: #F92672">+</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">110</span></span>
<span class="line"><span style="color: #F8F8F2">    _, _, _, width, height </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[snum])</span></span>
<span class="line"><span style="color: #F8F8F2">    g.ELasers </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">append</span><span style="color: #F8F8F2">(g.ELasers, </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">Laser{Body{x, y, vx, vy, width, height}, snum})</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// move and draw lasers</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">moveAndDrawEnemyLasers</span><span style="color: #F8F8F2">(screen </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">; i </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(g.ELasers); i</span><span style="color: #F92672">++</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        s </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.ELasers[i]</span></span>
<span class="line"><span style="color: #F8F8F2">        _, x, y, width, height </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[s.sp])</span></span>
<span class="line"><span style="color: #F8F8F2">        op </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">ebiten.DrawImageOptions{}</span></span>
<span class="line"><span style="color: #F8F8F2">        op.GeoM.</span><span style="color: #66D9EF">Translate</span><span style="color: #F8F8F2">(</span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(s.x), </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(s.y))</span></span>
<span class="line"><span style="color: #F8F8F2">        op.Filter </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ebiten.FilterLinear</span></span>
<span class="line"><span style="color: #F8F8F2">        screen.</span><span style="color: #66D9EF">DrawImage</span><span style="color: #F8F8F2">(gameImages.</span><span style="color: #66D9EF">SubImage</span><span style="color: #F8F8F2">(image.</span><span style="color: #66D9EF">Rect</span><span style="color: #F8F8F2">(x, y, x</span><span style="color: #F92672">+</span><span style="color: #F8F8F2">width, y</span><span style="color: #F92672">+</span><span style="color: #F8F8F2">height)).(</span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image), op)</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (s.y </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> ScreenHeight) {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.</span><span style="color: #66D9EF">removeEnemyLaser</span><span style="color: #F8F8F2">(i)</span></span>
<span class="line"><span style="color: #F8F8F2">        } </span><span style="color: #F92672">else</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.ELasers[i].y </span><span style="color: #F92672">+=</span><span style="color: #F8F8F2"> g.ELasers[i].vy</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"><span style="color: #88846F">/*</span></span>
<span class="line"><span style="color: #88846F"> *</span></span>
<span class="line"><span style="color: #88846F"> * Movement and Drawing Functions --- Ships, background and enemies, lasers</span></span>
<span class="line"><span style="color: #88846F"> */</span></span>
<span class="line"><span style="color: #88846F">// draws the player ship using game object player data </span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">drawShip</span><span style="color: #F8F8F2">(screen </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image) {</span></span>
<span class="line"><span style="color: #F8F8F2">	count</span><span style="color: #F92672">++</span></span>
<span class="line"><span style="color: #F8F8F2">	op </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">ebiten.DrawImageOptions{}</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// move to player location</span></span>
<span class="line"><span style="color: #F8F8F2">    i </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> (count </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">10</span><span style="color: #F8F8F2">) </span><span style="color: #F92672">%</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">7</span></span>
<span class="line"><span style="color: #F8F8F2">    op.GeoM.</span><span style="color: #66D9EF">Translate</span><span style="color: #F8F8F2">(g.Player.Body.x, g.Player.Body.y)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// player ships from number 207 to 215</span></span>
<span class="line"><span style="color: #F8F8F2">	_, x, y, width, height </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[playerSpriteStartNum</span><span style="color: #F92672">+</span><span style="color: #F8F8F2">i])</span></span>
<span class="line"><span style="color: #F8F8F2">	op.Filter </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ebiten.FilterLinear</span></span>
<span class="line"><span style="color: #F8F8F2">    screen.</span><span style="color: #66D9EF">DrawImage</span><span style="color: #F8F8F2">(gameImages.</span><span style="color: #66D9EF">SubImage</span><span style="color: #F8F8F2">(image.</span><span style="color: #66D9EF">Rect</span><span style="color: #F8F8F2">(x, y, x</span><span style="color: #F92672">+</span><span style="color: #F8F8F2">width, y</span><span style="color: #F92672">+</span><span style="color: #F8F8F2">height)).(</span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image), op)</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// draw health bar</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">drawHealthBar</span><span style="color: #F8F8F2">(screen </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image) {</span></span>
<span class="line"><span style="color: #F8F8F2">    w </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">10</span></span>
<span class="line"><span style="color: #F8F8F2">    h </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">10</span></span>
<span class="line"><span style="color: #F8F8F2">    health </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.Player.health</span></span>
<span class="line"><span style="color: #F8F8F2">    _, _, _, width, height </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[</span><span style="color: #AE81FF">13</span><span style="color: #F8F8F2">])</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> playerHBoutline </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// Create an 16x16 image</span></span>
<span class="line"><span style="color: #F8F8F2">        playerHBoutline, _ </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">NewImage</span><span style="color: #F8F8F2">(width</span><span style="color: #F92672">-</span><span style="color: #AE81FF">5</span><span style="color: #F8F8F2">, height</span><span style="color: #F92672">-</span><span style="color: #AE81FF">5</span><span style="color: #F8F8F2">, ebiten.FilterNearest)</span></span>
<span class="line"><span style="color: #F8F8F2">    } </span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// Fill the square with the white color</span></span>
<span class="line"><span style="color: #F8F8F2">    playerHBoutline.</span><span style="color: #66D9EF">Fill</span><span style="color: #F8F8F2">(color.NRGBA{</span><span style="color: #F92672">0x</span><span style="color: #AE81FF">ff</span><span style="color: #F8F8F2">, </span><span style="color: #F92672">0x</span><span style="color: #AE81FF">00</span><span style="color: #F8F8F2">, </span><span style="color: #F92672">0x</span><span style="color: #AE81FF">00</span><span style="color: #F8F8F2">, </span><span style="color: #F92672">0x</span><span style="color: #AE81FF">ff</span><span style="color: #F8F8F2">})</span></span>
<span class="line"><span style="color: #F8F8F2">    op </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">ebiten.DrawImageOptions{}</span></span>
<span class="line"><span style="color: #F8F8F2">    op.GeoM.</span><span style="color: #66D9EF">Translate</span><span style="color: #F8F8F2">(</span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(w</span><span style="color: #F92672">+</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">), </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(h</span><span style="color: #F92672">+</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// Draw the square image to the screen with an empty option</span></span>
<span class="line"><span style="color: #F8F8F2">    screen.</span><span style="color: #66D9EF">DrawImage</span><span style="color: #F8F8F2">(playerHBoutline, op)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> health </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        playerHB, _ </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">NewImage</span><span style="color: #F8F8F2">(health</span><span style="color: #F92672">*</span><span style="color: #F8F8F2">width</span><span style="color: #F92672">/</span><span style="color: #AE81FF">100</span><span style="color: #F8F8F2">, height, ebiten.FilterNearest)</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">    playerHB.</span><span style="color: #66D9EF">Fill</span><span style="color: #F8F8F2">(color.NRGBA{</span><span style="color: #F92672">0x</span><span style="color: #AE81FF">00</span><span style="color: #F8F8F2">, </span><span style="color: #F92672">0x</span><span style="color: #AE81FF">ff</span><span style="color: #F8F8F2">, </span><span style="color: #F92672">0x</span><span style="color: #AE81FF">00</span><span style="color: #F8F8F2">, </span><span style="color: #F92672">0x</span><span style="color: #AE81FF">ff</span><span style="color: #F8F8F2">})</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// if playerHB == nil {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// Create an 16x16 image    </span></span>
<span class="line"><span style="color: #F8F8F2">   </span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// } </span></span>
<span class="line"><span style="color: #F8F8F2">    op </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">ebiten.DrawImageOptions{}</span></span>
<span class="line"><span style="color: #F8F8F2">    op.GeoM.</span><span style="color: #66D9EF">Translate</span><span style="color: #F8F8F2">(</span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(w), </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(h))</span></span>
<span class="line"><span style="color: #F8F8F2">    screen.</span><span style="color: #66D9EF">DrawImage</span><span style="color: #F8F8F2">(playerHB, op)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// move and draw enemies</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">moveAndDrawEnemies</span><span style="color: #F8F8F2">(screen </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image) {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">; i </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(g.Enemies); i</span><span style="color: #F92672">++</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        s </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.Enemies[i]</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// destroy enemy if health is low, maybe seperate loop to remove glittery behaviour</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (s.health </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.</span><span style="color: #66D9EF">removeEnemy</span><span style="color: #F8F8F2">(i)</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">continue</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// update enemies</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (s.x </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2"> ) {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.Enemies[i].Body.vx </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">-</span><span style="color: #F8F8F2">g.Enemies[i].Body.vx</span></span>
<span class="line"><span style="color: #F8F8F2">        } </span><span style="color: #F92672">else</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (s.x </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> ScreenWidth) {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.Enemies[i].Body.vx </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">-</span><span style="color: #F8F8F2">g.Enemies[i].Body.vx</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">        g.Enemies[i].Body.x </span><span style="color: #F92672">+=</span><span style="color: #F8F8F2"> g.Enemies[i].Body.vx</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// draw image</span></span>
<span class="line"><span style="color: #F8F8F2">        _, x, y, width, height </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[s.sp])</span></span>
<span class="line"><span style="color: #F8F8F2">        op </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">ebiten.DrawImageOptions{}</span></span>
<span class="line"><span style="color: #F8F8F2">        op.GeoM.</span><span style="color: #66D9EF">Translate</span><span style="color: #F8F8F2">(</span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(s.Body.x), </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(s.Body.y))</span></span>
<span class="line"><span style="color: #F8F8F2">        screen.</span><span style="color: #66D9EF">DrawImage</span><span style="color: #F8F8F2">(gameImages.</span><span style="color: #66D9EF">SubImage</span><span style="color: #F8F8F2">(image.</span><span style="color: #66D9EF">Rect</span><span style="color: #F8F8F2">(x, y, x</span><span style="color: #F92672">+</span><span style="color: #F8F8F2">width, y</span><span style="color: #F92672">+</span><span style="color: #F8F8F2">height)).(</span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image), op)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// make bullet be shot every 20 seconds</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (count </span><span style="color: #F92672">%</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">200</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">            elaserx </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> s.x</span></span>
<span class="line"><span style="color: #F8F8F2">            elasery </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> s.y</span></span>
<span class="line"><span style="color: #F8F8F2">            g.</span><span style="color: #66D9EF">enemyShootLaser</span><span style="color: #F8F8F2">(elaserx, elasery)</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// go to next level if all enemies are dead</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(g.Enemies) </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        g.</span><span style="color: #66D9EF">CreateLevel</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// move and draw lasers</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">moveAndDrawLasers</span><span style="color: #F8F8F2">(screen </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image) {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// get player data to determine where bullet should spawn</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// consider getting global height width for player object later</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">; i </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(g.PLasers); i</span><span style="color: #F92672">++</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        s </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> g.PLasers[i]</span></span>
<span class="line"><span style="color: #F8F8F2">        _, x, y, width, height </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">ImageData</span><span style="color: #F8F8F2">(images[s.sp])</span></span>
<span class="line"><span style="color: #F8F8F2">        op </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">ebiten.DrawImageOptions{}</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// op.GeoM.Rotate(90 * math.Pi / 180)</span></span>
<span class="line"><span style="color: #F8F8F2">        op.GeoM.</span><span style="color: #66D9EF">Translate</span><span style="color: #F8F8F2">(</span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(s.x), </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(s.y))</span></span>
<span class="line"><span style="color: #F8F8F2">        screen.</span><span style="color: #66D9EF">DrawImage</span><span style="color: #F8F8F2">(gameImages.</span><span style="color: #66D9EF">SubImage</span><span style="color: #F8F8F2">(image.</span><span style="color: #66D9EF">Rect</span><span style="color: #F8F8F2">(x, y, x</span><span style="color: #F92672">+</span><span style="color: #F8F8F2">width, y</span><span style="color: #F92672">+</span><span style="color: #F8F8F2">height)).(</span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image), op)</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (s.y </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">-</span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(height)) {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.</span><span style="color: #66D9EF">removeLaser</span><span style="color: #F8F8F2">(i)</span></span>
<span class="line"><span style="color: #F8F8F2">        } </span><span style="color: #F92672">else</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.PLasers[i].y </span><span style="color: #F92672">-=</span><span style="color: #F8F8F2"> g.PLasers[i].vy</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// make the background scroll</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">ScrollBG</span><span style="color: #F8F8F2">(screen </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">ebiten.Image) {</span></span>
<span class="line"><span style="color: #F8F8F2">    theViewport.</span><span style="color: #66D9EF">Move</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">    x16, y16 </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> theViewport.</span><span style="color: #66D9EF">Position</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">	offsetX, offsetY </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(</span><span style="color: #F92672">-</span><span style="color: #F8F8F2">x16) </span><span style="color: #F92672">/</span><span style="color: #AE81FF">16</span><span style="color: #F8F8F2">, </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(</span><span style="color: #F92672">-</span><span style="color: #F8F8F2">y16) </span><span style="color: #F92672">/</span><span style="color: #AE81FF">16</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #88846F">// Draw bgImage on the screen repeatedly.</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">const</span><span style="color: #F8F8F2"> repeat </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">3</span></span>
<span class="line"><span style="color: #F8F8F2">	w, h </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> bgImage.</span><span style="color: #66D9EF">Size</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> j </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">; j </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> repeat; j</span><span style="color: #F92672">++</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> i </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">; i </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> repeat; i</span><span style="color: #F92672">++</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">            op </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">ebiten.DrawImageOptions{}</span></span>
<span class="line"><span style="color: #F8F8F2">			op.GeoM.</span><span style="color: #66D9EF">Translate</span><span style="color: #F8F8F2">(</span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(w</span><span style="color: #F92672">*</span><span style="color: #F8F8F2">i), </span><span style="color: #66D9EF">float64</span><span style="color: #F8F8F2">(h</span><span style="color: #F92672">*</span><span style="color: #F8F8F2">j))</span></span>
<span class="line"><span style="color: #F8F8F2">			op.GeoM.</span><span style="color: #66D9EF">Translate</span><span style="color: #F8F8F2">(offsetX, offsetY)</span></span>
<span class="line"><span style="color: #F8F8F2">			screen.</span><span style="color: #66D9EF">DrawImage</span><span style="color: #F8F8F2">(bgImage, op)</span></span>
<span class="line"><span style="color: #F8F8F2">		}</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">moveShip</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #88846F">// Controls</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">IsKeyPressed</span><span style="color: #F8F8F2">(ebiten.KeyA) </span><span style="color: #F92672">||</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">IsKeyPressed</span><span style="color: #F8F8F2">(ebiten.KeyLeft) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// Selects preloaded sprite</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (</span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">(g.Player.Body.x) </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> g.Player.Body.width </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.Player.Body.x </span><span style="color: #F92672">-=</span><span style="color: #F8F8F2"> g.Player.Body.vx</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">	} </span><span style="color: #F92672">else</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">IsKeyPressed</span><span style="color: #F8F8F2">(ebiten.KeyD) </span><span style="color: #F92672">||</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">IsKeyPressed</span><span style="color: #F8F8F2">(ebiten.KeyRight) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F">// Moves character 3px left</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (</span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">(g.Player.Body.x) </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> ScreenWidth </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> g.Player.Body.width </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.Player.Body.x </span><span style="color: #F92672">+=</span><span style="color: #F8F8F2"> g.Player.Body.vx</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">	} </span><span style="color: #F92672">else</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">IsKeyPressed</span><span style="color: #F8F8F2">(ebiten.KeyW) </span><span style="color: #F92672">||</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">IsKeyPressed</span><span style="color: #F8F8F2">(ebiten.KeyUp) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (</span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">(g.Player.Body.y) </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> </span><span style="color: #F92672">-</span><span style="color: #F8F8F2">g.Player.Body.height </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.Player.Body.y </span><span style="color: #F92672">-=</span><span style="color: #F8F8F2"> g.Player.Body.vy</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">	} </span><span style="color: #F92672">else</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">IsKeyPressed</span><span style="color: #F8F8F2">(ebiten.KeyS) </span><span style="color: #F92672">||</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">IsKeyPressed</span><span style="color: #F8F8F2">(ebiten.KeyDown) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> (</span><span style="color: #66D9EF">int</span><span style="color: #F8F8F2">(g.Player.Body.y) </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> ScreenHeight </span><span style="color: #F92672">-</span><span style="color: #F8F8F2"> g.Player.Body.width </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">            g.Player.Body.y </span><span style="color: #F92672">+=</span><span style="color: #F8F8F2"> g.Player.Body.vy</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">  }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// functions to check if game is over, level should proceed, perhaps even boss level</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> (g </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">Game) </span><span style="color: #A6E22E">checkGameOver</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> g.Player.health </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        g.mode </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> ModeGameOver</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">main</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">    g </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">NewGame</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F">// add const screenHeight and screenWidth later</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> ebiten.</span><span style="color: #66D9EF">Run</span><span style="color: #F8F8F2">(g.Update, ScreenWidth, ScreenHeight, ScaleFactor, </span><span style="color: #E6DB74">"Space Shooter!"</span><span style="color: #F8F8F2">); err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #66D9EF">panic</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
    </content></div></div></div></div>

  <div class="mx-auto max-w-screen-lg px-3 py-6">
  <div class="no-print flex w-full">
    <form class="max-w-lg" action="https://formspree.io/f/davidli012345@gmail.com" method="POST"><div class="-mx-3 mb-6 flex flex-wrap"><div class="mb-6 w-full px-3 md:mb-0 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-first-name">First Name</label><input class="mb-3 block w-full appearance-none rounded py-3 px-4 leading-tight text-gray-700 focus:bg-white focus:outline-none" id="grid-first-name" type="text" placeholder="Jane"/></div><div class="w-full px-3 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-last-name">Last Name</label><input class="block w-full appearance-none rounded border border-gray-200  py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="grid-last-name" type="text" placeholder="Doe"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">E-mail</label><input class="mb-3 block w-full appearance-none rounded border py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="email" type="email"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">Message</label><textarea class="no-resize mb-3 block h-48 w-full resize-none appearance-none rounded border border-gray-200 py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="message"></textarea></div></div><div class="md:flex md:items-center"><div class="md:w-1/3"><button class="ml-2 shrink-0 rounded-full bg-gradient-to-br from-sky-500 to-cyan-400 px-3 py-1 text-sm font-medium text-gray-700 hover:from-sky-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-600/50" type="submit">Send</button></div><div class="md:w-2/3"></div></div></form>
    <div class="ml-3 max-w-lg bg-slate-300">
      <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
      <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
      <div id="search" class="ml-3 p-4"></div>
      
    </div>
  </div>
</div>

    </div>
    <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="no-print border-t border-gray-600 pt-5"><div class="text-sm text-gray-200">© Copyright <!-- -->2023<!-- --> by <!-- -->Astro Tech Blog<!-- -->. Built with ♥ by<!-- --> <a class="text-cyan-400 hover:underline" href="https://github.com/FriendlyUser" target="_blank" rel="noopener noreferrer">FriendlyUser</a>. Last updated on <!-- -->2023-04-11<!-- -->.</div></div></div>
  </body></html>