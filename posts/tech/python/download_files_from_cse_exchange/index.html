<!DOCTYPE html><html lang="en"><head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>How to download reports from the CSE exchange with python - Astro Tech Blog</title><meta name="description" content="By using the cad tickers library we can easily get links to docs from stocks."><meta name="author" content="David Li"><link rel="alternate" type="application/rss+xml" href="/rss.xml"><link rel="icon" type="image/x-icon" href="/favicon.ico"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6"></script><script type="text/javascript">
      let slideIndex = 1;
      showSlides(slideIndex);

      function plusSlides(n) {
        showSlides((slideIndex += n));
      }

      function currentSlide(n) {
        showSlides((slideIndex = n));
      }

      function showSlides(n) {
        try {
          let i;
          let slides = document.getElementsByClassName('mySlides');
          let dots = document.getElementsByClassName('demo');
          let captionText = document.getElementById('caption');
          if (n > slides.length) {
            slideIndex = 1;
          }
          if (n < 1) {
            slideIndex = slides.length;
          }
          for (i = 0; i < slides.length; i++) {
            slides[i].style.display = 'none';
          }
          for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(' active', '');
          }
          slides[slideIndex - 1].style.display = 'block';
          dots[slideIndex - 1].className += ' active';
          captionText.innerHTML = dots[slideIndex - 1].alt;
        } catch (err) {
          // do nothing here
        }
      }
    </script><link rel="stylesheet" href="/_astro/index.fe829d41.css" />
<style type="text/css">@media print{.no-print,.no-print *{display:none!important}}
</style><script type="module" src="/_astro/hoisted.d5e551f8.js"></script></head><body class="bg-slate-900 text-gray-100"><div class="mx-auto max-w-screen-lg px-3 py-6"><div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between"><a href="/"><div class="flex items-center bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text text-xl font-bold text-transparent"><svg class="mr-1 h-10 w-10 stroke-cyan-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none"></path><rect x="3" y="12" width="6" height="8" rx="1"></rect><rect x="9" y="8" width="6" height="12" rx="1"></rect><rect x="15" y="4" width="6" height="16" rx="1"></rect><path d="M4 20h14"></path></svg>David&#x27;s Blog</div></a><nav><ul class="flex gap-x-3 font-medium text-gray-200"><li class="hover:text-white"><a href="/posts">Blogs</a></li><li class="hover:text-white"><a href="https://github.com/FriendlyUser/astro-tech-blog">GitHub</a></li><li class="hover:text-white"><a href="/photos">Photos</a></li></ul></nav></div></div><div data-pagefind-body><div class="mx-auto max-w-screen-lg px-3 py-6"><div><h1 class="text-center text-3xl font-bold">How to download reports from the CSE exchange with python</h1><div class="mt-2 text-center text-sm text-gray-400">By <!-- -->David Li<!-- --> on <!-- -->Fri, 3 January 2024</div><div class="flex place-content-center pt-2"><div class="rounded-md px-2 py-1 text-xs font-semibold bg-green-400 text-green-900"> <a href="/tags/python" style="padding-right:3px"> <category>python<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/requests" style="padding-right:3px"> <category>requests<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/bs4" style="padding-right:3px"> <category>bs4<!-- --> </category></a></div> </div><div class="mx-auto mt-5 max-w-prose"><div class="aspect-w-3 aspect-h-2"><img class="h-full w-full rounded-lg object-cover object-center" src="/imgs/2023/3702590653.png" loading="lazy"/></div><div class="prose prose-invert mt-8 prose-img:rounded-lg"><content><p>CSE exchange refers to the Canadian Securities Exchange, which is a stock exchange located in Canada. The CSE is a fully electronic exchange that provides a marketplace for the trading of securities listed on its platform. It offers a range of listing options, including equity, debt, and structured products, and operates with a focus on serving emerging and growth companies. The exchange aims to provide an efficient, transparent, and accessible marketplace for issuers and investors, and is regulated by the Ontario Securities Commission.</p>
<p>Downloading reports from the CSE exchange can provide valuable information for investors, traders, and other market participants. The reports contain data on market activity, financial performance, and other key metrics for the companies listed on the exchange. By accessing these reports, you can gain insight into the financial health and performance of the companies, which can help inform your investment decisions.</p>
<p>For example, the CSE provides annual and quarterly financial statements, press releases, and other disclosures for companies listed on the exchange. By downloading and reviewing these reports, you can get a better understanding of a company’s financial performance, including revenue, expenses, profits, and growth trends. This information can help you make more informed decisions about whether to buy, sell, or hold a company’s stock.</p>
<p>Additionally, downloading CSE reports can provide you with insights into the overall health of the Canadian securities market, as well as emerging trends and opportunities. This information can be especially useful for traders and investors looking to make strategic decisions about their portfolios.</p>
<p>In summary, downloading reports from the CSE exchange can provide valuable information for market participants and</p>
<pre is:raw="" class="astro-code monokai" style="background-color: #272822; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F8F8F2"> </span><span style="color: #F92672">import</span><span style="color: #F8F8F2"> pandas </span><span style="color: #F92672">as</span><span style="color: #F8F8F2"> pd</span></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> time</span></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> os</span></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> requests</span></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> json</span></span>
<span class="line"><span style="color: #F92672">from</span><span style="color: #F8F8F2"> cad_tickers.exchanges.cse </span><span style="color: #F92672">import</span><span style="color: #F8F8F2"> get_recent_docs_from_url</span></span>
<span class="line"><span style="color: #F92672">from</span><span style="color: #F8F8F2"> extract_doc </span><span style="color: #F92672">import</span><span style="color: #F8F8F2"> mk_dir, handle_logic</span></span>
<span class="line"><span style="color: #F92672">from</span><span style="color: #F8F8F2"> io </span><span style="color: #F92672">import</span><span style="color: #F8F8F2"> BytesIO, StringIO</span></span>
<span class="line"><span style="color: #88846F">"""</span></span>
<span class="line"><span style="color: #88846F">1. Get the list of documents from the CSE website</span></span>
<span class="line"><span style="color: #88846F">2. For each document, get the document url</span></span>
<span class="line"><span style="color: #88846F">3. If the document url is not in the csv file, add it to the csv file</span></span>
<span class="line"><span style="color: #88846F">4. For each document url, download the document and add it to the docs folder</span></span>
<span class="line"><span style="color: #88846F">5. For each document url, make a discord request with the document url</span></span>
<span class="line"><span style="color: #88846F">6. For each document url, make a discord request with the document summary</span></span>
<span class="line"><span style="color: #88846F">"""</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF; font-style: italic">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">fig_to_buffer</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F; font-style: italic">fig</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #88846F">""" returns a matplotlib figure as a buffer</span></span>
<span class="line"><span style="color: #88846F">  """</span></span>
<span class="line"><span style="color: #F8F8F2">  buf </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> BytesIO()</span></span>
<span class="line"><span style="color: #F8F8F2">  fig.savefig(buf, </span><span style="color: #FD971F; font-style: italic">format</span><span style="color: #F92672">=</span><span style="color: #E6DB74">'png'</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">  buf.seek(</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">  imgdata </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> buf.read()</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> imgdata</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF; font-style: italic">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">make_discord_request</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F; font-style: italic">content</span><span style="color: #F8F8F2">, </span><span style="color: #FD971F; font-style: italic">embeds</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> [], </span><span style="color: #FD971F; font-style: italic">filename</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">None</span><span style="color: #F8F8F2">, </span><span style="color: #FD971F; font-style: italic">file</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">None</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">    url </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> os.getenv(</span><span style="color: #E6DB74">"DISCORD_WEBHOOK"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> url </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">None</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #66D9EF">print</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">'DISCORD_WEBHOOK Missing'</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">pass</span></span>
<span class="line"><span style="color: #F8F8F2">    data </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> {}</span></span>
<span class="line"><span style="color: #F8F8F2">    data[</span><span style="color: #E6DB74">"content"</span><span style="color: #F8F8F2">] </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> content</span></span>
<span class="line"><span style="color: #F8F8F2">    files </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> {</span><span style="color: #E6DB74">'file'</span><span style="color: #F8F8F2">: (filename, file, </span><span style="color: #E6DB74">'application/pdf'</span><span style="color: #F8F8F2">)}</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> filename </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">None</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">and</span><span style="color: #F8F8F2"> file </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">None</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">        resp </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> requests.post(</span></span>
<span class="line"><span style="color: #F8F8F2">            url, </span><span style="color: #FD971F; font-style: italic">data</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">data, </span><span style="color: #FD971F; font-style: italic">files</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">files</span></span>
<span class="line"><span style="color: #F8F8F2">        )</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">elif</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(embeds) </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">        data[</span><span style="color: #E6DB74">"embeds"</span><span style="color: #F8F8F2">] </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> embeds</span></span>
<span class="line"><span style="color: #F8F8F2">        resp </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> requests.post(</span></span>
<span class="line"><span style="color: #F8F8F2">            url, </span><span style="color: #FD971F; font-style: italic">data</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">json.dumps(data), </span><span style="color: #FD971F; font-style: italic">headers</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">{</span><span style="color: #E6DB74">"Content-Type"</span><span style="color: #F8F8F2">: </span><span style="color: #E6DB74">"application/json"</span><span style="color: #F8F8F2">}</span></span>
<span class="line"><span style="color: #F8F8F2">        )</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #66D9EF">print</span><span style="color: #F8F8F2">(resp) </span></span></code></pre>
<p>This code is a Python script that downloads documents from the Canadian Securities Exchange (CSE) website and makes a Discord request with the document URL and summary. Here’s a brief overview of what it does:</p>
<ol>
<li>It retrieves a list of documents from the CSE website using the <code>get_recent_docs_from_url</code> function.</li>
<li>For each document, it retrieves the document URL.</li>
<li>If the document URL is not already in a CSV file, it adds it to the CSV file.</li>
<li>It downloads the document and saves it to a directory called <code>docs</code>.</li>
<li>For each document URL, it makes a Discord request with the document URL.</li>
<li>For each document URL, it makes another Discord request with the document summary.</li>
</ol>
<p>The Discord request is sent using the <code>requests</code> library. The <code>make_discord_request</code> function takes in several arguments, including the content, embeds, filename, and file data. If the filename and file data are provided, the function makes a request with the file attached. If the embeds argument is provided, the function makes a request with the embeds data. The URL for the Discord webhook is read from an environment variable <code>DISCORD_WEBHOOK</code>.</p>
<pre is:raw="" class="astro-code monokai" style="background-color: #272822; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F8F8F2"> </span></span>
<span class="line"><span style="color: #F8F8F2">stockList </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> [</span><span style="color: #E6DB74">"PKK"</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">"IDK"</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">"ADDC"</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">"VPH"</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">"VST"</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">"ACT"</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #66D9EF; font-style: italic">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_cse_tickers_data</span><span style="color: #F8F8F2">():</span></span>
<span class="line"><span style="color: #F8F8F2">    url </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"https://github.com/FriendlyUser/cad_tickers_list/blob/main/static/latest/cse.csv?raw=true"</span></span>
<span class="line"><span style="color: #F8F8F2">    r </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> requests.get(url, </span><span style="color: #FD971F; font-style: italic">allow_redirects</span><span style="color: #F92672">=</span><span style="color: #AE81FF">True</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    s </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> r.content</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> pd.read_csv(StringIO(s.decode(</span><span style="color: #E6DB74">'utf-8'</span><span style="color: #F8F8F2">)))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">stock_df </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> get_cse_tickers_data()</span></span>
<span class="line"><span style="color: #F8F8F2">stock_rows </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> stock_df.loc[stock_df[</span><span style="color: #E6DB74">'Symbol'</span><span style="color: #F8F8F2">].isin(stockList)]</span></span>
<span class="line"><span style="color: #F8F8F2">stock_rows.loc[:, </span><span style="color: #E6DB74">'stock'</span><span style="color: #F8F8F2">] </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> stock_rows[</span><span style="color: #E6DB74">'Symbol'</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">stock_rows.loc[:, </span><span style="color: #E6DB74">'url'</span><span style="color: #F8F8F2">] </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> stock_rows[</span><span style="color: #E6DB74">'urls'</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">stockUrls </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> stock_rows.to_dict(</span><span style="color: #E6DB74">'records'</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">csv_file </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"docs.csv"</span></span>
<span class="line"><span style="color: #F92672">if</span><span style="color: #F8F8F2"> os.path.isfile(csv_file):</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F"># read from csv</span></span>
<span class="line"><span style="color: #F8F8F2">    df </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> pd.read_csv(csv_file)</span></span>
<span class="line"><span style="color: #F92672">else</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F"># make new df</span></span>
<span class="line"><span style="color: #F8F8F2">    df </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> pd.DataFrame(</span><span style="color: #FD971F; font-style: italic">columns</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">[</span><span style="color: #E6DB74">"stock"</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">"url"</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">"docUrl"</span><span style="color: #F8F8F2">])</span></span>
<span class="line"><span style="color: #F8F8F2"> </span></span></code></pre>
<p>This code is retrieving data for a list of stocks (<code>stockList</code>) from the Canadian Securities Exchange (CSE). It uses the <code>get_cse_tickers_data</code> function to retrieve the data from a CSV file hosted on GitHub, which contains information about CSE stocks, such as their symbol, name, and URLs. The function uses the <code>requests</code> library to make a GET request to the URL of the CSV file, and the returned content is then converted into a Pandas DataFrame using <code>pd.read_csv</code>.</p>
<p>Next, the code filters the data for only the stocks in the <code>stockList</code> by using the <code>loc</code> method on the DataFrame and checking if the value in the <code>Symbol</code> column is in the <code>stockList</code> using the <code>isin</code> method. The filtered data is then saved in the <code>stock_rows</code> DataFrame.</p>
<p>The code then creates two new columns in the <code>stock_rows</code> DataFrame, one named <code>stock</code> and the other named <code>url</code>, which contain the values from the <code>Symbol</code> and <code>urls</code> columns, respectively. The filtered data is then converted into a list of dictionaries (<code>stockUrls</code>) using the <code>to_dict</code> method.</p>
<p>Finally, the code checks if there is an existing CSV file named <code>docs.csv</code> in the current directory. If there is, it reads the data into a DataFrame using `pd.</p>
<pre is:raw="" class="astro-code monokai" style="background-color: #272822; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F8F8F2"> </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> stock </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> stockUrls:</span></span>
<span class="line"><span style="color: #F8F8F2">    stockName </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> stock.get(</span><span style="color: #E6DB74">"stock"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    stockUrl </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> stock.get(</span><span style="color: #E6DB74">"url"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    urls </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> []</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">try</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">        urls </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> get_recent_docs_from_url(stockUrl)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">except</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF; font-style: italic">Exception</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">as</span><span style="color: #F8F8F2"> e:</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">pass</span></span>
<span class="line"><span style="color: #F8F8F2">    </span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> docUrl </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> urls:</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F"># skip malformed relative urls</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> docUrl[</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">] </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">'/'</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">continue</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #88846F"># add each element to list</span></span>
<span class="line"><span style="color: #F8F8F2">        exists </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> docUrl </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> df[</span><span style="color: #E6DB74">"docUrl"</span><span style="color: #F8F8F2">].tolist()</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> exists </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">False</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #66D9EF">print</span><span style="color: #F8F8F2">(</span><span style="color: #66D9EF; font-style: italic">f</span><span style="color: #E6DB74">"Adding </span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">stockName</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74">: </span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">docUrl</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">            df.loc[</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(df)] </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> [stockName, stockUrl, docUrl]</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #88846F"># wrap in todo</span></span>
<span class="line"><span style="color: #F8F8F2">            stock_doc_dir </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF; font-style: italic">f</span><span style="color: #E6DB74">"docs/</span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">stockName</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74">"</span></span>
<span class="line"><span style="color: #F8F8F2">            mk_dir(stock_doc_dir)</span></span>
<span class="line"><span style="color: #F8F8F2">            stock_doc_file_path </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> docUrl.split(</span><span style="color: #E6DB74">"/"</span><span style="color: #F8F8F2">)[</span><span style="color: #F92672">-</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">            pdf_file_name </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF; font-style: italic">f</span><span style="color: #E6DB74">"</span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">stock_doc_dir</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74">/</span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">stock_doc_file_path</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74">.pdf"</span></span>
<span class="line"><span style="color: #F8F8F2">            companyName </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> stock.get(</span><span style="color: #E6DB74">"Company"</span><span style="color: #F8F8F2">).\</span></span>
<span class="line"><span style="color: #F8F8F2">                replace(</span><span style="color: #E6DB74">'Inc.'</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">''</span><span style="color: #F8F8F2">).\</span></span>
<span class="line"><span style="color: #F8F8F2">                replace(</span><span style="color: #E6DB74">'Pharma'</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">''</span><span style="color: #F8F8F2">).\</span></span>
<span class="line"><span style="color: #F8F8F2">                strip()</span></span>
<span class="line"><span style="color: #F8F8F2">            dataDict </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">                </span><span style="color: #E6DB74">"url"</span><span style="color: #F8F8F2">: docUrl,</span></span>
<span class="line"><span style="color: #F8F8F2">                </span><span style="color: #E6DB74">"path"</span><span style="color: #F8F8F2">: pdf_file_name,</span></span>
<span class="line"><span style="color: #F8F8F2">                </span><span style="color: #E6DB74">"company_name"</span><span style="color: #F8F8F2">: companyName</span></span>
<span class="line"><span style="color: #F8F8F2">            }</span></span>
<span class="line"><span style="color: #F8F8F2">            result_obj </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> handle_logic(dataDict)</span></span>
<span class="line"><span style="color: #F8F8F2">            file_contents </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> result_obj.get(</span><span style="color: #E6DB74">"contents"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">            summary </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"N/A"</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">try</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">                summary </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> result_obj.get(</span><span style="color: #E6DB74">"summary"</span><span style="color: #F8F8F2">)[:</span><span style="color: #AE81FF">1980</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">except</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF; font-style: italic">TypeError</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">as</span><span style="color: #F8F8F2"> e:</span></span>
<span class="line"><span style="color: #F8F8F2">                </span><span style="color: #F92672">pass</span></span>
<span class="line"><span style="color: #F8F8F2">            embeds </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> [</span></span>
<span class="line"><span style="color: #F8F8F2">                {</span></span>
<span class="line"><span style="color: #F8F8F2">                    </span><span style="color: #E6DB74">"title"</span><span style="color: #F8F8F2">: stockName,</span></span>
<span class="line"><span style="color: #F8F8F2">                    </span><span style="color: #E6DB74">"url"</span><span style="color: #F8F8F2">: docUrl,</span></span>
<span class="line"><span style="color: #F8F8F2">                    </span><span style="color: #E6DB74">"description"</span><span style="color: #F8F8F2">: summary</span></span>
<span class="line"><span style="color: #F8F8F2">                }</span></span>
<span class="line"><span style="color: #F8F8F2">            ]</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> file_contents </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">None</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">                make_discord_request(</span><span style="color: #66D9EF; font-style: italic">f</span><span style="color: #E6DB74">"*</span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">stockName</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74">*: </span><span style="color: #AE81FF">\n</span><span style="color: #E6DB74"> </span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">docUrl</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2">, embeds, pdf_file_name, file_contents)</span></span>
<span class="line"><span style="color: #F8F8F2">                time.sleep(</span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">else</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">                make_discord_request(</span><span style="color: #66D9EF; font-style: italic">f</span><span style="color: #E6DB74">"*</span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">stockName</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74">*: </span><span style="color: #AE81FF">\n</span><span style="color: #E6DB74"> </span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">docUrl</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2">, embeds)</span></span>
<span class="line"><span style="color: #F8F8F2">                time.sleep(</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">pass</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">df </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> df.drop_duplicates()</span></span>
<span class="line"><span style="color: #F8F8F2">df </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> df.sort_values(</span><span style="color: #FD971F; font-style: italic">by</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">[</span><span style="color: #E6DB74">'stock'</span><span style="color: #F8F8F2">])</span></span>
<span class="line"><span style="color: #F8F8F2">df.to_csv(csv_file, </span><span style="color: #FD971F; font-style: italic">index</span><span style="color: #F92672">=</span><span style="color: #AE81FF">False</span><span style="color: #F8F8F2">) </span></span></code></pre>
<p>This code is a script that downloads and summarizes recent documents from a list of stock symbols. The stock symbols are stored in the list <code>stockList</code>, and the data for these symbols is obtained by calling the <code>get_cse_tickers_data</code> function, which retrieves data from a CSV file stored on GitHub.</p>
<p>The code then loops through each of the stocks in <code>stockList</code>, and for each stock, it retrieves a list of recent documents by calling the <code>get_recent_docs_from_url</code> function and passing it the URL for the stock.</p>
<p>For each document, the code checks if the document URL already exists in the DataFrame <code>df</code>. If the URL does not exist, the code adds the document information (i.e., stock name, URL, and a summary) to <code>df</code> and makes a Discord request to post the information to a Discord channel. The information posted to the Discord channel includes the stock name, document URL, and a summary of the document’s contents. If the contents of the document are available, they are also included in the Discord request as an attachment.</p>
<p>After all the documents have been processed, the code removes any duplicates in <code>df</code> and sorts the entries by the stock name. Finally, the updated <code>df</code> is saved to a CSV file.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/dli-invest/cse_file_downloader/blob/main/scrap_cse_releases.py">https://github.com/dli-invest/cse_file_downloader/blob/main/scrap_cse_releases.py</a></li>
</ul></content></div></div></div></div><div class="mx-auto max-w-screen-lg px-3 py-6"><div class="no-print flex w-full"><form class="max-w-lg" action="https://formspree.io/f/davidli012345@gmail.com" method="POST"><div class="-mx-3 mb-6 flex flex-wrap"><div class="mb-6 w-full px-3 md:mb-0 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-first-name">First Name</label><input class="mb-3 block w-full appearance-none rounded py-3 px-4 leading-tight text-gray-700 focus:bg-white focus:outline-none" id="grid-first-name" type="text" placeholder="Jane"/></div><div class="w-full px-3 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-last-name">Last Name</label><input class="block w-full appearance-none rounded border border-gray-200  py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="grid-last-name" type="text" placeholder="Doe"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">E-mail</label><input class="mb-3 block w-full appearance-none rounded border py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="email" type="email"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">Message</label><textarea class="no-resize mb-3 block h-48 w-full resize-none appearance-none rounded border border-gray-200 py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="message"></textarea></div></div><div class="md:flex md:items-center"><div class="md:w-1/3"><button class="ml-2 shrink-0 rounded-full bg-gradient-to-br from-sky-500 to-cyan-400 px-3 py-1 text-sm font-medium text-gray-700 hover:from-sky-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-600/50" type="submit">Send</button></div><div class="md:w-2/3"></div></div></form><div class="ml-3 max-w-lg bg-slate-300"><link href="/_pagefind/pagefind-ui.css" rel="stylesheet"><script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script><div id="search" class="ml-3 p-4"></div></div></div></div></div><div class="mx-auto max-w-screen-lg px-3 py-6"><div class="no-print border-t border-gray-600 pt-5"><div class="text-sm text-gray-200">© Copyright <!-- -->2023<!-- --> by <!-- -->Astro Tech Blog<!-- -->. Built with ♥ by<!-- --> <a class="text-cyan-400 hover:underline" href="https://github.com/FriendlyUser" target="_blank" rel="noopener noreferrer">FriendlyUser</a>. Last updated on <!-- -->2023-11-09<!-- -->.</div></div><script src="https://cdn.botpress.cloud/webchat/v0/inject.js"></script><script src="https://mediafiles.botpress.cloud/0df54034-3318-451a-aed0-3923a4ee25a5/webchat/config.js" defer=""></script></div></body></html>