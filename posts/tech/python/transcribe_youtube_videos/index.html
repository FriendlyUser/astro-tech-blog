<!DOCTYPE html><html lang="en"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Chapter 2 Basic syntax and data types. - FriendlyUsers Tech Blog</title><meta name="description" content="Describing how to use python to program."><meta name="author" content="David Li"><link rel="alternate" type="application/rss+xml" href="/rss.xml"><link rel="icon" type="image/x-icon" href="/favicon.ico"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6"></script><script type="text/javascript">
      let slideIndex = 1;
      showSlides(slideIndex);

      function plusSlides(n) {
        showSlides((slideIndex += n));
      }

      function currentSlide(n) {
        showSlides((slideIndex = n));
      }

      function showSlides(n) {
        try {
          let i;
          let slides = document.getElementsByClassName('mySlides');
          let dots = document.getElementsByClassName('demo');
          let captionText = document.getElementById('caption');
          if (n > slides.length) {
            slideIndex = 1;
          }
          if (n < 1) {
            slideIndex = slides.length;
          }
          for (i = 0; i < slides.length; i++) {
            slides[i].style.display = 'none';
          }
          for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(' active', '');
          }
          slides[slideIndex - 1].style.display = 'block';
          dots[slideIndex - 1].className += ' active';
          captionText.innerHTML = dots[slideIndex - 1].alt;
        } catch (err) {
          // do nothing here
        }
      }
    </script><!-- Google Tag Manager --><!-- End Google Tag Manager --><link rel="stylesheet" href="/_astro/index.DFWZl3Z8.css" />
<style>.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);-webkit-clip-path:inset(50%);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}@media print{.no-print,.no-print *{display:none!important}}
</style><script type="module" src="/_astro/hoisted.CcuKkQrI.js"></script></head> <body class="bg-slate-900 text-gray-100"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K8P5P8FQ" height="0" width="0" style="display:none;visibility:hidden"></iframe> </noscript> <!-- End Google Tag Manager (noscript) --> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between"><a href="/"><div class="flex items-center bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text text-xl font-bold text-transparent"><svg class="mr-1 h-10 w-10 stroke-cyan-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none"></path><rect x="3" y="12" width="6" height="8" rx="1"></rect><rect x="9" y="8" width="6" height="12" rx="1"></rect><rect x="15" y="4" width="6" height="16" rx="1"></rect><path d="M4 20h14"></path></svg>David&#x27;s Blog</div></a><nav><ul class="flex gap-x-3 font-medium text-gray-200"><li class="hover:text-white"><a href="/posts">Blogs</a></li><li class="hover:text-white"><a href="https://github.com/FriendlyUser/astro-tech-blog">GitHub</a></li><li class="hover:text-white"><a href="/photos">Photos</a></li></ul></nav></div></div> <div data-pagefind-body>  <div class="mx-auto max-w-screen-lg px-3 py-6"><div><h1 class="text-center text-3xl font-bold">Chapter 2 Basic syntax and data types.</h1><div class="mt-2 text-center text-sm text-gray-400">By <!-- -->David Li<!-- --> on <!-- -->Fri, 14 October 2024</div><div class="flex place-content-center pt-2"><div class="rounded-md px-2 py-1 text-xs font-semibold bg-green-400 text-green-900"> <a href="/tags/python" style="padding-right:3px"> <category>python<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/whispers" style="padding-right:3px"> <category>whispers<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/gradio" style="padding-right:3px"> <category>gradio<!-- --> </category></a></div> </div><div class="mx-auto mt-5 max-w-prose"><div class="aspect-w-3 aspect-h-2"><img class="h-full w-full rounded-lg object-cover object-center" src="/imgs/2023/492664568.png" loading="lazy"/></div><div class="prose prose-invert mt-8 prose-img:rounded-lg"><content> <p>Transcribing videos is important for several reasons. Firstly, it makes the content of the video more accessible to people who are deaf or hard of hearing. Secondly, it can improve search engine optimization (SEO) as the text in the transcription can be indexed by search engines. Thirdly, it can make it easier to create captions or subtitles for the video, which can again make it more accessible to a wider audience. Finally, transcribing videos can be useful for researchers or content creators who want to analyze the content of the video or repurpose it in other ways.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672"> import</span><span style="color:#F8F8F2"> whisper</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> gradio </span><span style="color:#F92672">as</span><span style="color:#F8F8F2"> gr</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> ffmpeg</span></span>
<span class="line"><span style="color:#F92672">from</span><span style="color:#F8F8F2"> yt_dlp </span><span style="color:#F92672">import</span><span style="color:#F8F8F2"> YoutubeDL</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> os</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> sys</span></span>
<span class="line"><span style="color:#F92672">from</span><span style="color:#F8F8F2"> subprocess </span><span style="color:#F92672">import</span><span style="color:#AE81FF"> PIPE</span><span style="color:#F8F8F2">, run</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">youtube_livestream_codes </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [</span></span>
<span class="line"><span style="color:#AE81FF">    91</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    92</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    93</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    94</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    95</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    96</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    300</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    301</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">youtube_mp4_codes </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [</span></span>
<span class="line"><span style="color:#AE81FF">    298</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    18</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    22</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    140</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    133</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#AE81FF">    134</span></span>
<span class="line"><span style="color:#F8F8F2">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> second_to_timecode</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">x</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">float</span><span style="color:#F8F8F2">) -> </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">    hour, x </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> divmod</span><span style="color:#F8F8F2">(x, </span><span style="color:#AE81FF">3600</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    minute, x </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> divmod</span><span style="color:#F8F8F2">(x, </span><span style="color:#AE81FF">60</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    second, x </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> divmod</span><span style="color:#F8F8F2">(x, </span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    millisecond </span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic"> int</span><span style="color:#F8F8F2">(x </span><span style="color:#F92672">*</span><span style="color:#AE81FF"> 1000</span><span style="color:#F8F8F2">.)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#E6DB74"> '</span><span style="color:#AE81FF">%.2d</span><span style="color:#E6DB74">:</span><span style="color:#AE81FF">%.2d</span><span style="color:#E6DB74">:</span><span style="color:#AE81FF">%.2d</span><span style="color:#E6DB74">,</span><span style="color:#AE81FF">%.3d</span><span style="color:#E6DB74">'</span><span style="color:#F92672"> %</span><span style="color:#F8F8F2"> (hour, minute, second, millisecond)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> get_video_metadata</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">video_url</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F92672"> =</span><span style="color:#E6DB74"> "https://www.youtube.com/watch?v=21X5lGlDOfg&#x26;ab_channel=NASA"</span><span style="color:#F8F8F2">)-> </span><span style="color:#66D9EF;font-style:italic">dict</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">    with</span><span style="color:#F8F8F2"> YoutubeDL({</span><span style="color:#E6DB74">'outtmpl'</span><span style="color:#F8F8F2">: </span><span style="color:#E6DB74">'</span><span style="color:#AE81FF">%(id)s</span><span style="color:#E6DB74">.</span><span style="color:#AE81FF">%(ext)s</span><span style="color:#E6DB74">'</span><span style="color:#F8F8F2">}) </span><span style="color:#F92672">as</span><span style="color:#F8F8F2"> ydl:</span></span>
<span class="line"><span style="color:#F8F8F2">        info_dict </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> ydl.extract_info(video_url, </span><span style="color:#FD971F;font-style:italic">download</span><span style="color:#F92672">=</span><span style="color:#AE81FF">False</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        video_title </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> info_dict.get(</span><span style="color:#E6DB74">'title'</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">None</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        uploader_id </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> info_dict.get(</span><span style="color:#E6DB74">'uploader_id'</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">None</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#66D9EF">        print</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF;font-style:italic">f</span><span style="color:#E6DB74">"[youtube] </span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">video_title</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">: </span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">uploader_id</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> info_dict</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> parse_metadata</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">metadata</span><span style="color:#F8F8F2">) -> </span><span style="color:#66D9EF;font-style:italic">dict</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#E6DB74">    """</span></span>
<span class="line"><span style="color:#E6DB74">    Parse metadata and send to discord.</span></span>
<span class="line"><span style="color:#E6DB74">    After a video is done recording, </span></span>
<span class="line"><span style="color:#E6DB74">    it will have both the livestream format and the mp4 format.</span></span>
<span class="line"><span style="color:#E6DB74">    """</span></span>
<span class="line"><span style="color:#88846F">    # send metadata to discord</span></span>
<span class="line"><span style="color:#F8F8F2">    formats </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> metadata.get(</span><span style="color:#E6DB74">"formats"</span><span style="color:#F8F8F2">, [])</span></span>
<span class="line"><span style="color:#88846F">    # filter for ext = mp4</span></span>
<span class="line"><span style="color:#F8F8F2">    mp4_formats </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [f </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> f </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> formats </span><span style="color:#F92672">if</span><span style="color:#F8F8F2"> f.get(</span><span style="color:#E6DB74">"ext"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">""</span><span style="color:#F8F8F2">) </span><span style="color:#F92672">==</span><span style="color:#E6DB74"> "mp4"</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F92672">    try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        format_ids </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [</span><span style="color:#66D9EF;font-style:italic">int</span><span style="color:#F8F8F2">(f.get(</span><span style="color:#E6DB74">"format_id"</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)) </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> f </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> mp4_formats]</span></span>
<span class="line"><span style="color:#F8F8F2">        video_entries </span><span style="color:#F92672">=</span><span style="color:#66D9EF"> sorted</span><span style="color:#F8F8F2">(</span><span style="color:#66D9EF;font-style:italic">set</span><span style="color:#F8F8F2">(format_ids).intersection(youtube_mp4_codes))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">        is_livestream </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> True</span></span>
<span class="line"><span style="color:#F92672">        if</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(video_entries) </span><span style="color:#F92672">></span><span style="color:#AE81FF"> 0</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#88846F">            # use video format id over livestream id if available</span></span>
<span class="line"><span style="color:#F8F8F2">            selected_id </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> video_entries[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">            is_livestream </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> False</span></span>
<span class="line"><span style="color:#F92672">    except</span><span style="color:#66D9EF;font-style:italic"> Exception</span><span style="color:#F92672"> as</span><span style="color:#F8F8F2"> e:</span></span>
<span class="line"><span style="color:#66D9EF">        print</span><span style="color:#F8F8F2">(e)</span></span>
<span class="line"><span style="color:#F8F8F2">        selected_id </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> mp4_formats[</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">].get(</span><span style="color:#E6DB74">"format_id"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        is_livestream </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> False</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#E6DB74">        "selected_id"</span><span style="color:#F8F8F2">: selected_id,</span></span>
<span class="line"><span style="color:#E6DB74">        "is_livestream"</span><span style="color:#F8F8F2">: is_livestream,</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span></span></code></pre>
<p>The above code is written in Python and contains functions for getting metadata for a YouTube video, parsing the metadata, and converting seconds to timecode. It also imports the necessary libraries including <code>whisper</code>, <code>gradio</code>, <code>ffmpeg</code>, <code>yt_dlp</code>, <code>os</code>, <code>sys</code>, and <code>subprocess</code>.</p>
<p>The <code>get_video_metadata</code> function takes a YouTube video URL as input and returns a dictionary containing metadata about the video such as the title and uploader ID. This function uses the <code>YoutubeDL</code> library to extract information about the video from YouTube.</p>
<p>The <code>parse_metadata</code> function takes the metadata dictionary as input and returns a dictionary containing the selected video format ID and a boolean indicating whether the video is a livestream or not. This function filters the available video formats to only include MP4 formats and then selects the video format with the highest priority (based on the priority list <code>youtube_mp4_codes</code>). If no MP4 format is available, it selects the first available format.</p>
<p>The <code>second_to_timecode</code> function takes a floating-point number representing a time in seconds as input and returns a string formatted as <code>hh:mm:ss,ms</code> (hours:minutes:seconds,milliseconds) where <code>ms</code> is the milliseconds portion of the time.</p>
<p>Note that the code also includes a list of YouTube format codes for livestreams (<code>youtube_livestream_codes</code>) and MP4 formats (<code>youtube_mp4_codes</code>).</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#66D9EF;font-style:italic"> def</span><span style="color:#A6E22E"> get_video</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">url</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">config</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">dict</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#E6DB74">    """</span></span>
<span class="line"><span style="color:#E6DB74">    Get video from start time.</span></span>
<span class="line"><span style="color:#E6DB74">    """</span></span>
<span class="line"><span style="color:#88846F">    # result = subprocess.run()</span></span>
<span class="line"><span style="color:#88846F">    # could delay start time by a few seconds to just sync up and capture the full video length</span></span>
<span class="line"><span style="color:#88846F">    # but would need to time how long it takes to fetch the video using youtube-dl and other adjustments and start a bit before</span></span>
<span class="line"><span style="color:#F8F8F2">    filename </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> config.get(</span><span style="color:#E6DB74">"filename"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"livestream01.mp4"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    end </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> config.get(</span><span style="color:#E6DB74">"end"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"00:15:00"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    overlay_file </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> ffmpeg.input(filename)</span></span>
<span class="line"><span style="color:#F8F8F2">    (</span></span>
<span class="line"><span style="color:#F8F8F2">        ffmpeg</span></span>
<span class="line"><span style="color:#F8F8F2">        .input(url, </span><span style="color:#FD971F;font-style:italic">t</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">end)</span></span>
<span class="line"><span style="color:#F8F8F2">        .output(filename)</span></span>
<span class="line"><span style="color:#F8F8F2">        .run()</span></span>
<span class="line"><span style="color:#F8F8F2">    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> get_all_files</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">url</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">end</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F92672"> =</span><span style="color:#E6DB74"> "00:15:00"</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">    metadata </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> get_video_metadata(url)</span></span>
<span class="line"><span style="color:#F8F8F2">    temp_dict </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parse_metadata(metadata)</span></span>
<span class="line"><span style="color:#F8F8F2">    selected_id </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> temp_dict.get(</span><span style="color:#E6DB74">"selected_id"</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    formats </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> metadata.get(</span><span style="color:#E6DB74">"formats"</span><span style="color:#F8F8F2">, [])</span></span>
<span class="line"><span style="color:#F8F8F2">    selected_format </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> [f </span><span style="color:#F92672">for</span><span style="color:#F8F8F2"> f </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> formats </span><span style="color:#F92672">if</span><span style="color:#F8F8F2"> f.get(</span><span style="color:#E6DB74">"format_id"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">""</span><span style="color:#F8F8F2">) </span><span style="color:#F92672">==</span><span style="color:#66D9EF;font-style:italic"> str</span><span style="color:#F8F8F2">(selected_id)][</span><span style="color:#AE81FF">0</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">    format_url </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> selected_format.get(</span><span style="color:#E6DB74">"url"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">""</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    filename </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> "temp.mp4"</span></span>
<span class="line"><span style="color:#F8F8F2">    get_video(format_url, {</span><span style="color:#E6DB74">"filename"</span><span style="color:#F8F8F2">: filename, </span><span style="color:#E6DB74">"end"</span><span style="color:#F8F8F2">: end})</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> filename</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> get_text_from_mp3_whisper</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">inputType</span><span style="color:#F8F8F2">:</span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">mp3_file</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">url_path</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">taskName</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">srcLanguage</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">)-></span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#88846F">    # remove the file if it exists</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> os.path.exists(</span><span style="color:#E6DB74">"transcript.srt"</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">        os.remove(</span><span style="color:#E6DB74">"transcript.srt"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    </span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> os.path.exists(</span><span style="color:#E6DB74">"temp.mp4"</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">        os.remove(</span><span style="color:#E6DB74">"temp.mp4"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    </span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> os.path.exists(</span><span style="color:#E6DB74">"subtitled.mp4"</span><span style="color:#F8F8F2">):</span></span>
<span class="line"><span style="color:#F8F8F2">        os.remove(</span><span style="color:#E6DB74">"subtitled.mp4"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    </span></span>
<span class="line"><span style="color:#F8F8F2">    model </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> whisper.load_model(</span><span style="color:#E6DB74">"medium"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#88846F">    # options = whisper.DecodingOptions(language="en", without_timestamps=True)</span></span>
<span class="line"><span style="color:#F8F8F2">    options </span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic"> dict</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">language</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">srcLanguage)</span></span>
<span class="line"><span style="color:#F8F8F2">    transcribe_options </span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic"> dict</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">task</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">taskName, </span><span style="color:#F92672">**</span><span style="color:#F8F8F2">options)</span></span>
<span class="line"><span style="color:#88846F">    # return if url_path is not set, taskName is not set, srcLanguage is not set</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> inputType </span><span style="color:#F92672">==</span><span style="color:#E6DB74"> "url"</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        filename </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> get_all_files(url_path)</span></span>
<span class="line"><span style="color:#66D9EF">        print</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"Retrieved the file"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        result </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> model.transcribe(filename, </span><span style="color:#F92672">**</span><span style="color:#F8F8F2">transcribe_options)</span></span>
<span class="line"><span style="color:#66D9EF">        print</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"transcribing the file"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">    else</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        result </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> model.transcribe(mp3_file, </span><span style="color:#F92672">**</span><span style="color:#F8F8F2">transcribe_options)</span></span>
<span class="line"><span style="color:#88846F">    # adjust for spacy mode</span></span>
<span class="line"><span style="color:#F8F8F2">    html_text </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> ""</span></span>
<span class="line"><span style="color:#F8F8F2">    lines </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> count, segment </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> enumerate</span><span style="color:#F8F8F2">(result.get(</span><span style="color:#E6DB74">"segments"</span><span style="color:#F8F8F2">)):</span></span>
<span class="line"><span style="color:#88846F">        # print(segment)</span></span>
<span class="line"><span style="color:#F8F8F2">        start </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> segment.get(</span><span style="color:#E6DB74">"start"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        end </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> segment.get(</span><span style="color:#E6DB74">"end"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        lines.append(</span><span style="color:#66D9EF;font-style:italic">f</span><span style="color:#E6DB74">"</span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">count</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        lines.append(</span><span style="color:#66D9EF;font-style:italic">f</span><span style="color:#E6DB74">"</span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">second_to_timecode(start)</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74"> --> </span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">second_to_timecode(end)</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        lines.append(segment.get(</span><span style="color:#E6DB74">"text"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">""</span><span style="color:#F8F8F2">).strip())</span></span>
<span class="line"><span style="color:#F8F8F2">        lines.append(</span><span style="color:#E6DB74">''</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    words </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> '</span><span style="color:#AE81FF">\n</span><span style="color:#E6DB74">'</span><span style="color:#F8F8F2">.join(lines)</span></span>
<span class="line"><span style="color:#88846F">    # save to transcript.srt</span></span>
<span class="line"><span style="color:#F92672">    with</span><span style="color:#66D9EF"> open</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"transcript.srt"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"w"</span><span style="color:#F8F8F2">) </span><span style="color:#F92672">as</span><span style="color:#F8F8F2"> f:</span></span>
<span class="line"><span style="color:#F8F8F2">        f.write(words)</span></span>
<span class="line"><span style="color:#66D9EF">    print</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"done transcribing"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    input_file </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> 'temp.mp4'</span></span>
<span class="line"><span style="color:#F8F8F2">    subtitles_file </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> 'transcript.srt'</span></span>
<span class="line"><span style="color:#F8F8F2">    output_file </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> 'subtitled.mp4'</span></span>
<span class="line"><span style="color:#F92672">    try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#66D9EF">        print</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"attempt to output file"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        (</span></span>
<span class="line"><span style="color:#F8F8F2">            ffmpeg</span></span>
<span class="line"><span style="color:#F8F8F2">            .input(input_file)</span></span>
<span class="line"><span style="color:#F8F8F2">            .filter(</span><span style="color:#E6DB74">'subtitles'</span><span style="color:#F8F8F2">, subtitles_file)</span></span>
<span class="line"><span style="color:#F8F8F2">            .output(output_file)</span></span>
<span class="line"><span style="color:#F8F8F2">            .run()</span></span>
<span class="line"><span style="color:#F8F8F2">        )</span></span>
<span class="line"><span style="color:#F92672">    except</span><span style="color:#66D9EF;font-style:italic"> Exception</span><span style="color:#F92672"> as</span><span style="color:#F8F8F2"> e:</span></span>
<span class="line"><span style="color:#66D9EF">        print</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"failed to output file"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#66D9EF">        print</span><span style="color:#F8F8F2">(e)</span></span>
<span class="line"><span style="color:#F8F8F2">        output_file </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> "temp.mp4"</span></span>
<span class="line"><span style="color:#88846F">    # return temp.mp4</span></span>
<span class="line"><span style="color:#F8F8F2">    </span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> result.get(</span><span style="color:#E6DB74">"segments"</span><span style="color:#F8F8F2">), words, output_file </span></span></code></pre>
<p>The <code>get_text_from_mp3_whisper</code> function takes several arguments including <code>inputType</code>, <code>mp3_file</code>, <code>url_path</code>, <code>taskName</code>, and <code>srcLanguage</code>. It first removes any existing files with names <code>transcript.srt</code>, <code>temp.mp4</code>, and <code>subtitled.mp4</code>.</p>
<p>It then loads a pre-trained model from <code>whisper</code> using the <code>load_model</code> function. The function checks the value of <code>inputType</code> to determine whether to transcribe a local mp3 file (<code>mp3_file</code>) or a video at a remote URL (<code>url_path</code>). If <code>inputType</code> is <code>"url"</code>, it downloads the video from the remote URL using the <code>get_all_files</code> function and transcribes it. If <code>inputType</code> is <code>"file"</code>, it transcribes the local mp3 file.</p>
<p>The transcribed segments are then saved to a file named <code>transcript.srt</code>. The function then attempts to add subtitles to the video by overlaying the saved SRT file onto a copy of the video file. The resulting file is saved as <code>subtitled.mp4</code>. If the overlaying process fails, it saves the resulting file as <code>temp.mp4</code>.</p>
<p>The function then returns the segments and the contents of the SRT file as a string, as well as the name of the resulting video file.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F8F8F2"> gr.Interface(</span></span>
<span class="line"><span style="color:#FD971F;font-style:italic">    title</span><span style="color:#F92672"> =</span><span style="color:#E6DB74"> 'Download Video From url and extract text from audio'</span><span style="color:#F8F8F2">, </span></span>
<span class="line"><span style="color:#FD971F;font-style:italic">    fn</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">get_text_from_mp3_whisper, </span></span>
<span class="line"><span style="color:#FD971F;font-style:italic">    inputs</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">[</span></span>
<span class="line"><span style="color:#F8F8F2">        gr.Dropdown([</span><span style="color:#E6DB74">"url"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"file"</span><span style="color:#F8F8F2">], </span><span style="color:#FD971F;font-style:italic">value</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"url"</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">        gr.inputs.Audio(</span><span style="color:#FD971F;font-style:italic">type</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"filepath"</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">        gr.inputs.Textbox(),</span></span>
<span class="line"><span style="color:#F8F8F2">        gr.Dropdown([</span><span style="color:#E6DB74">"translate"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"transcribe"</span><span style="color:#F8F8F2">], </span><span style="color:#FD971F;font-style:italic">value</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"translate"</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#F8F8F2">        gr.Dropdown([</span><span style="color:#E6DB74">"Japanese"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"English"</span><span style="color:#F8F8F2">], </span><span style="color:#FD971F;font-style:italic">value</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"Japanese"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    ],</span></span>
<span class="line"><span style="color:#FD971F;font-style:italic">    button_text</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"Go!"</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#FD971F;font-style:italic">    button_color</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"#333333"</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#FD971F;font-style:italic">    outputs</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">[</span></span>
<span class="line"><span style="color:#E6DB74">        "json"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"text"</span><span style="color:#F8F8F2">, </span><span style="color:#E6DB74">"file"</span></span>
<span class="line"><span style="color:#F8F8F2">    ], </span></span></code></pre>
<p>It seems that the code block is not complete, as there is no closing parenthesis for the <code>gr.Interface</code> function call. However, assuming that the rest of the code is present, this function call creates a user interface using the <code>gradio</code> library.</p>
<p>The interface has a title, “Download Video From url and extract text from audio”, and it takes in the following inputs:</p>
<ol>
<li>A dropdown menu to select the input type (“url” or “file”).</li>
<li>An audio input to upload an audio file.</li>
<li>A textbox to enter the URL of a video.</li>
<li>A dropdown menu to select the task (“translate” or “transcribe”).</li>
<li>A dropdown menu to select the source language (“Japanese” or “English”).</li>
</ol>
<p>The interface also has a button with text “Go!” and color “#333333”, and it outputs a JSON object, a string of text, and a file.</p>
<p>Using AI to transcribe videos has many practical benefits. Firstly, it enables the creation of accurate, searchable and accessible transcripts that can be used for a variety of purposes. Transcripts can be used to help people with hearing impairments to understand video content, as well as to provide captions and subtitles for non-native speakers of the video’s language. Transcripts can also be used to provide metadata for video content, making it easier to search and categorize. Additionally, transcripts can be used to analyze the content of video content, allowing for more effective search and retrieval of relevant information.</p>
<p>AI-based transcription is also faster and more cost-effective than traditional human transcription methods. With the advances in AI technology, transcription can be done much faster and at a lower cost than hiring human transcribers. This allows for more content to be transcribed in a shorter amount of time, and at a lower cost. Furthermore, AI-based transcription can be easily scaled up or down depending on the size of the content that needs to be transcribed.</p>
<p>Overall, using AI to transcribe videos is a useful and practical application of AI technology that has the potential to significantly improve the accessibility and usability of video content.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://huggingface.co/spaces/FriendlyUser/YoutubeDownloaderSubber">https://huggingface.co/spaces/FriendlyUser/YoutubeDownloaderSubber</a></li>
</ul> </content></div></div></div></div> <div class="mx-auto max-w-screen-lg px-3 py-6"> <div class="no-print flex w-full"> <form class="max-w-lg" action="https://formspree.io/f/davidli012345@gmail.com" method="POST"><div class="-mx-3 mb-6 flex flex-wrap"><div class="mb-6 w-full px-3 md:mb-0 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-first-name">First Name</label><input class="mb-3 block w-full appearance-none rounded py-3 px-4 leading-tight text-gray-700 focus:bg-white focus:outline-none" id="grid-first-name" type="text" placeholder="Jane"/></div><div class="w-full px-3 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-last-name">Last Name</label><input class="block w-full appearance-none rounded border border-gray-200  py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="grid-last-name" type="text" placeholder="Doe"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">E-mail</label><input class="mb-3 block w-full appearance-none rounded border py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="email" type="email"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">Message</label><textarea class="no-resize mb-3 block h-48 w-full resize-none appearance-none rounded border border-gray-200 py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="message"></textarea></div></div><div class="md:flex md:items-center"><div class="md:w-1/3"><button class="ml-2 shrink-0 rounded-full bg-gradient-to-br from-sky-500 to-cyan-400 px-3 py-1 text-sm font-medium text-gray-700 hover:from-sky-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-600/50" type="submit">Send</button></div><div class="md:w-2/3"></div></div></form> <div class="ml-3 max-w-lg bg-slate-300"> <link href="/_pagefind/pagefind-ui.css" rel="stylesheet"> <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script> <div id="search" class="ml-3 p-4"></div>  </div> </div> </div>  </div> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="no-print border-t border-gray-600 pt-5"><div class="text-sm text-gray-200">© Copyright <!-- -->2024<!-- --> by <!-- -->FriendlyUsers Tech Blog<!-- -->. Built with ♥ by<!-- --> <a class="text-cyan-400 hover:underline" href="https://github.com/FriendlyUser" target="_blank" rel="noopener noreferrer">FriendlyUser</a>. Last updated on <!-- -->2024-11-28<!-- -->.</div></div><script src="https://cdn.botpress.cloud/webchat/v0/inject.js"></script><script src="https://mediafiles.botpress.cloud/0df54034-3318-451a-aed0-3923a4ee25a5/webchat/config.js" defer=""></script></div> </body></html>