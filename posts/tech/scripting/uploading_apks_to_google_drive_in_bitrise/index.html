<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to upload apks to google drive in bitrise - Astro Tech Blog</title>
    <meta name="description" content="Uploading apks to google drive in golang from bitrise">
    <meta name="author" content="David Li">

    <link rel="alternate" type="application/rss+xml" href="/rss.xml">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">

    </script>
    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6">

    </script>
    
    <script type="text/javascript">
      let slideIndex = 1;
      showSlides(slideIndex);

      function plusSlides(n) {
        showSlides((slideIndex += n));
      }

      function currentSlide(n) {
        showSlides((slideIndex = n));
      }

      function showSlides(n) {
        try {
          let i;
          let slides = document.getElementsByClassName('mySlides');
          let dots = document.getElementsByClassName('demo');
          let captionText = document.getElementById('caption');
          if (n > slides.length) {
            slideIndex = 1;
          }
          if (n < 1) {
            slideIndex = slides.length;
          }
          for (i = 0; i < slides.length; i++) {
            slides[i].style.display = 'none';
          }
          for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(' active', '');
          }
          slides[slideIndex - 1].style.display = 'block';
          dots[slideIndex - 1].className += ' active';
          captionText.innerHTML = dots[slideIndex - 1].alt;
        } catch(err) {
          // do nothing here
        }
      }
    </script>
  <link rel="stylesheet" href="/_astro/index.e6d5c001.css" />
<link rel="stylesheet" href="/_astro/index.be9bd85e.css" /><script type="module" src="/_astro/hoisted.b1b88089.js"></script></head>
  <body class="bg-slate-900 text-gray-100">
    <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between"><a href="/"><div class="flex items-center bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text text-xl font-bold text-transparent"><svg class="mr-1 h-10 w-10 stroke-cyan-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none"></path><rect x="3" y="12" width="6" height="8" rx="1"></rect><rect x="9" y="8" width="6" height="12" rx="1"></rect><rect x="15" y="4" width="6" height="16" rx="1"></rect><path d="M4 20h14"></path></svg>David&#x27;s Blog</div></a><nav><ul class="flex gap-x-3 font-medium text-gray-200"><li class="hover:text-white"><a href="/posts">Blogs</a></li><li class="hover:text-white"><a href="https://github.com/FriendlyUser/astro-tech-blog">GitHub</a></li><li class="hover:text-white"><a href="/photos">Photos</a></li></ul></nav></div></div>
    <div data-pagefind-body>
      
  <div class="mx-auto max-w-screen-lg px-3 py-6"><div><h1 class="text-center text-3xl font-bold">How to upload apks to google drive in bitrise</h1><div class="mt-2 text-center text-sm text-gray-400">By <!-- -->David Li<!-- --> on <!-- -->Wednesday, 7 April 2023 13:00:00 GMT</div><div class="flex place-content-center pt-2"><div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/go" style="padding-right:3px"> <category>go<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-zinc-400 text-zinc-900"> <a href="/tags/git" style="padding-right:3px"> <category>git<!-- --> </category></a></div> </div><div class="mx-auto mt-5 max-w-prose"><div class="aspect-w-3 aspect-h-2"><img class="h-full w-full rounded-lg object-cover object-center" src="/imgs/2023/dall-e/upload_icon_cloud.png" loading="lazy"/></div><div class="prose prose-invert mt-8 prose-img:rounded-lg"><content>
    <p>Bitrise is a continuous integration and delivery platform that allows you to automate your build, test, and deployment processes. You can define these processes using a combination of pre-built steps and custom scripts written in Bash or Go.</p>
<p>Using the google drive api we can upload apks to a specified google drive folder using a service account and sharing the folder to that service account.</p>
<pre is:raw="" class="astro-code monokai" style="background-color: #272822; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F8F8F2">https://drive.google.com/drive/u/4/folders/{folderId}</span></span></code></pre>
<p>Note once the folder is shared to that service account we can upload files to google drive using the folder id. Depending on demand its possible to extend this to upload to a specific folder under the parent folder.</p>
<pre is:raw="" class="astro-code monokai" style="background-color: #272822; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F92672">package</span><span style="color: #F8F8F2"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"fmt"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"os"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"github.com/FriendlyUser/bitrise-step-google-drive-uploader/pkg/utils"</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">main</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">	fmt.</span><span style="color: #66D9EF">Println</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"This is the value specified for the input 'service_key_path':"</span><span style="color: #F8F8F2">, os.</span><span style="color: #66D9EF">Getenv</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"service_key_path"</span><span style="color: #F8F8F2">))</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #88846F">// and print folder_id</span></span>
<span class="line"><span style="color: #F8F8F2">	fmt.</span><span style="color: #66D9EF">Println</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"This is the value specified for the input 'folder_id':"</span><span style="color: #F8F8F2">, os.</span><span style="color: #66D9EF">Getenv</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"folder_id"</span><span style="color: #F8F8F2">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	serviceAccount </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> os.</span><span style="color: #66D9EF">Getenv</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"service_key_path"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">	folderId </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> os.</span><span style="color: #66D9EF">Getenv</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"folder_id"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #88846F">// find all files with the extension ending with *.apk</span></span>
<span class="line"><span style="color: #F8F8F2">	files, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> utils.</span><span style="color: #66D9EF">FindFiles</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"**/*.apk"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #88846F">// check if BITRISE_APK_PATH is set</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> os.</span><span style="color: #66D9EF">Getenv</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"BITRISE_APK_PATH"</span><span style="color: #F8F8F2">) </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">""</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #88846F">// if it is set, add it to the files slice</span></span>
<span class="line"><span style="color: #F8F8F2">		files </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">append</span><span style="color: #F8F8F2">(files, os.</span><span style="color: #66D9EF">Getenv</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"BITRISE_APK_PATH"</span><span style="color: #F8F8F2">))</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		fmt.</span><span style="color: #66D9EF">Println</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">		os.</span><span style="color: #66D9EF">Exit</span><span style="color: #F8F8F2">(</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #88846F">// upload all apk files</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> _, file </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">range</span><span style="color: #F8F8F2"> files {</span></span>
<span class="line"><span style="color: #F8F8F2">		utils.</span><span style="color: #66D9EF">UploadFile</span><span style="color: #F8F8F2">(serviceAccount, file, folderId)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	os.</span><span style="color: #66D9EF">Exit</span><span style="color: #F8F8F2">(</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>This is a modified version of the Go program that is designed to be used as a build step in the Bitrise CI/CD platform. The program reads in two input environment variables: service_key_path and folder_id. It then uses the utils package to search for all files with the .apk extension in the current directory and its subdirectories, and adds the BITRISE_APK_PATH environment variable (if it is set) to the list of files. Finally, the program iterates over the list of files and uses the utils.UploadFile function to upload each file to Google Drive using the serviceAccount and folderId variables.</p>
<p>The program then exits with a status code of 0, indicating success. It is good practice to always specify an exit code at the end of a build step, as it helps the CI/CD platform determine whether the step was successful or not.</p>
<pre is:raw="" class="astro-code monokai" style="background-color: #272822; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F92672">package</span><span style="color: #F8F8F2"> utils</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"context"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"encoding/json"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"fmt"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"io/ioutil"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"log"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"net/http"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"os"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"path/filepath"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	drive </span><span style="color: #E6DB74">"google.golang.org/api/drive/v3"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"golang.org/x/oauth2"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"golang.org/x/oauth2/google"</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">"golang.org/x/oauth2/jwt"</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// ServiceAccount : Use Service account</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">serviceAccount</span><span style="color: #F8F8F2">(credentialFile </span><span style="color: #66D9EF; font-style: italic">string</span><span style="color: #F8F8F2">) </span><span style="color: #F92672">*</span><span style="color: #F8F8F2">http.Client {</span></span>
<span class="line"><span style="color: #F8F8F2">	b, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> ioutil.</span><span style="color: #66D9EF">ReadFile</span><span style="color: #F8F8F2">(credentialFile)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		log.</span><span style="color: #66D9EF">Fatal</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">var</span><span style="color: #F8F8F2"> c </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">struct</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		Email      </span><span style="color: #66D9EF; font-style: italic">string</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">`json:"client_email"`</span></span>
<span class="line"><span style="color: #F8F8F2">		PrivateKey </span><span style="color: #66D9EF; font-style: italic">string</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">`json:"private_key"`</span></span>
<span class="line"><span style="color: #F8F8F2">	}{}</span></span>
<span class="line"><span style="color: #F8F8F2">	json.</span><span style="color: #66D9EF">Unmarshal</span><span style="color: #F8F8F2">(b, </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">c)</span></span>
<span class="line"><span style="color: #F8F8F2">	config </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">jwt.Config{</span></span>
<span class="line"><span style="color: #F8F8F2">		Email:      c.Email,</span></span>
<span class="line"><span style="color: #F8F8F2">		PrivateKey: []</span><span style="color: #66D9EF">byte</span><span style="color: #F8F8F2">(c.PrivateKey),</span></span>
<span class="line"><span style="color: #F8F8F2">		Scopes: []</span><span style="color: #66D9EF; font-style: italic">string</span><span style="color: #F8F8F2">{</span></span>
<span class="line"><span style="color: #F8F8F2">			drive.DriveScope,</span></span>
<span class="line"><span style="color: #F8F8F2">		},</span></span>
<span class="line"><span style="color: #F8F8F2">		TokenURL: google.JWTTokenURL,</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	client </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> config.</span><span style="color: #66D9EF">Client</span><span style="color: #F8F8F2">(oauth2.NoContext)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> client</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">UploadFile</span><span style="color: #F8F8F2">(serviceFile </span><span style="color: #66D9EF; font-style: italic">string</span><span style="color: #F8F8F2">, fileName </span><span style="color: #66D9EF; font-style: italic">string</span><span style="color: #F8F8F2">, folderId </span><span style="color: #66D9EF; font-style: italic">string</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">	filename </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> fileName                       </span><span style="color: #88846F">// Filename</span></span>
<span class="line"><span style="color: #F8F8F2">	baseMimeType </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"application/octet-stream"</span><span style="color: #F8F8F2"> </span><span style="color: #88846F">// MimeType</span></span>
<span class="line"><span style="color: #F8F8F2">	client </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">serviceAccount</span><span style="color: #F8F8F2">(serviceFile)      </span><span style="color: #88846F">// Please set the json file of Service account.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	srv, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> drive.</span><span style="color: #66D9EF">New</span><span style="color: #F8F8F2">(client)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		log.</span><span style="color: #66D9EF">Fatalln</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	file, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> os.</span><span style="color: #66D9EF">Open</span><span style="color: #F8F8F2">(filename)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		log.</span><span style="color: #66D9EF">Fatalln</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	fileInf, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> file.</span><span style="color: #66D9EF">Stat</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		log.</span><span style="color: #66D9EF">Fatalln</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">defer</span><span style="color: #F8F8F2"> file.</span><span style="color: #66D9EF">Close</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #88846F">// get base name from filename</span></span>
<span class="line"><span style="color: #F8F8F2">	baseName </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> filepath.</span><span style="color: #66D9EF">Base</span><span style="color: #F8F8F2">(filename)</span></span>
<span class="line"><span style="color: #F8F8F2">	f </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;</span><span style="color: #F8F8F2">drive.File{Name: baseName}</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> folderId </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">""</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		f.Parents </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> []</span><span style="color: #66D9EF; font-style: italic">string</span><span style="color: #F8F8F2">{folderId}</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	res, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> srv.Files.</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #66D9EF">Create</span><span style="color: #F8F8F2">(f).</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #66D9EF">ResumableMedia</span><span style="color: #F8F8F2">(context.</span><span style="color: #66D9EF">Background</span><span style="color: #F8F8F2">(), file, fileInf.</span><span style="color: #66D9EF">Size</span><span style="color: #F8F8F2">(), baseMimeType).</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #66D9EF">ProgressUpdater</span><span style="color: #F8F8F2">(</span><span style="color: #F92672">func</span><span style="color: #F8F8F2">(now, size </span><span style="color: #66D9EF; font-style: italic">int64</span><span style="color: #F8F8F2">) { fmt.</span><span style="color: #66D9EF">Printf</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"</span><span style="color: #AE81FF">%d</span><span style="color: #E6DB74">, </span><span style="color: #AE81FF">%d\r</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2">, now, size) }).</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #66D9EF">Do</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		log.</span><span style="color: #66D9EF">Fatalln</span><span style="color: #F8F8F2">(err)</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	fmt.</span><span style="color: #66D9EF">Printf</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"Uploaded file </span><span style="color: #AE81FF">%s</span><span style="color: #E6DB74"> with id </span><span style="color: #AE81FF">%s\n</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2">, filename, res.Id)</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">// find files with the extension ending with *.apk</span></span>
<span class="line"><span style="color: #F92672">func</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">FindFiles</span><span style="color: #F8F8F2">(extension </span><span style="color: #66D9EF; font-style: italic">string</span><span style="color: #F8F8F2">) ([]</span><span style="color: #66D9EF; font-style: italic">string</span><span style="color: #F8F8F2">, </span><span style="color: #66D9EF; font-style: italic">error</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">	files, err </span><span style="color: #F92672">:=</span><span style="color: #F8F8F2"> filepath.</span><span style="color: #66D9EF">Glob</span><span style="color: #F8F8F2">(extension)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> err </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">nil</span><span style="color: #F8F8F2">, err</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> files, </span><span style="color: #AE81FF">nil</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>This is a Go package called utils that contains several functions for interacting with Google Drive. The package defines the following functions:</p>
<ul>
<li>serviceAccount: This function takes a file path as input and returns an HTTP client that can be used to authenticate requests to the Google Drive API using a service account. The function reads the contents of the file, which should be a JSON file containing the service account’s email address and private key, and creates a jwt.Config object with this information. The function then uses the config to create an HTTP client and returns it.</li>
<li>UploadFile: This function takes three strings as input: a file path to a service account JSON file, a file path to the file to be uploaded, and the ID of a Google Drive folder. The function uses the serviceAccount function to create an HTTP client, then opens the file to be uploaded and creates a new file object in Google Drive with the contents of the uploaded file. The function also sets the parent folder of the new file to the folder specified by the folderId input.</li>
<li>FindFiles: This function takes a string as input and returns a slice of strings containing the file paths of all files in the current directory and its subdirectories that have the specified extension. The input string should contain a glob pattern, such as ”**/*.apk”. The function uses the filepath.Glob function to search for files that match the pattern and returns the list of file paths.</li>
</ul>
<p>An example <code>bitrise.yml</code> file that uses apk uploading to google drive is</p>
<pre is:raw="" class="astro-code monokai" style="background-color: #272822; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F8F8F2">---</span></span>
<span class="line"><span style="color: #F8F8F2">format_version: '11'</span></span>
<span class="line"><span style="color: #F8F8F2">default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git</span></span>
<span class="line"><span style="color: #F8F8F2">project_type: flutter</span></span>
<span class="line"><span style="color: #F8F8F2">workflows:</span></span>
<span class="line"><span style="color: #F8F8F2">  deploy:</span></span>
<span class="line"><span style="color: #F8F8F2">    description: |</span></span>
<span class="line"><span style="color: #F8F8F2">      Builds and deploys app using [Deploy to bitrise.io Step](https://devcenter.bitrise.io/en/getting-started/getting-started-with-flutter-apps.html#deploying-a-flutter-app).</span></span>
<span class="line"><span style="color: #F8F8F2"></span></span>
<span class="line"><span style="color: #F8F8F2">      If you build for iOS, make sure to set up code signing secrets on Bitrise for a successful build.</span></span>
<span class="line"><span style="color: #F8F8F2"></span></span>
<span class="line"><span style="color: #F8F8F2">      Next steps:</span></span>
<span class="line"><span style="color: #F8F8F2">      - Check out [Getting started with Flutter apps](https://devcenter.bitrise.io/en/getting-started/getting-started-with-flutter-apps.html) for signing and deployment options.</span></span>
<span class="line"><span style="color: #F8F8F2">      - Check out the [Code signing guide](https://devcenter.bitrise.io/en/code-signing.html) for iOS and Android</span></span>
<span class="line"><span style="color: #F8F8F2">    steps:</span></span>
<span class="line"><span style="color: #F8F8F2">    - git-clone@6: {}</span></span>
<span class="line"><span style="color: #F8F8F2">    - certificate-and-profile-installer@1: {}</span></span>
<span class="line"><span style="color: #F8F8F2">    - flutter-installer@0:</span></span>
<span class="line"><span style="color: #F8F8F2">        inputs:</span></span>
<span class="line"><span style="color: #F8F8F2">        - is_update: 'false'</span></span>
<span class="line"><span style="color: #F8F8F2">    - cache-pull@2: {}</span></span>
<span class="line"><span style="color: #F8F8F2">    - script@1:</span></span>
<span class="line"><span style="color: #F8F8F2">        inputs:</span></span>
<span class="line"><span style="color: #F8F8F2">        - content: |-</span></span>
<span class="line"><span style="color: #F8F8F2">            #!/usr/bin/env bash</span></span>
<span class="line"><span style="color: #F8F8F2">            # fail if any commands fails</span></span>
<span class="line"><span style="color: #F8F8F2">            set -e</span></span>
<span class="line"><span style="color: #F8F8F2">            # make pipelines' return status equal the last command to exit with a non-zero status, or zero if all commands exit successfully</span></span>
<span class="line"><span style="color: #F8F8F2">            set -o pipefail</span></span>
<span class="line"><span style="color: #F8F8F2">            # debug log</span></span>
<span class="line"><span style="color: #F8F8F2">            set -x</span></span>
<span class="line"><span style="color: #F8F8F2">            flutter upgrade</span></span>
<span class="line"><span style="color: #F8F8F2">    - flutter-build@0:</span></span>
<span class="line"><span style="color: #F8F8F2">        inputs:</span></span>
<span class="line"><span style="color: #F8F8F2">        - project_location: "$BITRISE_FLUTTER_PROJECT_LOCATION"</span></span>
<span class="line"><span style="color: #F8F8F2">        - platform: android</span></span>
<span class="line"><span style="color: #F8F8F2">        - ios_output_type: archive</span></span>
<span class="line"><span style="color: #F8F8F2">    - cache-push@2: {}</span></span>
<span class="line"><span style="color: #F8F8F2">    - file-downloader@1:</span></span>
<span class="line"><span style="color: #F8F8F2">        inputs:</span></span>
<span class="line"><span style="color: #F8F8F2">        - destination: key.json</span></span>
<span class="line"><span style="color: #F8F8F2">        - source: "$BITRISEIO_BITRISE_GOOGLE_SERVICE_JSON_URL"</span></span>
<span class="line"><span style="color: #F8F8F2">    - git::https://github.com/FriendlyUser/bitrise-step-google-drive-uploader@main:</span></span>
<span class="line"><span style="color: #F8F8F2">        title: Upload to google play</span></span>
<span class="line"><span style="color: #F8F8F2">        inputs:</span></span>
<span class="line"><span style="color: #F8F8F2">        - service_key_path: key.json</span></span>
<span class="line"><span style="color: #F8F8F2">        - folder_id: 1MvS-z5JuIaMbAwsqMITeqnDNdtncEL7d</span></span>
<span class="line"><span style="color: #F8F8F2">    - deploy-to-bitrise-io@2: {}</span></span>
<span class="line"><span style="color: #F8F8F2">  primary:</span></span>
<span class="line"><span style="color: #F8F8F2">    description: |</span></span>
<span class="line"><span style="color: #F8F8F2">      Builds project and runs tests.</span></span>
<span class="line"><span style="color: #F8F8F2"></span></span>
<span class="line"><span style="color: #F8F8F2">      Next steps:</span></span>
<span class="line"><span style="color: #F8F8F2">      - Check out [Getting started with Flutter apps](https://devcenter.bitrise.io/en/getting-started/getting-started-with-flutter-apps.html).</span></span>
<span class="line"><span style="color: #F8F8F2">    steps:</span></span>
<span class="line"><span style="color: #F8F8F2">    - git-clone@6: {}</span></span>
<span class="line"><span style="color: #F8F8F2">    - flutter-installer@0:</span></span>
<span class="line"><span style="color: #F8F8F2">        inputs:</span></span>
<span class="line"><span style="color: #F8F8F2">        - version: beta</span></span>
<span class="line"><span style="color: #F8F8F2">    - cache-pull@2: {}</span></span>
<span class="line"><span style="color: #F8F8F2">    - cache-push@2: {}</span></span>
<span class="line"><span style="color: #F8F8F2">    - script@1:</span></span>
<span class="line"><span style="color: #F8F8F2">        inputs:</span></span>
<span class="line"><span style="color: #F8F8F2">        - content: |-</span></span>
<span class="line"><span style="color: #F8F8F2">            #!/usr/bin/env bash</span></span>
<span class="line"><span style="color: #F8F8F2">            # fail if any commands fails</span></span>
<span class="line"><span style="color: #F8F8F2">            set -e</span></span>
<span class="line"><span style="color: #F8F8F2">            # make pipelines' return status equal the last command to exit with a non-zero status, or zero if all commands exit successfully</span></span>
<span class="line"><span style="color: #F8F8F2">            set -o pipefail</span></span>
<span class="line"><span style="color: #F8F8F2">            # debug log</span></span>
<span class="line"><span style="color: #F8F8F2">            set -x</span></span>
<span class="line"><span style="color: #F8F8F2"></span></span>
<span class="line"><span style="color: #F8F8F2">            # write your script here</span></span>
<span class="line"><span style="color: #F8F8F2">            echo "Hello World!"</span></span>
<span class="line"><span style="color: #F8F8F2"></span></span>
<span class="line"><span style="color: #F8F8F2">            # or run a script from your repository, like:</span></span>
<span class="line"><span style="color: #F8F8F2">            # bash ./path/to/script.sh</span></span>
<span class="line"><span style="color: #F8F8F2">            # not just bash, e.g.:</span></span>
<span class="line"><span style="color: #F8F8F2">            # ruby ./path/to/script.rb</span></span>
<span class="line"><span style="color: #F8F8F2"></span></span>
<span class="line"><span style="color: #F8F8F2"></span></span>
<span class="line"><span style="color: #F8F8F2">            flutter upgrade</span></span>
<span class="line"><span style="color: #F8F8F2">    - flutter-build@0: {}</span></span>
<span class="line"><span style="color: #F8F8F2">    - deploy-to-bitrise-io@2: {}</span></span>
<span class="line"><span style="color: #F8F8F2">meta:</span></span>
<span class="line"><span style="color: #F8F8F2">  bitrise.io:</span></span>
<span class="line"><span style="color: #F8F8F2">    stack: osx-xcode-14.1.x-ventura</span></span>
<span class="line"><span style="color: #F8F8F2">app:</span></span>
<span class="line"><span style="color: #F8F8F2">  envs:</span></span>
<span class="line"><span style="color: #F8F8F2">  - opts:</span></span>
<span class="line"><span style="color: #F8F8F2">      is_expand: false</span></span>
<span class="line"><span style="color: #F8F8F2">    BITRISE_FLUTTER_PROJECT_LOCATION: "."</span></span></code></pre>
<p>This is a Bitrise configuration file written in YAML syntax. It defines two workflows: deploy and primary.</p>
<p>The deploy workflow includes several steps:</p>
<ol>
<li>git-clone@6: Clones the repository specified in the source input.
certificate-and-profile-installer@1: Installs the necessary code signing certificates and profiles for the specified iOS development team.</li>
<li>flutter-installer@0: Installs Flutter, the mobile app development framework.</li>
<li>cache-pull@2: Pulls the specified cache from the Bitrise cache storage.</li>
<li>script@1: Executes a custom script, in this case a Bash script that updates Flutter.</li>
<li>flutter-build@0: Builds a Flutter app for the specified platform (Android in this case) and outputs an archive file.</li>
<li>cache-push@2: Pushes the specified cache to the Bitrise cache storage.</li>
<li>file-downloader@1: Downloads a file from the specified URL and saves it to the specified destination.
git::<a href="https://github.com/FriendlyUser/bitrise-step-google-drive-uploader@main">https://github.com/FriendlyUser/bitrise-step-google-drive-uploader@main</a>: Executes a step from a custom step library hosted on GitHub.</li>
<li>deploy-to-bitrise-io@2: Deploys the built app to the Bitrise hosting platform.</li>
</ol>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/FriendlyUser/supabase_flutter_todo">https://github.com/FriendlyUser/supabase_flutter_todo</a></li>
<li><a href="https://friendlyuser.github.io/posts/tech/flutter_todo_list_with_supabase/">https://friendlyuser.github.io/posts/tech/flutter_todo_list_with_supabase/</a></li>
<li><a href="https://github.com/FriendlyUser/bitrise-step-google-drive-uploader">https://github.com/FriendlyUser/bitrise-step-google-drive-uploader</a></li>
</ul>
    </content></div></div></div></div>

  <div class="mx-auto max-w-screen-lg px-3 py-6">
  <div class="no-print flex w-full">
    <form class="max-w-lg" action="https://formspree.io/f/davidli012345@gmail.com" method="POST"><div class="-mx-3 mb-6 flex flex-wrap"><div class="mb-6 w-full px-3 md:mb-0 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-first-name">First Name</label><input class="mb-3 block w-full appearance-none rounded py-3 px-4 leading-tight text-gray-700 focus:bg-white focus:outline-none" id="grid-first-name" type="text" placeholder="Jane"/></div><div class="w-full px-3 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-last-name">Last Name</label><input class="block w-full appearance-none rounded border border-gray-200  py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="grid-last-name" type="text" placeholder="Doe"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">E-mail</label><input class="mb-3 block w-full appearance-none rounded border py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="email" type="email"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">Message</label><textarea class="no-resize mb-3 block h-48 w-full resize-none appearance-none rounded border border-gray-200 py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="message"></textarea></div></div><div class="md:flex md:items-center"><div class="md:w-1/3"><button class="ml-2 shrink-0 rounded-full bg-gradient-to-br from-sky-500 to-cyan-400 px-3 py-1 text-sm font-medium text-gray-700 hover:from-sky-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-600/50" type="submit">Send</button></div><div class="md:w-2/3"></div></div></form>
    <div class="ml-3 max-w-lg bg-slate-300">
      <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
      <script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
      <div id="search" class="ml-3 p-4"></div>
      
    </div>
  </div>
</div>

    </div>
    <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="no-print border-t border-gray-600 pt-5"><div class="text-sm text-gray-200">© Copyright <!-- -->2023<!-- --> by <!-- -->Astro Tech Blog<!-- -->. Built with ♥ by<!-- --> <a class="text-cyan-400 hover:underline" href="https://github.com/FriendlyUser" target="_blank" rel="noopener noreferrer">FriendlyUser</a>. Last updated on <!-- -->2023-05-19<!-- -->.</div></div></div>
  </body></html>