<!DOCTYPE html><html lang="en"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.QW52Ox2j.js"></script><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Creating a networked game with phaser and nodejs part II - FriendlyUsers Tech Blog</title><meta name="description" content="In this post I will show you how to create a simple networked game with phaser and nodejs."><meta name="author" content="David Li"><link rel="alternate" type="application/rss+xml" href="/rss.xml"><link rel="icon" type="image/x-icon" href="/favicon.ico"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6"></script><script type="module">(function(e,n,r,t,m){e[t]=e[t]||[],e[t].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var g=n.getElementsByTagName(r)[0],a=n.createElement(r),s="";a.async=!0,a.src="https://www.googletagmanager.com/gtm.js?id="+m+s,g.parentNode.insertBefore(a,g)})(window,document,"script","dataLayer","GTM-K8P5P8FQ");</script><script type="text/javascript">
      let slideIndex = 1;
      showSlides(slideIndex);

      function plusSlides(n) {
        showSlides((slideIndex += n));
      }

      function currentSlide(n) {
        showSlides((slideIndex = n));
      }

      function showSlides(n) {
        try {
          let i;
          let slides = document.getElementsByClassName('mySlides');
          let dots = document.getElementsByClassName('demo');
          let captionText = document.getElementById('caption');
          if (n > slides.length) {
            slideIndex = 1;
          }
          if (n < 1) {
            slideIndex = slides.length;
          }
          for (i = 0; i < slides.length; i++) {
            slides[i].style.display = 'none';
          }
          for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(' active', '');
          }
          slides[slideIndex - 1].style.display = 'block';
          dots[slideIndex - 1].className += ' active';
          captionText.innerHTML = dots[slideIndex - 1].alt;
        } catch (err) {
          // do nothing here
        }
      }
    </script><!-- Google Tag Manager --><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","UA-119155027-6");</script><!-- End Google Tag Manager --><link rel="stylesheet" href="/_astro/index.BvkiO192.css">
<style>.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}@media print{.no-print,.no-print *{display:none!important}}
</style></head> <body class="bg-slate-900 text-gray-100"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K8P5P8FQ" height="0" width="0" style="display:none;visibility:hidden"></iframe> </noscript> <!-- End Google Tag Manager (noscript) --> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between"><a href="/"><div class="flex items-center bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text text-xl font-bold text-transparent"><svg class="mr-1 h-10 w-10 stroke-cyan-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none"></path><rect x="3" y="12" width="6" height="8" rx="1"></rect><rect x="9" y="8" width="6" height="12" rx="1"></rect><rect x="15" y="4" width="6" height="16" rx="1"></rect><path d="M4 20h14"></path></svg>David&#x27;s Blog</div></a><nav><ul class="flex gap-x-3 font-medium text-gray-200"><li class="hover:text-white"><a href="/posts" target="_self">Blogs</a></li><li class="hover:text-white"><a href="https://github.com/FriendlyUser/astro-tech-blog" target="_self">GitHub</a></li></ul></nav></div></div> <div data-pagefind-body>  <div class="mx-auto max-w-screen-lg px-3 py-6"><div><h1 class="text-center text-3xl font-bold">Creating a networked game with phaser and nodejs part II</h1><div class="mt-2 text-center text-sm text-gray-400">By <!-- -->David Li<!-- --> on <!-- -->Fri, 15 May 2024</div><div class="flex place-content-center pt-2"><div class="
      // Layout //      Shape (Updated
      to match your               &quot;For&quot; snippet) // Typography inline-flex max-w-full items-center rounded-full
      px-2.5 py-0.5                      text-xs font-medium
      bg-cyan-400 text-cyan-900          // Dynamic Color
      h-fit
    " style="height:fit-content"><span class="line-clamp-2 break-words text-left"> <a href="/tags/phaser" style="padding-right:3px"> <category>phaser<!-- --> </category></a></span></div> <div class="
      // Layout //      Shape (Updated
      to match your               &quot;For&quot; snippet) // Typography inline-flex max-w-full items-center rounded-full
      px-2.5 py-0.5                      text-xs font-medium
      bg-cyan-400 text-cyan-900          // Dynamic Color
      h-fit
    " style="height:fit-content"><span class="line-clamp-2 break-words text-left"> <a href="/tags/nodejs" style="padding-right:3px"> <category>nodejs<!-- --> </category></a></span></div> <div class="
      // Layout //      Shape (Updated
      to match your               &quot;For&quot; snippet) // Typography inline-flex max-w-full items-center rounded-full
      px-2.5 py-0.5                      text-xs font-medium
      bg-cyan-400 text-cyan-900          // Dynamic Color
      h-fit
    " style="height:fit-content"><span class="line-clamp-2 break-words text-left"> <a href="/tags/js" style="padding-right:3px"> <category>js<!-- --> </category></a></span></div> </div><div class="mx-auto mt-5 max-w-prose"><div class="aspect-h-2 aspect-w-3"><img class="h-full w-full rounded-lg object-cover object-center" src="/imgs/2023/2515566937.png" loading="lazy"/></div><div class="prose prose-invert mt-8 prose-img:rounded-lg"><content> <p>In a multiplayer game, client-side code is responsible for managing various tasks that are essential to the game’s functioning. These tasks can be broadly categorized into three types:</p>
<ol>
<li>User input: The client-side code is responsible for capturing user input, such as keyboard or mouse events. It needs to send this information to the server to update the game state.</li>
<li>Game state: The client-side code needs to maintain a local copy of the game state, including the position and status of all game objects. It also needs to keep track of the game’s rules and ensure that the game state remains consistent with these rules.</li>
<li>Rendering: The client-side code is responsible for rendering the game state on the player’s screen. This involves updating the screen with the latest game state and displaying visual feedback to the player, such as animations, sound effects, and score updates.</li>
</ol>
<p>In summary, the client-side code needs to manage user input, game state, and rendering to ensure that the game runs smoothly for all players.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583"> var</span><span style="color:#79B8FF"> ASSET_URL</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "assets/"</span></span>
<span class="line"><span style="color:#6A737D">//We first initialize the phaser game object</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#79B8FF"> WINDOW_WIDTH</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 750</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#79B8FF"> WINDOW_HEIGHT</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 500</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#79B8FF"> HEALTH_MAX</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> game </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> Phaser.</span><span style="color:#B392F0">Game</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">WINDOW_WIDTH</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">WINDOW_HEIGHT</span><span style="color:#E1E4E8">, Phaser.</span><span style="color:#79B8FF">AUTO</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'phaser-example'</span><span style="color:#E1E4E8">, {preload:preload, create:create, update:GameLoop} );</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#79B8FF"> WORLD_SIZE</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {w:</span><span style="color:#79B8FF">1500</span><span style="color:#E1E4E8">,h:</span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> numofEnemyPlayers </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> water_tiles </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#6A737D">// arrays of objects that the player will interact with </span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> bullet_array </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> healthPack_array </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> driftWood_array </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> shotsLeft; </span><span style="color:#6A737D">// text field containing number of cannonballs the player has remaining before reloading</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> numOfEnemiesText;</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> playersConnectingText;</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> loadText;</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> socket; </span><span style="color:#6A737D">//Declare it in this scope, initialize in the `create` function</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> other_players </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {};</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> bulletSpeed </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 17.5</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// speed of the bullet</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> player </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">	sprite:</span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">,</span><span style="color:#6A737D">//Will hold the sprite when it's created </span></span>
<span class="line"><span style="color:#E1E4E8">	speed_x:</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#6A737D">// This is the speed it's currently moving at</span></span>
<span class="line"><span style="color:#E1E4E8">	speed_y:</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">	speed:</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">, </span><span style="color:#6A737D">// This is the parameter for how fast it should move </span></span>
<span class="line"><span style="color:#E1E4E8">	friction:</span><span style="color:#79B8FF">0.95</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">	health:</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">	cannonBalls:</span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6A737D">	//shipType:null,</span></span>
<span class="line"><span style="color:#E1E4E8">	alive: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">	shot:</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B392F0">	update</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">function</span><span style="color:#E1E4E8">(){</span></span>
<span class="line"><span style="color:#6A737D">		// Lerp rotation towards mouse</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> dx </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (game.input.mousePointer.x </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> game.camera.x) </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.sprite.x;</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> dy </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (game.input.mousePointer.y </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> game.camera.y) </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.sprite.y;</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> angle </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">atan2</span><span style="color:#E1E4E8">(dy,dx) </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Math.</span><span style="color:#79B8FF">PI</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> dir </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (angle </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.sprite.rotation) </span><span style="color:#F97583">/</span><span style="color:#E1E4E8"> (Math.</span><span style="color:#79B8FF">PI</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">		dir </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">round</span><span style="color:#E1E4E8">(dir);</span></span>
<span class="line"><span style="color:#E1E4E8">		dir </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> dir </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> Math.</span><span style="color:#79B8FF">PI</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.sprite.rotation </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> dir </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 0.1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">		// Move forward</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8">(game.input.keyboard.</span><span style="color:#B392F0">isDown</span><span style="color:#E1E4E8">(Phaser.Keyboard.</span><span style="color:#79B8FF">W</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> game.input.keyboard.</span><span style="color:#B392F0">isDown</span><span style="color:#E1E4E8">(Phaser.Keyboard.</span><span style="color:#79B8FF">UP</span><span style="color:#E1E4E8">)){</span></span>
<span class="line"><span style="color:#6A737D">			// used to decrease speed of player as health decreases</span></span>
<span class="line"><span style="color:#F97583">			var</span><span style="color:#E1E4E8"> healthLeft </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.health </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> HEALTH_MAX</span><span style="color:#E1E4E8">; </span></span>
<span class="line"><span style="color:#79B8FF">			this</span><span style="color:#E1E4E8">.speed_x </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">cos</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.rotation </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> Math.</span><span style="color:#79B8FF">PI</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">*</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.speed</span><span style="color:#F97583">*</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.health</span><span style="color:#F97583">/</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">			this</span><span style="color:#E1E4E8">.speed_y </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">sin</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.rotation </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> Math.</span><span style="color:#79B8FF">PI</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.speed</span><span style="color:#F97583">*</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.health</span><span style="color:#F97583">/</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.sprite.x </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.speed_x;</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.sprite.y </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.speed_y;</span></span>
<span class="line"><span style="color:#6A737D">		// change player sprite based on health.</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.sprite </span><span style="color:#F97583">=</span><span style="color:#B392F0"> changeSpriteBasedOnHealth</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.health)</span></span>
<span class="line"><span style="color:#E1E4E8">		</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.speed_x </span><span style="color:#F97583">*=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.friction;</span></span>
<span class="line"><span style="color:#79B8FF">		this</span><span style="color:#E1E4E8">.speed_y </span><span style="color:#F97583">*=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.friction;</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#6A737D">		//inform the player that they can reload</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">		// Shoot bullet </span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8">(game.input.activePointer.leftButton.isDown </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#F97583"> !</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.shot){</span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.cannonBalls </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">				writeToHTMLLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Press spacebar or enter to reload cannonballs.'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">				loadSound.</span><span style="color:#B392F0">play</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#79B8FF">				this</span><span style="color:#E1E4E8">.shot </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#F97583">			else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">				var</span><span style="color:#E1E4E8"> speed_x </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">cos</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.rotation </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> Math.</span><span style="color:#79B8FF">PI</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> bulletSpeed;</span></span>
<span class="line"><span style="color:#F97583">				var</span><span style="color:#E1E4E8"> speed_y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">sin</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.rotation </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> Math.</span><span style="color:#79B8FF">PI</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> bulletSpeed;</span></span>
<span class="line"><span style="color:#6A737D">				//var cannonBalls = this.cannonBalls -1;</span></span>
<span class="line"><span style="color:#79B8FF">				this</span><span style="color:#E1E4E8">.cannonBalls </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.cannonBalls </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> ;</span></span>
<span class="line"><span style="color:#6A737D">				//console.log(this.cannonBalls)</span></span>
<span class="line"><span style="color:#B392F0">				updateCannonballs</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.cannonBalls);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">				this</span><span style="color:#E1E4E8">.shot </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">				// Tell the server we shot a bullet </span></span>
<span class="line"><span style="color:#E1E4E8">				socket.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'shoot-bullet'</span><span style="color:#E1E4E8">,{x:</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.x,y:</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.y,angle:</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.rotation,speed_x:speed_x,speed_y:speed_y})</span></span>
<span class="line"><span style="color:#E1E4E8">				fireSound.</span><span style="color:#B392F0">play</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#F97583">		else</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> ((game.input.keyboard.</span><span style="color:#B392F0">isDown</span><span style="color:#E1E4E8">(Phaser.Keyboard.</span><span style="color:#79B8FF">SPACEBAR</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> game.input.keyboard.</span><span style="color:#B392F0">isDown</span><span style="color:#E1E4E8">(Phaser.Keyboard.</span><span style="color:#79B8FF">ENTER</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.cannonBalls </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">			this</span><span style="color:#E1E4E8">.cannonBalls </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.cannonBalls </span><span style="color:#F97583">+</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">			updateCannonballs</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.cannonBalls);</span></span>
<span class="line"><span style="color:#B392F0">			writeToHTMLLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Cannonballs: ("</span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.cannonBalls </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> ') </span><span style="color:#79B8FF">\t</span><span style="color:#79B8FF"> \t</span><span style="color:#9ECBFF">'</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> "Player Health: ("</span><span style="color:#F97583">+</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.health </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> ')'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">			//console.log('Loading cannonballs: ' + this.cannonBalls)</span></span>
<span class="line"><span style="color:#E1E4E8">		</span></span>
<span class="line"><span style="color:#6A737D">			//console.log('List Items: ' +document.getElementById("log").getElementsByTagName("li").length)</span></span>
<span class="line"><span style="color:#79B8FF">			this</span><span style="color:#E1E4E8">.shot </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">game.input.activePointer.leftButton.isDown) </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.shot </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#B392F0">		updateHealthBar</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">HEALTH_MAX</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">player.health)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">		// To make player flash when they are hit, set player.spite.alpha = 0</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.alpha </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#79B8FF">			this</span><span style="color:#E1E4E8">.sprite.alpha </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">1</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.sprite.alpha) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 0.16</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		} </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">			this</span><span style="color:#E1E4E8">.sprite.alpha </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#E1E4E8">	  </span></span>
<span class="line"><span style="color:#6A737D">		// Tell the server we've moved </span></span>
<span class="line"><span style="color:#E1E4E8">		socket.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'move-player'</span><span style="color:#E1E4E8">,{x:</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.x,y:</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.y,angle:</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.sprite.rotation,health:</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.health})</span></span>
<span class="line"><span style="color:#E1E4E8">		</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">			</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> CreateShip</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">type</span><span style="color:#E1E4E8">,</span><span style="color:#FFAB70">x</span><span style="color:#E1E4E8">,</span><span style="color:#FFAB70">y</span><span style="color:#E1E4E8">,</span><span style="color:#FFAB70">angle</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#6A737D">	// type is an int that can be between 1 and 6 inclusive </span></span>
<span class="line"><span style="color:#6A737D">	// returns the sprite just created </span></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> sprite </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">sprite</span><span style="color:#E1E4E8">(x,y,</span><span style="color:#9ECBFF">'ship'</span><span style="color:#F97583"> +</span><span style="color:#B392F0"> String</span><span style="color:#E1E4E8">(type) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> '_1'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	game.physics.</span><span style="color:#B392F0">enable</span><span style="color:#E1E4E8">([sprite], Phaser.Physics.</span><span style="color:#79B8FF">ARCADE</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	sprite.rotation </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> angle;</span></span>
<span class="line"><span style="color:#E1E4E8">	sprite.anchor.</span><span style="color:#B392F0">setTo</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	sprite.body.collideWorldBounds </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	sprite.body.bounce.</span><span style="color:#B392F0">setTo</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">	return</span><span style="color:#E1E4E8"> sprite;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> preload</span><span style="color:#E1E4E8">(){</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.crossOrigin </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "Anonymous"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	game.stage.backgroundColor </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "#3399DA"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.onFileComplete.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(fileComplete, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">	// Load all the ships</span></span>
<span class="line"><span style="color:#F97583">	for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">		game.load.</span><span style="color:#B392F0">image</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'ship'</span><span style="color:#F97583">+</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">(i) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'_1'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'ship'</span><span style="color:#F97583">+</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">(i)</span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'_1.png'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">		game.load.</span><span style="color:#B392F0">image</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'ship'</span><span style="color:#F97583">+</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">(i) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'_2'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'ship'</span><span style="color:#F97583">+</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">(i)</span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'_2.png'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">		game.load.</span><span style="color:#B392F0">image</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'ship'</span><span style="color:#F97583">+</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">(i) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'_3'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'ship'</span><span style="color:#F97583">+</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">(i)</span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'_3.png'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">		game.load.</span><span style="color:#B392F0">image</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'ship'</span><span style="color:#F97583">+</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">(i) </span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'_4'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'ship'</span><span style="color:#F97583">+</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">(i)</span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'_4.png'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.</span><span style="color:#B392F0">image</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'bullet'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'cannon_ball.png'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.</span><span style="color:#B392F0">image</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'water'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'water_tile.png'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.</span><span style="color:#B392F0">image</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'healthPack'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'heart.png'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.</span><span style="color:#B392F0">image</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'driftWood'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'dinghyLarge3.png'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">	// play ready sound once game is loaded</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.</span><span style="color:#B392F0">audio</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'loaded'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'sound/'</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'ready.wav'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.</span><span style="color:#B392F0">audio</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hit'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'sound/'</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'thud1.wav'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.</span><span style="color:#B392F0">audio</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fireCannonball'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'sound/'</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'cannonball.wav'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.</span><span style="color:#B392F0">audio</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'soundtrack'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'sound/'</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'pirates.wav'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	game.load.</span><span style="color:#B392F0">audio</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'healing'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">ASSET_URL</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'sound/'</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'healing.wav'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	loadText </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">(game.world.centerX, game.world.centerY, </span><span style="color:#9ECBFF">' Connected to Server,'</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> '</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">'</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> 'Waiting for the game to load'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">	//text = game.add.text(, "- phaser gradient text -");</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    //  Centers the text</span></span>
<span class="line"><span style="color:#E1E4E8">    loadText.anchor.</span><span style="color:#B392F0">set</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    loadText.align </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'center'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    //  Our font + size</span></span>
<span class="line"><span style="color:#E1E4E8">    loadText.font </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'Arial'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    loadText.fontWeight </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'bold'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    loadText.fontSize </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 35</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    //  Here we create a linear gradient on the Text context.</span></span>
<span class="line"><span style="color:#6A737D">    //  This uses the exact same method of creating a gradient as you do on a normal Canvas context.</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> grd </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> loadText.context.</span><span style="color:#B392F0">createLinearGradient</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, loadText.height);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    //  Add in 2 color stops</span></span>
<span class="line"><span style="color:#E1E4E8">    grd.</span><span style="color:#B392F0">addColorStop</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'#00008B'</span><span style="color:#E1E4E8">);   </span></span>
<span class="line"><span style="color:#E1E4E8">    grd.</span><span style="color:#B392F0">addColorStop</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'#006400'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    //  And apply to the Text</span></span>
<span class="line"><span style="color:#E1E4E8">    loadText.fill </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> grd;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">	game.load.onLoadComplete.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(loadComplete, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">} </span></span></code></pre>
<p>This is a client-side code for a game developed using Phaser, a game framework for JavaScript. It defines a game object, initializes its properties, and defines various functions to update the game’s state. Here is a brief overview of the code:</p>
<ul>
<li>The code defines some constants like the window width and height, maximum health, and world size.</li>
<li>The game object is created using the Phaser framework by providing the canvas dimensions, rendering mode, and specifying the functions to be called for preloading, creating, and updating the game.</li>
<li>The game’s state is updated in the <code>update</code> function of the <code>player</code> object, which is called on each frame. It updates the player’s position and rotation based on user input, checks if the player has fired a bullet, and emits events to the server.</li>
<li>A function <code>CreateShip</code> is defined to create a new player sprite and add physics to it.</li>
<li>The code also defines arrays for <code>bullet_array</code>, <code>healthPack_array</code>, and <code>driftWood_array</code> to hold game objects that the player can interact with.</li>
<li>The <code>socket</code> variable is used to connect to the game server and emit events to it.</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583"> function</span><span style="color:#B392F0"> create</span><span style="color:#E1E4E8">(){</span></span>
<span class="line"><span style="color:#6A737D">	// turn on game physics</span></span>
<span class="line"><span style="color:#E1E4E8">	game.physics.</span><span style="color:#B392F0">startSystem</span><span style="color:#E1E4E8">(Phaser.Physics.</span><span style="color:#79B8FF">ARCADE</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">	// play music see https://phaser.io/examples/v2/audio/loop</span></span>
<span class="line"><span style="color:#E1E4E8">	music </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">audio</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'soundtrack'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	hitSound </span><span style="color:#F97583">=</span><span style="color:#E1E4E8">  game.add.</span><span style="color:#B392F0">audio</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hit'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	healSound </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">audio</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'healing'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	music.</span><span style="color:#B392F0">loopFull</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.25</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">	//music.volume = 0.25;</span></span>
<span class="line"><span style="color:#6A737D">	//music.onLoop.add(this);</span></span>
<span class="line"><span style="color:#E1E4E8">	fireSound </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">audio</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fireCannonball'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">	// Create water tiles </span></span>
<span class="line"><span style="color:#F97583">	for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF">WORLD_SIZE</span><span style="color:#E1E4E8">.w</span><span style="color:#F97583">/</span><span style="color:#79B8FF">64</span><span style="color:#F97583">+</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#F97583">		for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> j</span><span style="color:#F97583">=</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;j</span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF">WORLD_SIZE</span><span style="color:#E1E4E8">.h</span><span style="color:#F97583">/</span><span style="color:#79B8FF">64</span><span style="color:#F97583">+</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">;j</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#F97583">			var</span><span style="color:#E1E4E8"> tile_sprite </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">sprite</span><span style="color:#E1E4E8">(i </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 64</span><span style="color:#E1E4E8">, j </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 64</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'water'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">			tile_sprite.anchor.</span><span style="color:#B392F0">setTo</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">			tile_sprite.alpha </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">			water_tiles.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(tile_sprite);</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">	game.stage.disableVisibilityChange </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	game.world.</span><span style="color:#B392F0">setBounds</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1500</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1200</span><span style="color:#E1E4E8">); </span></span>
<span class="line"><span style="color:#B392F0">	createHealthBar</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#6A737D">	// Create player</span></span>
<span class="line"><span style="color:#6A737D">	//var player_ship_type = String(1);</span></span>
<span class="line"><span style="color:#6A737D">	// Range of Math.random is [0,1), not inclusive</span></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> player_ship_type </span><span style="color:#F97583">=</span><span style="color:#B392F0"> String</span><span style="color:#E1E4E8">(Math.</span><span style="color:#B392F0">floor</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">6</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">Math.</span><span style="color:#B392F0">random</span><span style="color:#E1E4E8">())</span><span style="color:#F97583">+</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">	// randomly spawn player sprite</span></span>
<span class="line"><span style="color:#E1E4E8">	player.sprite </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">sprite</span><span style="color:#E1E4E8">(Math.</span><span style="color:#B392F0">random</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> WORLD_SIZE</span><span style="color:#E1E4E8">.w</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> WORLD_SIZE</span><span style="color:#E1E4E8">.w</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">,Math.</span><span style="color:#B392F0">random</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> WORLD_SIZE</span><span style="color:#E1E4E8">.h</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> WORLD_SIZE</span><span style="color:#E1E4E8">.h</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'ship'</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">player_ship_type</span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'_1'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	game.physics.</span><span style="color:#B392F0">enable</span><span style="color:#E1E4E8">([player], Phaser.Physics.</span><span style="color:#79B8FF">ARCADE</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	player.sprite.anchor.</span><span style="color:#B392F0">setTo</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0.5</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">   </span></span>
<span class="line"><span style="color:#E1E4E8">	shotsLeft </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">625</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">475</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Shots Left: "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> player.cannonBalls, { font: </span><span style="color:#9ECBFF">"bold 16px Arial"</span><span style="color:#E1E4E8">, fill: </span><span style="color:#9ECBFF">"#ffffff"</span><span style="color:#E1E4E8">, align: </span><span style="color:#9ECBFF">"center"</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">	shotsLeft.fixedToCamera </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	numOfEnemiesText </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">475</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Player ID: "</span><span style="color:#E1E4E8">, { font: </span><span style="color:#9ECBFF">"bold 16px Arial"</span><span style="color:#E1E4E8">, fill: </span><span style="color:#9ECBFF">"#ffffff"</span><span style="color:#E1E4E8">, align: </span><span style="color:#9ECBFF">"center"</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">	numOfEnemiesText.fixedToCamera </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	game.world.</span><span style="color:#B392F0">setBounds</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">WORLD_SIZE</span><span style="color:#E1E4E8">.w, </span><span style="color:#79B8FF">WORLD_SIZE</span><span style="color:#E1E4E8">.h);</span></span>
<span class="line"><span style="color:#6A737D">	//if (numofEnemyPlayers &#x3C;= 0 &#x26;&#x26; playersConnectingText == '') {</span></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> (numofEnemyPlayers </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">		writeToHTMLLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Waiting for players to join'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">		playersConnectingText </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">250</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Waiting for other players to join"</span><span style="color:#E1E4E8">, { font: </span><span style="color:#9ECBFF">"bold 16px Arial"</span><span style="color:#E1E4E8">, fill: </span><span style="color:#9ECBFF">"#ffffff"</span><span style="color:#E1E4E8">, align: </span><span style="color:#9ECBFF">"center"</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">		playersConnectingText.fixedToCamera </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">		//console.log(playersConnectingText)</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">	game.camera.x </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> player.sprite.x </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> WINDOW_WIDTH</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	game.camera.y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> player.sprite.y </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> WINDOW_HEIGHT</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">	socket </span><span style="color:#F97583">=</span><span style="color:#B392F0"> io</span><span style="color:#E1E4E8">(); </span><span style="color:#6A737D">// This triggers the 'connection' event on the server</span></span>
<span class="line"><span style="color:#E1E4E8">	socket.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'new-player'</span><span style="color:#E1E4E8">,{x:player.sprite.x,y:player.sprite.y,angle:player.sprite.rotation,type:player_ship_type,health:player.health})</span></span>
<span class="line"><span style="color:#6A737D">	// Listen for other players connecting</span></span>
<span class="line"><span style="color:#E1E4E8">	socket.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'update-players'</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">function</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">players_data</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> players_found </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {};</span></span>
<span class="line"><span style="color:#6A737D">		// Loop over all the player data received</span></span>
<span class="line"><span style="color:#F97583">		for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> id </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> players_data){</span></span>
<span class="line"><span style="color:#6A737D">			// If the player hasn't been created yet</span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#E1E4E8">(other_players[id] </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> undefined</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> id </span><span style="color:#F97583">!=</span><span style="color:#E1E4E8"> socket.id){ </span><span style="color:#6A737D">// Make sure you don't create yourself</span></span>
<span class="line"><span style="color:#F97583">				var</span><span style="color:#E1E4E8"> data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> players_data[id];</span></span>
<span class="line"><span style="color:#F97583">				var</span><span style="color:#E1E4E8"> p </span><span style="color:#F97583">=</span><span style="color:#B392F0"> CreateShip</span><span style="color:#E1E4E8">(data.type,data.x,data.y,data.angle);</span></span>
<span class="line"><span style="color:#E1E4E8">				p.health </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> data.health; </span><span style="color:#6A737D">// set up the health?</span></span>
<span class="line"><span style="color:#6A737D">				////console.log(p.health)</span></span>
<span class="line"><span style="color:#E1E4E8">				other_players[id] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> p;</span></span>
<span class="line"><span style="color:#6A737D">				//console.log("Created new player at (" + data.x + ", " + data.y + ")");</span></span>
<span class="line"><span style="color:#B392F0">				writeToHTMLLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Player ['</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> id </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> ']'</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> ' Joined the Game.'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">				if</span><span style="color:#E1E4E8">(playersConnectingText.text </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> ''</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">					playersConnectingText.</span><span style="color:#B392F0">setText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Player Joined'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">					playersConnectingText.alpha </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">					//console.log('Messages goes here?')</span></span>
<span class="line"><span style="color:#E1E4E8">				}</span></span>
<span class="line"><span style="color:#E1E4E8">				numofEnemyPlayers </span><span style="color:#F97583">++</span><span style="color:#E1E4E8">;			</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#E1E4E8">			players_found[id] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">			</span></span>
<span class="line"><span style="color:#6A737D">			// Update positions of other players </span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#E1E4E8">(id </span><span style="color:#F97583">!=</span><span style="color:#E1E4E8"> socket.id){</span></span>
<span class="line"><span style="color:#E1E4E8">			  other_players[id].target_x  </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> players_data[id].x; </span><span style="color:#6A737D">// Update target, not actual position, so we can interpolate</span></span>
<span class="line"><span style="color:#E1E4E8">			  other_players[id].target_y  </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> players_data[id].y;</span></span>
<span class="line"><span style="color:#E1E4E8">			  other_players[id].target_rotation  </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> players_data[id].angle;</span></span>
<span class="line"><span style="color:#E1E4E8">			  other_players[id].type </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> players_data[id].type;</span></span>
<span class="line"><span style="color:#E1E4E8">			  other_players[id].health </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> players_data[id].health;</span></span>
<span class="line"><span style="color:#6A737D">			  ////console.log( other_players[id])</span></span>
<span class="line"><span style="color:#6A737D">			  // change player sprite based on health.</span></span>
<span class="line"><span style="color:#6A737D">			  // move this to other function afterwards.</span></span>
<span class="line"><span style="color:#6A737D">			  //console.log(other_players[id].health)</span></span>
<span class="line"><span style="color:#E1E4E8">			  other_players[id] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> changeSpriteBasedOnHealth</span><span style="color:#E1E4E8">(other_players[id], other_players[id].health)</span></span>
<span class="line"><span style="color:#E1E4E8">			</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#E1E4E8">			</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#6A737D">		// Check if a player is missing and delete them </span></span>
<span class="line"><span style="color:#F97583">		for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> id </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> other_players){</span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">players_found[id]){</span></span>
<span class="line"><span style="color:#E1E4E8">				numofEnemyPlayers </span><span style="color:#F97583">--</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">				writeToHTMLLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Player ['</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> id </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> ']'</span><span style="color:#F97583"> +</span><span style="color:#9ECBFF"> ' Disconnected from the Game.'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">				if</span><span style="color:#E1E4E8">(playersConnectingText.text </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> ''</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">					playersConnectingText.</span><span style="color:#B392F0">setText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Player Destroyed'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">					playersConnectingText.alpha </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">				}</span></span>
<span class="line"><span style="color:#E1E4E8">				other_players[id].</span><span style="color:#B392F0">destroy</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">				delete</span><span style="color:#E1E4E8"> other_players[id];</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#6A737D">		// print list of players in game screen</span></span>
<span class="line"><span style="color:#E1E4E8">		numOfEnemiesText.</span><span style="color:#B392F0">setText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Enemy Ships: "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> numofEnemyPlayers );</span></span>
<span class="line"><span style="color:#6A737D">		// print waiting for players to connect message</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8"> (numofEnemyPlayers </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8"> playersConnectingText.text </span><span style="color:#F97583">!=</span><span style="color:#9ECBFF"> ''</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8"> playersConnectingText.alpha </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">			game.add.</span><span style="color:#B392F0">tween</span><span style="color:#E1E4E8">(playersConnectingText)</span></span>
<span class="line"><span style="color:#E1E4E8">                .</span><span style="color:#B392F0">to</span><span style="color:#E1E4E8">({alpha: </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">}, </span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">, Phaser.Easing.Default, </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3000</span><span style="color:#E1E4E8">).onComplete.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">function</span><span style="color:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#F97583">						if</span><span style="color:#E1E4E8"> (playersConnectingText.text </span><span style="color:#F97583">!=</span><span style="color:#9ECBFF"> ''</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">							//console.log('Other Players have joined');</span></span>
<span class="line"><span style="color:#6A737D">							//console.log("This is called when the tween is done.");</span></span>
<span class="line"><span style="color:#E1E4E8">							playersConnectingText.</span><span style="color:#B392F0">setText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">); </span><span style="color:#6A737D">// destroy game text? consider after adding collision objects.</span></span>
<span class="line"><span style="color:#6A737D">							//game.world.remove(playersConnectingText);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">						}</span></span>
<span class="line"><span style="color:#E1E4E8">                    }, </span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#E1E4E8">                );</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#E1E4E8">		</span></span>
<span class="line"><span style="color:#6A737D">		// helpful awaiting for players to connect</span></span>
<span class="line"><span style="color:#E1E4E8">	})</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#6A737D">	// Listen for bullet update events </span></span>
<span class="line"><span style="color:#E1E4E8">	socket.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'bullets-update'</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">function</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">server_bullet_array</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#6A737D">	  // If there's not enough bullets on the client, create them</span></span>
<span class="line"><span style="color:#F97583">	 for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">server_bullet_array.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#F97583">		  if</span><span style="color:#E1E4E8">(bullet_array[i] </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> undefined</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">			  bullet_array[i] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">sprite</span><span style="color:#E1E4E8">(server_bullet_array[i].x,server_bullet_array[i].y,</span><span style="color:#9ECBFF">'bullet'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">		  } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">			  //Otherwise, just update it! </span></span>
<span class="line"><span style="color:#E1E4E8">			  bullet_array[i].x </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> server_bullet_array[i].x; </span></span>
<span class="line"><span style="color:#E1E4E8">			  bullet_array[i].y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> server_bullet_array[i].y;</span></span>
<span class="line"><span style="color:#E1E4E8">		  }</span></span>
<span class="line"><span style="color:#E1E4E8">	  }</span></span>
<span class="line"><span style="color:#6A737D">	  // Otherwise if there's too many, delete the extra </span></span>
<span class="line"><span style="color:#F97583">	  for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">server_bullet_array.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">bullet_array.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">		   bullet_array[i].</span><span style="color:#B392F0">destroy</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">		   bullet_array.</span><span style="color:#B392F0">splice</span><span style="color:#E1E4E8">(i,</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">		   i</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	   }</span></span>
<span class="line"><span style="color:#E1E4E8">	 </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">	  </span></span>
<span class="line"><span style="color:#E1E4E8">	})</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#6A737D">	// Listen for healthPack update events </span></span>
<span class="line"><span style="color:#E1E4E8">	socket.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'healthPack-update'</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">function</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">server_healthpack_array</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#6A737D">	  // If there's not enough health packs on the client, create them</span></span>
<span class="line"><span style="color:#6A737D">	  // could do the moving client side, but hmm</span></span>
<span class="line"><span style="color:#F97583">	 for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">server_healthpack_array.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#6A737D">		 // add driftwood to game if it doesn't already exist</span></span>
<span class="line"><span style="color:#F97583">		  if</span><span style="color:#E1E4E8">(healthPack_array[i] </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> undefined</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">			  healthPack_array[i] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">sprite</span><span style="color:#E1E4E8">(server_healthpack_array[i].x,server_healthpack_array[i].y,</span><span style="color:#9ECBFF">'healthPack'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">			  ////console.log(healthPack_array[i])</span></span>
<span class="line"><span style="color:#E1E4E8">		  } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">			  //Otherwise, just update it! </span></span>
<span class="line"><span style="color:#E1E4E8">			  healthPack_array[i].x </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> server_healthpack_array[i].x; </span></span>
<span class="line"><span style="color:#E1E4E8">			  healthPack_array[i].y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> server_healthpack_array[i].y;</span></span>
<span class="line"><span style="color:#6A737D">			  ////console.log(healthPack_array[i])</span></span>
<span class="line"><span style="color:#E1E4E8">		  }</span></span>
<span class="line"><span style="color:#E1E4E8">	  }</span></span>
<span class="line"><span style="color:#6A737D">	  // Otherwise if there's too many, delete the extra </span></span>
<span class="line"><span style="color:#F97583">	  for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">server_healthpack_array.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">healthPack_array.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">		   healthPack_array[i].</span><span style="color:#B392F0">destroy</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">		   healthPack_array.</span><span style="color:#B392F0">splice</span><span style="color:#E1E4E8">(i,</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">		   i</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	   } </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">	})</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#6A737D">	// Listen for driftWood update events </span></span>
<span class="line"><span style="color:#E1E4E8">	socket.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'driftWood-update'</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">function</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">server_driftWood_array</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#F97583">	 for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">server_driftWood_array.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#6A737D">		  // add driftWood to game if it doesn't already exist</span></span>
<span class="line"><span style="color:#F97583">		  if</span><span style="color:#E1E4E8">(driftWood_array[i] </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> undefined</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">			  driftWood_array[i] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">sprite</span><span style="color:#E1E4E8">(server_driftWood_array[i].x,server_driftWood_array[i].y,</span><span style="color:#9ECBFF">'driftWood'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">			  driftWood_array[i].rotation </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> server_driftWood_array[i].rotation;</span></span>
<span class="line"><span style="color:#E1E4E8">		  } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">			  //Otherwise, just update it! </span></span>
<span class="line"><span style="color:#E1E4E8">			  driftWood_array[i].x </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> server_driftWood_array[i].x; </span></span>
<span class="line"><span style="color:#E1E4E8">			  driftWood_array[i].y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> server_driftWood_array[i].y;</span></span>
<span class="line"><span style="color:#E1E4E8">			  driftWood_array[i].rotation </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> server_driftWood_array[i].rotation;</span></span>
<span class="line"><span style="color:#6A737D">			  ////console.log(healthPack_array[i])</span></span>
<span class="line"><span style="color:#E1E4E8">		  }</span></span>
<span class="line"><span style="color:#F97583">			var</span><span style="color:#E1E4E8"> dx </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> driftWood_array[i].x </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> player.sprite.x; </span></span>
<span class="line"><span style="color:#F97583">			var</span><span style="color:#E1E4E8"> dy </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> driftWood_array[i].y </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> player.sprite.y;</span></span>
<span class="line"><span style="color:#F97583">			var</span><span style="color:#E1E4E8"> dist </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">sqrt</span><span style="color:#E1E4E8">(dx </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> dx </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> dy </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> dy);</span></span>
<span class="line"><span style="color:#6A737D">			////console.log(dist);</span></span>
<span class="line"><span style="color:#6A737D">			// If the players get close enough to collide</span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#E1E4E8">(dist </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 45</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#6A737D">				// check if the player collided with driftwood</span></span>
<span class="line"><span style="color:#E1E4E8">				game.physics.arcade.</span><span style="color:#B392F0">collide</span><span style="color:#E1E4E8">(driftWood_array[i], player.sprite);</span></span>
<span class="line"><span style="color:#6A737D">				//console.log('Big collision happened:');	</span></span>
<span class="line"><span style="color:#6A737D">				// check if players are colliding</span></span>
<span class="line"><span style="color:#E1E4E8">				hitDriftWood </span><span style="color:#F97583">=</span><span style="color:#B392F0"> checkOverlap</span><span style="color:#E1E4E8">(driftWood_array[i],player.sprite)</span></span>
<span class="line"><span style="color:#F97583">				if</span><span style="color:#E1E4E8">(hitDriftWood) {</span></span>
<span class="line"><span style="color:#E1E4E8">					hitSound.volume </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">					hitSound.</span><span style="color:#B392F0">play</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">					player.health </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> player.health </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">					// push player back far enough to avoid collision</span></span>
<span class="line"><span style="color:#E1E4E8">					player.sprite.x </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> dx</span><span style="color:#F97583">*</span><span style="color:#79B8FF">0.15</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">					player.sprite.y </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> dy</span><span style="color:#F97583">*</span><span style="color:#79B8FF">0.15</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">					//player.update();</span></span>
<span class="line"><span style="color:#6A737D">					//socket.emit('move-player',{x:player.sprite.x,y:player.sprite.y,angle:player.sprite.rotation,health:player.health})</span></span>
<span class="line"><span style="color:#E1E4E8">				}</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#E1E4E8">	  }</span></span>
<span class="line"><span style="color:#6A737D">	  // Otherwise if there's too many, delete the extra </span></span>
<span class="line"><span style="color:#F97583">	  for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">server_driftWood_array.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">driftWood_array.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">		   driftWood_array[i].</span><span style="color:#B392F0">destroy</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">		   driftWood_array.</span><span style="color:#B392F0">splice</span><span style="color:#E1E4E8">(i,</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">		   i</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	   } </span></span>
<span class="line"><span style="color:#E1E4E8">	})</span></span>
<span class="line"><span style="color:#6A737D">	// Listen for any player hit events and make that player flash </span></span>
<span class="line"><span style="color:#E1E4E8">	socket.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'player-hit'</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">function</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8">(id </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> socket.id){</span></span>
<span class="line"><span style="color:#6A737D">			//If this is you</span></span>
<span class="line"><span style="color:#E1E4E8">			player.sprite.alpha </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">			player.health </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> player.health </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// why not use a fraction lol.</span></span>
<span class="line"><span style="color:#E1E4E8">			hitSound.volume </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">			hitSound.</span><span style="color:#B392F0">play</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">			writeToHTMLLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Ouch, hit by cannon ball. Health: '</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> player.health);</span></span>
<span class="line"><span style="color:#6A737D">			// send information containing the player health so that the sprites updates.</span></span>
<span class="line"><span style="color:#E1E4E8">			socket.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'move-player'</span><span style="color:#E1E4E8">,{x:player.sprite.x,y:player.sprite.y,angle:player.sprite.rotation,health:player.health});</span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#E1E4E8">(player.health </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">				socket.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'disconnect'</span><span style="color:#E1E4E8">,{});</span></span>
<span class="line"><span style="color:#E1E4E8">				socket.</span><span style="color:#B392F0">disconnect</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">				//console.log('Game Over: player is disconnected from the server');</span></span>
<span class="line"><span style="color:#B392F0">				writeToHTMLLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Game Over: player is disconnected from the server'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">				delete</span><span style="color:#E1E4E8"> player;</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#E1E4E8">		} </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">			// Find the right player </span></span>
<span class="line"><span style="color:#E1E4E8">			other_players[id].alpha </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#E1E4E8">	})</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#E1E4E8">	socket.</span><span style="color:#B392F0">on</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'player-heal'</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">function</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8">(id </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> socket.id){</span></span>
<span class="line"><span style="color:#6A737D">			//console.log('You healed:' + id)</span></span>
<span class="line"><span style="color:#E1E4E8">			healSound.volume </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">			healSound.</span><span style="color:#B392F0">play</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#E1E4E8"> (player.health </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 10</span><span style="color:#F97583"> >=</span><span style="color:#79B8FF"> HEALTH_MAX</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">				player.health </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> HEALTH_MAX</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#F97583">			else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">				player.health </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">				writeToHTMLLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'You healed because of the heart: Health('</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> player.health </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> ')'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#E1E4E8">			</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#F97583">		else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">			// Find the right player </span></span>
<span class="line"><span style="color:#6A737D">			//console.log('Other player got the heart: ' + id)</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#E1E4E8">	})</span></span>
<span class="line"><span style="color:#E1E4E8">} </span></span></code></pre>
<p>This is a piece of code written in JavaScript using the Phaser game engine. It creates the game world and initializes game objects such as the player, enemies, and game physics.</p>
<p>The code is part of a function named <code>create()</code> which initializes the game world by creating a physics system, creating the player object, adding music and sound effects, creating water tiles, and setting up the camera. It also initializes a socket to allow multiple players to connect and interact with each other.</p>
<p>The code is not self-contained, and it relies on other functions such as <code>CreateShip()</code> and <code>changeSpriteBasedOnHealth()</code> which are not provided in this snippet.</p>
<p>Overall, this code creates a basic game world and sets up the necessary components for multi-player interaction.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583"> function</span><span style="color:#B392F0"> GameLoop</span><span style="color:#E1E4E8">(){</span></span>
<span class="line"><span style="color:#E1E4E8">	player.</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#6A737D">	// check if the player has been destroyed</span></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8">(player.health </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> player.alive </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">		writeToHTMLLog</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Game Over: Disconnecting from game server.'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">		player.alive </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D">// the player is now dead</span></span>
<span class="line"><span style="color:#E1E4E8">		player.speed_x </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		player.speed_y </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		socket.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'disconnect'</span><span style="color:#E1E4E8">,{});</span></span>
<span class="line"><span style="color:#E1E4E8">		socket.</span><span style="color:#B392F0">disconnect</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">		//var style = { font: "bold 32px Arial", fill: "#fff", boundsAlignH: "center", boundsAlignV: "middle" };</span></span>
<span class="line"><span style="color:#6A737D">		//  The Text is positioned at 0, 100</span></span>
<span class="line"><span style="color:#6A737D">		//text = game.add.text(player.sprite.x, player.sprite.y+50, "Game Over", style);</span></span>
<span class="line"><span style="color:#6A737D">		//	text.fixedToCamera = true;</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> t </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">250</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">250</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Game Over"</span><span style="color:#E1E4E8">, { font: </span><span style="color:#9ECBFF">"bold 32px Arial"</span><span style="color:#E1E4E8">, fill: </span><span style="color:#9ECBFF">"#ffffff"</span><span style="color:#E1E4E8">, align: </span><span style="color:#9ECBFF">"center"</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">		t.fixedToCamera </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> t2 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">250</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">400</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"No more Cannonballs"</span><span style="color:#E1E4E8">, { font: </span><span style="color:#9ECBFF">"bold 32px Arial"</span><span style="color:#E1E4E8">, fill: </span><span style="color:#9ECBFF">"#ffffff"</span><span style="color:#E1E4E8">, align: </span><span style="color:#9ECBFF">"center"</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">		t2.fixedToCamera </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">		//t.cameraOffset.setTo(player.x, player.y);</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">	</span></span>
<span class="line"><span style="color:#6A737D">	// Move camera with player </span></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> camera_x </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> player.sprite.x </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> WINDOW_WIDTH</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> camera_y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> player.sprite.y </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> WINDOW_HEIGHT</span><span style="color:#F97583">/</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	game.camera.x </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (camera_x </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> game.camera.x) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 0.08</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	game.camera.y </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (camera_y </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> game.camera.y) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 0.08</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#6A737D">	// Each player is responsible for bringing their alpha back up on their own client </span></span>
<span class="line"><span style="color:#6A737D">	// Make sure other players flash back to alpha = 1 when they're hit </span></span>
<span class="line"><span style="color:#F97583">	for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> id </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> other_players){</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8">(other_players[id].alpha </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">			other_players[id].alpha </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">1</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8"> other_players[id].alpha) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 0.16</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		} </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">			other_players[id].alpha </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">  </span></span>
<span class="line"><span style="color:#6A737D">	// Interpolate all players to where they should be </span></span>
<span class="line"><span style="color:#F97583">	for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">var</span><span style="color:#E1E4E8"> id </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> other_players){</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> p </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> other_players[id];</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8">(p.target_x </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> undefined</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">			p.x </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (p.target_x </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> p.x) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 0.16</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">			p.y </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> (p.target_y </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> p.y) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 0.16</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">			// Intepolate angle while avoiding the positive/negative issue </span></span>
<span class="line"><span style="color:#F97583">			var</span><span style="color:#E1E4E8"> angle </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> p.target_rotation;</span></span>
<span class="line"><span style="color:#F97583">			var</span><span style="color:#E1E4E8"> dir </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (angle </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> p.rotation) </span><span style="color:#F97583">/</span><span style="color:#E1E4E8"> (Math.</span><span style="color:#79B8FF">PI</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">			dir </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">round</span><span style="color:#E1E4E8">(dir);</span></span>
<span class="line"><span style="color:#E1E4E8">			dir </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> dir </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> Math.</span><span style="color:#79B8FF">PI</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">			p.rotation </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> dir </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 0.16</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#6A737D">		// check for collisions between players</span></span>
<span class="line"><span style="color:#F97583">		if</span><span style="color:#E1E4E8">(numofEnemyPlayers  </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">			var</span><span style="color:#E1E4E8"> dx </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> p.x </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> player.sprite.x; </span></span>
<span class="line"><span style="color:#F97583">			var</span><span style="color:#E1E4E8"> dy </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> p.y </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> player.sprite.y;</span></span>
<span class="line"><span style="color:#F97583">			var</span><span style="color:#E1E4E8"> dist </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Math.</span><span style="color:#B392F0">sqrt</span><span style="color:#E1E4E8">(dx </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> dx </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> dy </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> dy);</span></span>
<span class="line"><span style="color:#6A737D">			////console.log(dist);</span></span>
<span class="line"><span style="color:#6A737D">			// If the players get close enough to collide</span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#E1E4E8">(dist </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 80</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#E1E4E8">				game.physics.arcade.</span><span style="color:#B392F0">collide</span><span style="color:#E1E4E8">(p, player.sprite);</span></span>
<span class="line"><span style="color:#6A737D">				//console.log('Big collision happened:');	</span></span>
<span class="line"><span style="color:#6A737D">				// check if players are colliding</span></span>
<span class="line"><span style="color:#E1E4E8">				playersCollide </span><span style="color:#F97583">=</span><span style="color:#B392F0"> checkOverlap</span><span style="color:#E1E4E8">(p,player.sprite)</span></span>
<span class="line"><span style="color:#F97583">				if</span><span style="color:#E1E4E8">(playersCollide ) {</span></span>
<span class="line"><span style="color:#6A737D">					//console.log('Playing Collision Sound')</span></span>
<span class="line"><span style="color:#E1E4E8">					hitSound.volume </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0.5</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">					hitSound.</span><span style="color:#B392F0">play</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">					player.</span><span style="color:#B392F0">update</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">					// push player back far enough to avoid collision</span></span>
<span class="line"><span style="color:#E1E4E8">					player.sprite.x </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> dx</span><span style="color:#F97583">*</span><span style="color:#79B8FF">0.45</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">					player.sprite.y </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> dy</span><span style="color:#F97583">*</span><span style="color:#79B8FF">0.45</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">				}</span></span>
<span class="line"><span style="color:#F97583">				else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">					//console.log('No Collision');</span></span>
<span class="line"><span style="color:#E1E4E8">				}</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#6A737D">			//io.emit('player-hit',id); // Tell everyone this player got hit</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	/* We're updating the bullets on the server, so we don't need to do this on the client anymore </span></span>
<span class="line"><span style="color:#6A737D">	// Update bullets </span></span>
<span class="line"><span style="color:#6A737D">	for(var i=0;i&#x3C;bullet_array.length;i++){</span></span>
<span class="line"><span style="color:#6A737D">		var bullet = bullet_array[i];</span></span>
<span class="line"><span style="color:#6A737D">		bullet.sprite.x += bullet.speed_x; </span></span>
<span class="line"><span style="color:#6A737D">		bullet.sprite.y += bullet.speed_y; </span></span>
<span class="line"><span style="color:#6A737D">		// Remove if it goes too far off screen </span></span>
<span class="line"><span style="color:#6A737D">		if(bullet.sprite.x &#x3C; -10 || bullet.sprite.x > WORLD_SIZE.w || bullet.sprite.y &#x3C; -10 || bullet.sprite.y > WORLD_SIZE.h){</span></span>
<span class="line"><span style="color:#6A737D">			bullet.sprite.destroy();</span></span>
<span class="line"><span style="color:#6A737D">			bullet_array.splice(i,1);</span></span>
<span class="line"><span style="color:#6A737D">			i--;</span></span>
<span class="line"><span style="color:#6A737D">		}</span></span>
<span class="line"><span style="color:#6A737D">	} </span></span>
<span class="line"><span style="color:#6A737D">	*/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// HealthBar Logic</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> createHealthBar</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">	meters </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">group</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#6A737D">	// create a plain black rectangle to use as the background of a health meter</span></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> meterBackgroundBitmap </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">bitmapData</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	meterBackgroundBitmap.ctx.</span><span style="color:#B392F0">beginPath</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">	meterBackgroundBitmap.ctx.</span><span style="color:#B392F0">rect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, meterBackgroundBitmap.width, meterBackgroundBitmap.height);</span></span>
<span class="line"><span style="color:#E1E4E8">	meterBackgroundBitmap.ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#000000'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	meterBackgroundBitmap.ctx.</span><span style="color:#B392F0">fill</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#6A737D">	// create a Sprite using the background bitmap data</span></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> healthMeterBG </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">sprite</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, meterBackgroundBitmap);</span></span>
<span class="line"><span style="color:#E1E4E8">	healthMeterBG.fixedToCamera </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	meters.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(healthMeterBG);</span></span>
<span class="line"><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#6A737D">	// create a red rectangle to use as the health meter itself</span></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> healthBitmap </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">bitmapData</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">92</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">	healthBitmap.ctx.</span><span style="color:#B392F0">beginPath</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">	healthBitmap.ctx.</span><span style="color:#B392F0">rect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, healthBitmap.width, healthBitmap.height);</span></span>
<span class="line"><span style="color:#E1E4E8">	healthBitmap.ctx.fillStyle </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '#FF0000'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">	healthBitmap.ctx.</span><span style="color:#B392F0">fill</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#6A737D">	// create the health Sprite using the red rectangle bitmap data</span></span>
<span class="line"><span style="color:#E1E4E8">	health </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">sprite</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">14</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">14</span><span style="color:#E1E4E8">, healthBitmap);</span></span>
<span class="line"><span style="color:#E1E4E8">	meters.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(health);</span></span>
<span class="line"><span style="color:#E1E4E8">	health.fixedToCamera </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> updateHealthBar</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">healthRemain</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> m </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (healthRemain) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> bh </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 92</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">92</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> m);</span></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> offset </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 92</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8"> bh;</span></span>
<span class="line"><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">	health.key.context.</span><span style="color:#B392F0">clearRect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, health.width, health.height);</span></span>
<span class="line"><span style="color:#E1E4E8">	health.key.context.</span><span style="color:#B392F0">fillRect</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, offset, </span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, bh);</span></span>
<span class="line"><span style="color:#E1E4E8">	health.key.dirty </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Displays text that should be shown to the user</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> writeToHTMLLog</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">message</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> ((document.</span><span style="color:#B392F0">getElementById</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"log"</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">getElementsByTagName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"li"</span><span style="color:#E1E4E8">).</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 6</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">		document.</span><span style="color:#B392F0">getElementById</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"log"</span><span style="color:#E1E4E8">).innerHTML</span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ''</span><span style="color:#E1E4E8">;</span><span style="color:#6A737D">// reset 'Game text'</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">	document.</span><span style="color:#B392F0">getElementById</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"log"</span><span style="color:#E1E4E8">).innerHTML</span><span style="color:#F97583">+=</span><span style="color:#9ECBFF">"&#x3C;li>"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> message</span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "&#x3C;/li> </span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> updateCannonballs</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">cannonBalls</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">	shotsLeft.</span><span style="color:#B392F0">setText</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Shots Left: "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> cannonBalls);</span></span>
<span class="line"><span style="color:#6A737D">	//console.log(cannonBalls)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#6A737D">// Disconnect the player and display unhelpful messages</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> gameOver</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">player</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">	//console.log('Is it going here?');</span></span>
<span class="line"><span style="color:#F97583">	var</span><span style="color:#E1E4E8"> style </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> { font: </span><span style="color:#9ECBFF">"bold 32px Arial"</span><span style="color:#E1E4E8">, fill: </span><span style="color:#9ECBFF">"#fff"</span><span style="color:#E1E4E8">, boundsAlignH: </span><span style="color:#9ECBFF">"center"</span><span style="color:#E1E4E8">, boundsAlignV: </span><span style="color:#9ECBFF">"middle"</span><span style="color:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#6A737D">	//  The Text is positioned at 0, 100</span></span>
<span class="line"><span style="color:#E1E4E8">	text </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">(player.sprite.x, player.sprite.y</span><span style="color:#F97583">+</span><span style="color:#79B8FF">50</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Game Over"</span><span style="color:#E1E4E8">, style);</span></span>
<span class="line"><span style="color:#6A737D">	//	text.fixedToCamera = true;</span></span>
<span class="line"><span style="color:#E1E4E8">	text2 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> game.add.</span><span style="color:#B392F0">text</span><span style="color:#E1E4E8">(player.sprite.x, player.sprite.y</span><span style="color:#F97583">-</span><span style="color:#79B8FF">50</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Can't Shoot no more"</span><span style="color:#E1E4E8">, style);</span></span>
<span class="line"><span style="color:#E1E4E8">	text.</span><span style="color:#B392F0">setShadow</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'rgba(0,0,0,0.5)'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">	//text2.fixedToCamera = true;</span></span>
<span class="line"><span style="color:#E1E4E8">	player.sprite.</span><span style="color:#B392F0">addChild</span><span style="color:#E1E4E8">(text);</span></span>
<span class="line"><span style="color:#E1E4E8">	player.sprite.</span><span style="color:#B392F0">addChild</span><span style="color:#E1E4E8">(text2);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">	//  We'll set the bounds to be from x0, y100 and be 800px wide by 100px high</span></span>
<span class="line"><span style="color:#E1E4E8">	text.</span><span style="color:#B392F0">setTextBounds</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">800</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> checkOverlap</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">spriteA</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">spriteB</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> boundsA </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> spriteA.</span><span style="color:#B392F0">getBounds</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> boundsB </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> spriteB.</span><span style="color:#B392F0">getBounds</span><span style="color:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> Phaser.Rectangle.</span><span style="color:#B392F0">intersects</span><span style="color:#E1E4E8">(boundsA, boundsB);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// if the player fall below certain amount of hp, change the current, likewise if the player regains enough health, show them in a healthy state</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> changeSpriteBasedOnHealth</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">sprite</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">health</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> (health </span><span style="color:#F97583">>=</span><span style="color:#79B8FF"> 70</span><span style="color:#E1E4E8"> ) {</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> checkThisOut </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> sprite.key;</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> shipSprite </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> checkThisOut.</span><span style="color:#B392F0">replace</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">/</span><span style="color:#79B8FF">.</span><span style="color:#F97583">$</span><span style="color:#9ECBFF">/</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"1"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#F97583">	else</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> (health </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 70</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8"> health </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 35</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> checkThisOut </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> sprite.key;</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> shipSprite </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> checkThisOut.</span><span style="color:#B392F0">replace</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">/</span><span style="color:#79B8FF">.</span><span style="color:#F97583">$</span><span style="color:#9ECBFF">/</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"2"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#F97583">	else</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> (health </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 35</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8"> health </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> checkThisOut </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> sprite.key;</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> shipSprite </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> checkThisOut.</span><span style="color:#B392F0">replace</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">/</span><span style="color:#79B8FF">.</span><span style="color:#F97583">$</span><span style="color:#9ECBFF">/</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"3"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#F97583">	else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> checkThisOut </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> sprite.key;</span></span>
<span class="line"><span style="color:#F97583">		var</span><span style="color:#E1E4E8"> shipSprite </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> checkThisOut.</span><span style="color:#B392F0">replace</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">/</span><span style="color:#79B8FF">.</span><span style="color:#F97583">$</span><span style="color:#9ECBFF">/</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"4"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> (shipSprite </span><span style="color:#F97583">!=</span><span style="color:#E1E4E8"> sprite.key) {</span></span>
<span class="line"><span style="color:#E1E4E8">		console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'garbo message'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">		sprite.</span><span style="color:#B392F0">loadTexture</span><span style="color:#E1E4E8">(shipSprite);</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#F97583">	return</span><span style="color:#E1E4E8"> sprite </span></span></code></pre>
<p>This code is an implementation of a game loop and health bar logic for a game that appears to have a player-controlled character that can move around, shoot, and collide with other players in the game. There are also health bars that are created and updated for each player in the game.</p>
<p>The <code>GameLoop</code> function is responsible for updating the game state each frame. It begins by updating the player’s position, and then checks if the player’s health is less than or equal to zero. If this is the case and the player is still alive, the game over screen is displayed and the player is disconnected from the game server.</p>
<p>Next, the camera is moved to follow the player’s position. After that, each player’s alpha is interpolated back to 1, and then all players are interpolated to their correct positions. The function then checks for collisions between players, and if two players are close enough to collide, they will collide and the collision sound will play. Finally, the function updates the health bars for each player.</p>
<p>The <code>createHealthBar</code> function creates and initializes the health bar for the player. A black rectangle is created to serve as the background for the health bar, and a red rectangle is created to serve as the health meter itself. The health meter is then positioned within the black rectangle.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/FriendlyUser/Pirates-Game/tree/master">https://github.com/FriendlyUser/Pirates-Game/tree/master</a></li>
</ul> </content></div></div></div></div> <div class="mx-auto max-w-screen-lg px-3 py-6"> <div class="no-print flex w-full"> <form class="max-w-lg" action="https://formspree.io/f/davidli012345@gmail.com" method="POST"><div class="-mx-3 mb-6 flex flex-wrap"><div class="mb-6 w-full px-3 md:mb-0 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-first-name">First Name</label><input class="mb-3 block w-full appearance-none rounded py-3 px-4 leading-tight text-gray-700 focus:bg-white focus:outline-none" id="grid-first-name" type="text" placeholder="Jane"/></div><div class="w-full px-3 md:w-1/2"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-last-name">Last Name</label><input class="block w-full appearance-none rounded border border-gray-200  py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="grid-last-name" type="text" placeholder="Doe"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">E-mail</label><input class="mb-3 block w-full appearance-none rounded border py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="email" type="email"/></div></div><div class="-mx-3 mb-6 flex flex-wrap"><div class="w-full px-3"><label class="mb-2 block text-xs font-bold uppercase tracking-wide" for="grid-password">Message</label><textarea class="no-resize mb-3 block h-48 w-full resize-none appearance-none rounded border border-gray-200 py-3 px-4 leading-tight text-gray-700 focus:border-gray-500 focus:bg-white focus:outline-none" id="message"></textarea></div></div><div class="md:flex md:items-center"><div class="md:w-1/3"><button class="ml-2 shrink-0 rounded-full bg-gradient-to-br from-sky-500 to-cyan-400 px-3 py-1 text-sm font-medium text-gray-700 hover:from-sky-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-cyan-600/50" type="submit">Send</button></div><div class="md:w-2/3"></div></div></form> <div class="ml-3 max-w-lg bg-slate-300"> <link href="/pagefind/pagefind-ui.css" rel="stylesheet"> <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script> <div id="search" class="ml-3 p-4"></div> <script type="module">window.addEventListener("DOMContentLoaded",e=>{setTimeout(()=>{new PagefindUI({element:"#search"})},2e3)});</script> </div> </div> </div>  </div> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="no-print border-t border-gray-600 pt-5"><div class="text-sm text-gray-200">© Copyright <!-- -->2026<!-- --> by <!-- -->FriendlyUsers Tech Blog<!-- -->. Built with ♥ by<!-- --> <a class="text-cyan-400 hover:underline" href="https://github.com/FriendlyUser" target="_blank" rel="noopener noreferrer">FriendlyUser</a>. Last updated on <!-- -->2026-02-26<!-- -->.</div></div><script src="https://cdn.botpress.cloud/webchat/v0/inject.js"></script><script src="https://mediafiles.botpress.cloud/0df54034-3318-451a-aed0-3923a4ee25a5/webchat/config.js" defer=""></script></div> </body></html>